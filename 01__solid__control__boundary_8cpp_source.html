<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Femus: applications/OptimalControl/04_solidopt/01_solid_control_boundary/01_solid_control_boundary.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Femus
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('01__solid__control__boundary_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">01_solid_control_boundary.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="01__solid__control__boundary_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="_femus_init_8hpp.html">FemusInit.hpp</a>&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &quot;<a class="code" href="_multi_level_problem_8hpp.html">MultiLevelProblem.hpp</a>&quot;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="_numeric_vector_8hpp.html">NumericVector.hpp</a>&quot;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &quot;<a class="code" href="_v_t_k_writer_8hpp.html">VTKWriter.hpp</a>&quot;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &quot;<a class="code" href="_non_linear_implicit_system_8hpp.html">NonLinearImplicitSystem.hpp</a>&quot;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &quot;<a class="code" href="_linear_implicit_system_8hpp.html">LinearImplicitSystem.hpp</a>&quot;</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &quot;<a class="code" href="_parameter_8hpp.html">Parameter.hpp</a>&quot;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &quot;<a class="code" href="paral_8hpp.html">paral.hpp</a>&quot;</span><span class="comment">//to get iproc HAVE_MPI is inside here</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &quot;<a class="code" href="_fluid_8hpp.html">Fluid.hpp</a>&quot;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="_solid_8hpp.html">Solid.hpp</a>&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="_files_8hpp.html">Files.hpp</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="_f_e__convergence_8hpp.html">FE_convergence.hpp</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="_assemble__jacobian_8hpp.html">Assemble_jacobian.hpp</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="_petsc_matrix_8hpp.html">PetscMatrix.hpp</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;adept.h&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#aad0021c0ea41252012aebd17473bcd2e">   19</a></span><span class="preprocessor">#define FACE_FOR_CONTROL             3  </span><span class="comment">//we do control on the right (=2) face</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a668a0b03c0385e061dad5178865e3b99">   20</a></span><span class="preprocessor">#define AXIS_DIRECTION_CONTROL_SIDE  0 </span><span class="comment">//=0 if horizontal face, = 1 if vertical face (change this accordingly to the other variable above)</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include   &quot;../solidopt_params.hpp&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">   25</a></span><span class="preprocessor">#define CTRL_FACE_IDX  3</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span> </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacefemus.html">femus</a>;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a480ad40eedfb9ced9d7b090e19b3b85a">   30</a></span> <span class="keywordtype">double</span> <a class="code hl_variable" href="01__solid__control__boundary_8cpp.html#a480ad40eedfb9ced9d7b090e19b3b85a">penalty_outside_control_boundary</a> = 1.e50;       <span class="comment">// penalty for zero control outside Gamma_c</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a92a609d215ec3c30302b119aa0df10f0">   31</a></span> <span class="keywordtype">double</span> <a class="code hl_variable" href="01__solid__control__boundary_8cpp.html#a92a609d215ec3c30302b119aa0df10f0">penalty_ctrl</a> = 1.e10;         <span class="comment">//penalty for u=g</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a949680fe5298ccbe0a9d804df0b792ee">   32</a></span> <span class="keywordtype">double</span> <a class="code hl_variable" href="01__solid__control__boundary_8cpp.html#a949680fe5298ccbe0a9d804df0b792ee">theta_value_outside_fake_element</a> = 0.;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a5dec9191b407f5f1913e563b23777741">   35</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>(<span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a> * ml_prob, <span class="keyword">const</span> std::vector &lt; double &gt;&amp; x, <span class="keyword">const</span> <span class="keywordtype">char</span> name[]) {</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>         </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>           <span class="keywordtype">double</span> value = 0.;</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>             <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;DX&quot;</span>)) {</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>                 value = 0.;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>             }</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;DY&quot;</span>)) {</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                 value = 0.;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>             }</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;DZ&quot;</span>)) {</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                 value = 0.;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>             }</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;P&quot;</span>)) {</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                 value = 0.;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>             }</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;DX_ADJ&quot;</span>)) {</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                 value = 0.;</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>             }</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;DY_ADJ&quot;</span>)) {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>                 value = 0.;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>             }</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;DZ_ADJ&quot;</span>)) {</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>                 value = 0.;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>             }</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;P_ADJ&quot;</span>)) {</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>                 value = 0.;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>             }</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>             </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;GX&quot;</span>)) {</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>                 value = 0.;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>             }</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;GY&quot;</span>)) {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>                 value = 0.;</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>             }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;GZ&quot;</span>)) {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>                 value = 0.;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>             }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;THETA&quot;</span>)) {</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>                 value = 0.;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>             }</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>          </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>      <span class="keywordflow">return</span> value;   </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>}  </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>  </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a1afc17d1ddb3752caf6910ec9a7c39ef">   83</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#a1afc17d1ddb3752caf6910ec9a7c39ef">Solution_set_boundary_conditions</a>(<span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a> * ml_prob, <span class="keyword">const</span> std::vector &lt; double &gt;&amp; x, <span class="keyword">const</span> <span class="keywordtype">char</span> SolName[], <span class="keywordtype">double</span>&amp; value, <span class="keyword">const</span> <span class="keywordtype">int</span> facename, <span class="keyword">const</span> <span class="keywordtype">double</span> time) {</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>  <span class="comment">//1: bottom (y=y_min) //2: right (x=x_max)  //3: top (y=y_max)  //4: left (x=x_min)  (in 2D)</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>  <span class="keywordtype">bool</span> dirichlet  = <span class="keyword">true</span>; </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  value = 0.;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>  </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;GX&quot;</span>))       { <span class="keywordflow">if</span> (facename == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;GY&quot;</span>))       { <span class="keywordflow">if</span> (facename == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;GZ&quot;</span>))       { <span class="keywordflow">if</span> (facename == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;THETA&quot;</span>))    { dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>               <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;DX&quot;</span>))       { <span class="keywordflow">if</span> (facename == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;DY&quot;</span>))       { <span class="keywordflow">if</span> (facename == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                <span class="keywordflow">if</span> (!strcmp(SolName, <span class="stringliteral">&quot;DZ&quot;</span>))       { <span class="keywordflow">if</span> (facename == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) dirichlet = <span class="keyword">false</span>; }</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>  </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>      </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> <span class="keywordflow">return</span> dirichlet;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>}</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov &gt;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#aea610d910b5d696b3e500ed9636d8367">AssembleSolidMech</a>(<a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov &gt;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#aea610d910b5d696b3e500ed9636d8367">AssembleSolidMech</a>(<a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob,</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>                       <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_solid.html">Solid</a> &amp; solid_in,</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                       system_type * mlPdeSys,</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                       <span class="keyword">const</span> std::vector&lt; Unknown &gt; &amp;  unknowns);</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov &gt;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#ad6b2e165d5cf19933c60a49927c5bf64">ComputeIntegral</a>(<span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov &gt;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#ad6b2e165d5cf19933c60a49927c5bf64">ComputeIntegral</a>(  <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob,</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                       <span class="keyword">const</span> system_type * mlPdeSys,</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                       <span class="keyword">const</span> std::vector&lt; Unknown &gt; &amp;  unknowns);</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span> </div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> <span class="comment">//Unknown definition  ==================</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a6917621ec8f1cbd9eda71cf3f12de89c">  126</a></span> <span class="keyword">const</span> std::vector&lt; Unknown &gt;  <a class="code hl_function" href="zzz__giorgiobornia__collect__all_8cpp.html#aa6cf7e343af28b995b6fab3d3528f6ef">provide_list_of_unknowns</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimension) {</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>     </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>     </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>  std::vector&lt; FEFamily &gt; feFamily;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>  std::vector&lt; FEOrder &gt;   feOrder;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);   <span class="comment">//state</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>  <span class="keywordflow">if</span> (dimension == 3)   feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a><span class="comment">/*DISCONTINOUS_POLYNOMIAL*/</span>);</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);   <span class="comment">//adjoint</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>  <span class="keywordflow">if</span> (dimension == 3)   feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a><span class="comment">/*DISCONTINOUS_POLYNOMIAL*/</span>);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);   <span class="comment">//control</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>  <span class="keywordflow">if</span> (dimension == 3)   feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>);</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                        feFamily.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df">DISCONTINUOUS_POLYNOMIAL</a>);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>  <span class="keywordflow">if</span> (dimension == 3)   feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>);</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>  <span class="keywordflow">if</span> (dimension == 3)   feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>);</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>  <span class="keywordflow">if</span> (dimension == 3)   feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a>);</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                        feOrder.push_back(<a class="code hl_enumvalue" href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf">ZERO</a>);</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  assert( feFamily.size() == feOrder.size() );</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> std::vector&lt; Unknown &gt;  unknowns(feFamily.size());</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> adj_pos_begin   = dimension + 1;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> ctrl_pos_begin  = 2 * (dimension + 1);</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                                        unknowns[0]._name      = <span class="stringliteral">&quot;DX&quot;</span>;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                                        unknowns[1]._name      = <span class="stringliteral">&quot;DY&quot;</span>;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  <span class="keywordflow">if</span> (dimension == 3)                   unknowns[2]._name      = <span class="stringliteral">&quot;DZ&quot;</span>;</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                                unknowns[dimension]._name      = <span class="stringliteral">&quot;P&quot;</span>;</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                        unknowns[adj_pos_begin + 0]._name      = <span class="stringliteral">&quot;DX_ADJ&quot;</span>;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                        unknowns[adj_pos_begin + 1]._name      = <span class="stringliteral">&quot;DY_ADJ&quot;</span>;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>  <span class="keywordflow">if</span> (dimension == 3)   unknowns[adj_pos_begin + 2]._name      = <span class="stringliteral">&quot;DZ_ADJ&quot;</span>;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                unknowns[adj_pos_begin + dimension]._name      = <span class="stringliteral">&quot;P_ADJ&quot;</span>;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                       unknowns[ctrl_pos_begin + 0]._name      = <span class="stringliteral">&quot;GX&quot;</span>;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                       unknowns[ctrl_pos_begin + 1]._name      = <span class="stringliteral">&quot;GY&quot;</span>;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  <span class="keywordflow">if</span> (dimension == 3)  unknowns[ctrl_pos_begin + 2]._name      = <span class="stringliteral">&quot;GZ&quot;</span>;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>               unknowns[ctrl_pos_begin + dimension]._name      = <span class="stringliteral">&quot;THETA&quot;</span>;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; u &lt; unknowns.size(); u++) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>         </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>              unknowns[u]._fe_family  = feFamily[u];</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>              unknowns[u]._fe_order   = feOrder[u];</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>              unknowns[u]._time_order = 0;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>              unknowns[u]._is_pde_unknown = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>              </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>     }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>   <span class="keywordflow">return</span> unknowns;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>     </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>}</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span> </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> real_num &gt; </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="keyword">class </span><a class="code hl_class" href="class_solution__generation__1.html">Solution_generation_1</a> : <span class="keyword">public</span> <a class="code hl_class" href="classfemus_1_1_solution__generation__single__level.html">Solution_generation_single_level</a> {</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno"><a class="line" href="class_solution__generation__1.html#a68765d1e79777165c518157310035844">  199</a></span><span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_solution.html">MultiLevelSolution</a>  <a class="code hl_function" href="class_solution__generation__1.html#a68765d1e79777165c518157310035844">run_on_single_level</a>(<a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a> &amp; ml_prob,</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>                                             <a class="code hl_class" href="classfemus_1_1_multi_level_mesh.html">MultiLevelMesh</a> &amp; ml_mesh,</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> i,</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                                              <span class="keyword">const</span> std::vector&lt; Unknown &gt; &amp; unknowns,</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>                                              <span class="keyword">const</span> std::vector&lt; <a class="code hl_class" href="classfemus_1_1_math_1_1_function.html">Math::Function&lt; double &gt;</a> * &gt; &amp;  exact_sol,</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                                              <span class="keyword">const</span> <a class="code hl_typedef" href="classfemus_1_1_multi_level_solution.html#a51e1cff061477ba02672e5ef790c465f">MultiLevelSolution::InitFuncMLProb</a> SetInitialCondition_in,</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>                                              <span class="keyword">const</span> <a class="code hl_typedef" href="classfemus_1_1_multi_level_solution.html#ac2ecfa36125c8626b6fdf20f71dbde0c">MultiLevelSolution::BoundaryFuncMLProb</a> SetBoundaryCondition_in,</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>                                                  <span class="keyword">const</span> <span class="keywordtype">bool</span> equation_sol</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> ) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>  </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>};</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#abdd1e0dbfc8ed6ec0a237d9654d0bce9">  212</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#abdd1e0dbfc8ed6ec0a237d9654d0bce9">set_phi_gradient_surface</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> axis_direction_control_side, </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                      <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_mesh.html">Mesh</a>* msh,</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ig_bd, </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>                      <span class="keyword">const</span> std::vector&lt;unsigned int&gt; SolFEType, </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> felt_bd, </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nve_bd,</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>                      <span class="keyword">const</span> std::vector&lt; std::vector&lt; double &gt; &gt; &amp; coords_hat_bd,</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                      std::vector&lt; std::vector&lt; double &gt; &gt; &amp; phi_hat_bd_x_dof_qp,</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>,  <span class="comment">//dim of the (vector) unknown</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctrl_pos_begin <span class="comment">//unknown</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                     ) {</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment">//========== temporary soln for surface gradient on a face parallel to the axes ===================</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">//           const unsigned int axis_direction_control_side = AXIS_DIRECTION_CONTROL_SIDE;</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>          <span class="keywordtype">double</span> dx_dcurv_abscissa = 0.;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>         <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1elem__type__1_d.html">elem_type_1D</a> * myeltype = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="classfemus_1_1elem__type__1_d.html">elem_type_1D</a>*<span class="keyword">&gt;</span>(msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[felt_bd][SolFEType[ctrl_pos_begin]]);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>         <span class="keyword">const</span> <span class="keywordtype">double</span> * myptr = myptr = myeltype-&gt;<a class="code hl_function" href="classfemus_1_1elem__type__1_d.html#a231d3fc282fc57ca178f9cbd0d10df7c">GetDPhiDXi</a>(ig_bd);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> inode = 0; inode &lt; nve_bd; inode++) dx_dcurv_abscissa += myptr[inode] * coords_hat_bd[axis_direction_control_side][inode];</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>  </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> inode = 0; inode &lt; nve_bd; inode++) {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>                            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; coords_hat_bd.size(); d++) {</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>                              <span class="keywordflow">if</span> (d == axis_direction_control_side ) phi_hat_bd_x_dof_qp[kdim + ctrl_pos_begin][inode + d*nve_bd] = myptr[inode]* (1./ dx_dcurv_abscissa);</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                              <span class="keywordflow">else</span>  phi_hat_bd_x_dof_qp[kdim + ctrl_pos_begin][inode + d*nve_bd] = 0.;</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                         }</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                     }</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            }</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>            </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>}</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a7a29781a20c5dd4153c3c1cecf0ff328">  243</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="ex40__other__a_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** args) {</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>  <span class="comment">// ======= Init ==========================</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  <a class="code hl_class" href="classfemus_1_1_femus_init.html">FemusInit</a> mpinit(argc, args, MPI_COMM_WORLD);</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  <span class="comment">// ======= Files ==================</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>  <a class="code hl_class" href="classfemus_1_1_files.html">Files</a> files;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        files.<a class="code hl_function" href="classfemus_1_1_files.html#ab8c41974c4980d87c7e1467b153854e6">CheckIODirectories</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        files.<a class="code hl_function" href="classfemus_1_1_files.html#aac199200ffda7ba50611cc41f6a874bc">RedirectCout</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>  <span class="comment">// ======= Quad Rule ========================</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>  std::string quad_rule_order(<span class="stringliteral">&quot;seventh&quot;</span>);</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  <span class="comment">// ======= Problem ========================</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a> ml_prob;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>  ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a8b72e984b63d5ff97c1e7a0f0a5eee5a">SetQuadratureRuleAllGeomElems</a>(quad_rule_order);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a623bdc2aefd83cf0c6d74fc265ee5c3f">SetFilesHandler</a>(&amp;files);</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>  <span class="comment">// ======= Mesh ==================</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  <span class="keyword">const</span> <a class="code hl_enumeration" href="_elem_type_enum_8hpp.html#a1b014294b9757a001707c979e2bab627">ElemType</a> geom_elem_type = <a class="code hl_enumvalue" href="_elem_type_enum_8hpp.html#a1b014294b9757a001707c979e2bab627ac17e6803e9d62a4d807c62341c5f7d59">QUAD9</a>;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  <span class="keyword">const</span> std::vector&lt; unsigned int &gt; nsub = {<a class="code hl_define" href="solidopt__params_8hpp.html#a40646ef4581e21d1eac608c36580fff3">NSUB</a>, <a class="code hl_define" href="solidopt__params_8hpp.html#a40646ef4581e21d1eac608c36580fff3">NSUB</a>, 0};</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="keyword">const</span> std::vector&lt; double &gt;      xyz_min = {0., 0., 0.};</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  <span class="keyword">const</span> std::vector&lt; double &gt;      xyz_max = {1., 1., 0.};</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  <a class="code hl_class" href="classfemus_1_1_multi_level_mesh.html">MultiLevelMesh</a> ml_mesh;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>  ml_mesh.<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#a0988cbee341d6361df77622b3ce65080">GenerateCoarseBoxMesh</a>(nsub[0],nsub[1],nsub[2],xyz_min[0],xyz_max[0],xyz_min[1],xyz_max[1],xyz_min[2],xyz_max[2],geom_elem_type,quad_rule_order.c_str());</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>  <span class="comment">// ======= Unknowns ========================</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimension = ml_mesh.<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#a65dabdf1e308c1a44ebe5c6a41d09284">GetDimension</a>();  </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>  std::vector&lt; Unknown &gt; unknowns = <a class="code hl_function" href="zzz__giorgiobornia__collect__all_8cpp.html#aa6cf7e343af28b995b6fab3d3528f6ef">provide_list_of_unknowns</a>(dimension);</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>  </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>  <span class="comment">// ======= Normal run ========================   //if you don&#39;t want the convergence study</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>  <a class="code hl_class" href="class_solution__generation__1.html">Solution_generation_1&lt; adept::adouble &gt;</a> my_main;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_levels = 1;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>  my_main.<a class="code hl_function" href="class_solution__generation__1.html#a2a0001fac52be7a97cc9cc3c901c5f9f">run_on_single_level</a>(ml_prob, ml_mesh, n_levels, unknowns,  std::vector&lt; Math::Function &lt;double&gt; * &gt; (), <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>,<a class="code hl_function" href="01__solid__control__boundary_8cpp.html#a1afc17d1ddb3752caf6910ec9a7c39ef">Solution_set_boundary_conditions</a>, <span class="keyword">true</span> ); </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>  </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>  </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="comment">//   // ======= Convergence study ========================</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="comment">//     </span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span><span class="comment">//    //set coarse storage mesh (should write the copy constructor or &quot;=&quot; operator to copy the previous mesh) ==================</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="comment">//    MultiLevelMesh ml_mesh_all_levels;</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="comment">//    ml_mesh_all_levels.GenerateCoarseBoxMesh(nsub[0],nsub[1],nsub[2],xyz_min[0],xyz_max[0],xyz_min[1],xyz_max[1],xyz_min[2],xyz_max[2],geom_elem_type,quad_rule_order.c_str());</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="comment">//    //   ml_mesh_all_levels.ReadCoarseMesh(infile.c_str(),quad_rule_order.c_str(),1.);</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="comment">//  </span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="comment">//    // convergence choices ================  </span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="comment">//    unsigned int max_number_of_meshes;               // set total number of levels ================  </span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="comment">// </span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="comment">//    if (nsub[2] == 0)   max_number_of_meshes = 3;</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="comment">//    else                max_number_of_meshes = 4;</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span><span class="comment">//   </span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment">// //    My_exact_solution&lt;&gt; exact_sol;                //provide exact solution, if available ==============</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="comment">//    const unsigned conv_order_flag = 0;              //Choose how to compute the convergence order ========= //0: incremental 1: absolute (with analytical sol)  2: absolute (with projection of finest sol)...</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="comment">//    const unsigned norm_flag = 1;                    //Choose what norms to compute (//0 = only L2: //1 = L2 + H1) ==============</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span><span class="comment">// </span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span><span class="comment">//    </span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="comment">//    // object ================  </span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="comment">//     FE_convergence&lt;&gt;  fe_convergence;</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="comment">//     </span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="comment">//     fe_convergence.convergence_study( ... );</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>  </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>}</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov = <span class="keywordtype">double</span> &gt;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#aea610d910b5d696b3e500ed9636d8367">  311</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#aea610d910b5d696b3e500ed9636d8367">AssembleSolidMech</a>(<a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob) {</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>  AssembleSolidMech&lt; system_type, real_num, real_num_mov &gt; (  ml_prob, </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                                                              ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a537b31965e5402b9c9febebce96ce01c">parameters</a>.<a class="code hl_function" href="classfemus_1_1_parameters.html#a419ddd3d0965dbca868a5072249b8374">get</a>&lt;<a class="code hl_class" href="classfemus_1_1_solid.html">Solid</a>&gt;(<span class="stringliteral">&quot;Solid&quot;</span>), </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                                                            &amp; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a3d90edba93be2c202ea2bf8e87e20854">get_system</a>&lt; system_type &gt;(0), </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                                                              ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a3d90edba93be2c202ea2bf8e87e20854">get_system</a>&lt; system_type &gt;(0).get_unknown_list_for_assembly());</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>}</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov = <span class="keywordtype">double</span> &gt;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a96a01d4289cc795fc7506b8b67ba84bc">  324</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#aea610d910b5d696b3e500ed9636d8367">AssembleSolidMech</a>(<a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob,</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                       <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_solid.html">Solid</a> &amp; solid_in,</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                       system_type * mlPdeSys,</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                       <span class="keyword">const</span> std::vector&lt; Unknown &gt; &amp;  unknowns) {</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>  <span class="comment">//  ml_prob is the global object from/to where get/set all the data</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>  <span class="comment">//  level is the level of the PDE system to be assembled</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>  <span class="comment">//  levelMax is the Maximum level of the MultiLevelProblem</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>  <span class="comment">//  assembleMatrix is a flag that tells if only the residual or also the matrix should be assembled</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>        level           = mlPdeSys-&gt;GetLevelToAssemble();</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>  <span class="keywordtype">bool</span>          assembleMatrix          = mlPdeSys-&gt;GetAssembleMatrix(); </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>*           pdename         = mlPdeSys-&gt;name().c_str();</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>  <a class="code hl_class" href="classfemus_1_1_mesh.html">Mesh</a>*                 msh         = ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#af0dec057961b41903215bb9927cbfeed">GetLevel</a>(level);</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>  <a class="code hl_class" href="classfemus_1_1elem.html">elem</a>*                 el          = msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a62689335aebc9de69b7490bfb32f0978">el</a>;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  <a class="code hl_class" href="classfemus_1_1_multi_level_solution.html">MultiLevelSolution</a>*       ml_sol  = ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>  <a class="code hl_class" href="classfemus_1_1_solution.html">Solution</a>*             sol         = ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_solution.html#a9bb3681ff25b06b030d75b1ab1bdfdc3">GetSolutionLevel</a>(level); </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span> </div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>  <a class="code hl_class" href="classfemus_1_1_linear_equation_solver.html">LinearEquationSolver</a>*     pdeSys  = mlPdeSys-&gt;_LinSolver[level];</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>  <a class="code hl_class" href="classfemus_1_1_sparse_matrix.html">SparseMatrix</a>*         JAC         = pdeSys-&gt;<a class="code hl_variable" href="classfemus_1_1_linear_equation.html#aa10eb0eb318cf0d449f5ecdcec2823bc">_KK</a>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>  <a class="code hl_class" href="classfemus_1_1_numeric_vector.html">NumericVector</a>*        RES         = pdeSys-&gt;<a class="code hl_variable" href="classfemus_1_1_linear_equation.html#a20ac8999e714492516cd8a2be53fb54f">_RES</a>;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>  MatSetOption(<span class="keyword">static_cast&lt;</span> PetscMatrix* <span class="keyword">&gt;</span>(JAC)-&gt;mat(),MAT_NEW_NONZERO_ALLOCATION_ERR, PETSC_FALSE);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>    <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a6f753fa456d2313d902bf184c4bb9e3b">GetDimension</a>();</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>   dim2  = (3 * (<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1) + !(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1));</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>    nel  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ab5bcfd4be738d47ae025a06eddc66f61">GetNumberOfElements</a>();</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>  igrid  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a24f5ab73a260d61b0ea9ff28f03bc815">GetLevel</a>();</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>  iproc  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_parallel_object.html#a6438b3ffcc8cde2d6ccfb4ec563dfce1">processor_id</a>();</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>  <span class="comment">// reserve memory for the local standard vectors</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> max_size_elem_dofs = <span class="keyword">static_cast&lt;</span> <span class="keywordtype">unsigned</span> <span class="keyword">&gt;</span>(ceil(pow(3, <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)));          <span class="comment">// conservative: based on line3, quad9, hex27</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>  </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>  <span class="comment">//----------- unknowns ------------------------------</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_unknowns = mlPdeSys-&gt;GetSolPdeIndex().size();</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="comment">//      enum Sol_pos {pos_dx = 0, pos_dy, pos_p};  //these are known at compile-time</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">//      enum Sol_pos {pos_dx = 0, pos_dy, pos_dz, pos_p};</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="comment">//   constexpr unsigned int pos_dx = 0;  </span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span><span class="comment">//   constexpr unsigned int pos_dy = 1;  </span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span><span class="comment">//   constexpr unsigned int pos_dp = 2;  </span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment">//   if (dim == 3) {std::cout &lt;&lt; &quot;Uncomment the 3d enum and recompile&quot;; abort(); }</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>   </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> sol_index_displ      = 0;     <span class="comment">//known at compile time</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_press      = sol_index_displ + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>;      <span class="comment">//known at run time</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> state_pos_begin      = sol_index_displ;   <span class="comment">//known at compile time</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> adj_pos_begin        = <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + 1;</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_adj        = adj_pos_begin;      </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_press_adj  = sol_index_adj + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>;     </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> ctrl_pos_begin       = 2 * (<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + 1);</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_ctrl       = ctrl_pos_begin;     </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> theta_index          = sol_index_ctrl + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>;      </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>  <span class="keyword">const</span> <span class="keywordtype">int</span>  n_state_vars = <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + 1;</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>  </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>  vector &lt; std::string &gt; Solname(n_unknowns);     </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>  vector &lt; unsigned int &gt; SolIndex(n_unknowns);  </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>  vector &lt; unsigned int &gt; SolPdeIndex(n_unknowns);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>  vector &lt; unsigned int &gt; SolFEType(n_unknowns);  </div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar=0; ivar &lt; n_unknowns; ivar++) {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>       Solname[ivar]    = unknowns[ivar]._name; </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>      SolIndex[ivar]    = ml_sol-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_solution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>        (Solname[ivar].c_str());</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    SolPdeIndex[ivar]   = mlPdeSys-&gt;GetSolPdeIndex(Solname[ivar].c_str());</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="comment">//       assert(ivar == SolPdeIndex[ivar]);  //I would like this ivar order to coincide either with SolIndex or with SolPdeIndex, otherwise too many orders... it has to be  with SolPdeIndex, because SolIndex is related to the Solution object which can have more fields... This has to match the order of the unknowns[] argument</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    SolFEType[ivar] = ml_sol-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_solution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>(SolIndex[ivar]);</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>  }</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>   <span class="keyword">constexpr</span> <span class="keywordtype">int</span> solFEType_max = <a class="code hl_define" href="_f_e_type_enum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>;  <span class="comment">//biquadratic, this is the highest-order FE </span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>   vector &lt; unsigned int &gt; Sol_n_el_dofs(n_unknowns);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>  </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  <span class="comment">//----------- of dofs and at quadrature points ------------------------------</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  vector &lt; vector &lt; double &gt; &gt; phi_dof_qp(n_unknowns);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_x_dof_qp(n_unknowns);   <span class="comment">//the derivatives depend on the Jacobian, which depends on the unknown, so we have to be adept here  //some of these should be real_num, some real_num_mov...</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_xx_dof_qp(n_unknowns);  <span class="comment">//the derivatives depend on the Jacobian, which depends on the unknown, so we have to be adept here</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span> </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  vector &lt; vector &lt; double &gt; &gt; phi_hat_dof_qp(n_unknowns);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>  vector &lt; vector &lt; double &gt; &gt; phi_x_hat_dof_qp(n_unknowns);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>  vector &lt; vector &lt; double &gt; &gt; phi_xx_hat_dof_qp(n_unknowns);</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> unk=0; unk &lt; n_unknowns; unk++) {  </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        phi_dof_qp[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    phi_hat_dof_qp[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>      phi_x_dof_qp[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>  phi_x_hat_dof_qp[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>     phi_xx_dof_qp[unk].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> phi_xx_hat_dof_qp[unk].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>   }</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>   </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="comment">//----------boundary adjoint &amp; ctrl shape functions----------------------  </span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>  vector &lt; vector &lt; double &gt; &gt; phi_hat_bd_dof_qp(n_unknowns);</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>  vector &lt; vector &lt; double &gt; &gt; phi_hat_bd_x_dof_qp(n_unknowns);</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>  <span class="comment">//bdry vol adj  evaluated at bdry points</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>   vector &lt; vector &lt; double &gt; &gt; phi_hat_vol_at_bdry_dof(n_unknowns);</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>   vector &lt; vector &lt; double &gt; &gt; phi_hat_x_vol_at_bdry_dof(n_unknowns);</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> unk=0; unk &lt; n_unknowns ; unk++) {  </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        phi_hat_bd_dof_qp[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      phi_hat_bd_x_dof_qp[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>  <span class="comment">//bdry vol adj  evaluated at bdry points</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>         phi_hat_vol_at_bdry_dof[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>       phi_hat_x_vol_at_bdry_dof[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);     </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    }</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>  vector &lt; vector &lt; real_num &gt; &gt;  sol_hat_adj_x_vol_at_bdry_qp(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>  vector &lt; real_num &gt; grad_dot_n_adj_res;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>  vector &lt; double &gt; grad_adj_dot_n;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ldim =0; ldim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ldim++) sol_hat_adj_x_vol_at_bdry_qp[ldim].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>  grad_dot_n_adj_res.reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>  grad_adj_dot_n.reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="comment">//----------- at dofs ------------------------------</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>  vector &lt; double &gt;   Jac;   Jac.reserve( n_unknowns * max_size_elem_dofs * n_unknowns * max_size_elem_dofs);</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>  vector &lt; real_num &gt; Res;   Res.reserve( n_unknowns * max_size_elem_dofs);</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>           vector &lt; int &gt;       L2G_dofmap_AllVars;   L2G_dofmap_AllVars.reserve( n_unknowns *max_size_elem_dofs);</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>  vector &lt; vector &lt; int &gt; &gt;         L2G_dofmap(n_unknowns);  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; n_unknowns; i++) {    L2G_dofmap[i].reserve(max_size_elem_dofs); }</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>  vector &lt; vector &lt; real_num &gt; &gt; SolVAR_eldofs(n_unknowns);  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0; k &lt; n_unknowns; k++) { SolVAR_eldofs[k].reserve(max_size_elem_dofs); }</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> <span class="comment">//=================state_only - for Jac retrieval via AD</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>  vector &lt; double &gt;   Jac_state_true;   Jac_state_true.reserve( n_state_vars * max_size_elem_dofs * n_state_vars * max_size_elem_dofs);</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>  vector &lt; double &gt;   Jac_state_false;   Jac_state_false.reserve( n_state_vars * max_size_elem_dofs * n_state_vars * max_size_elem_dofs);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>  vector &lt; real_num &gt; Res_state;   Res_state.reserve( n_state_vars * max_size_elem_dofs);</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>  <span class="comment">//----------------------------------------------------------------------------------------------------- </span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>  vector &lt; real_num &gt; Res_bd;   Res_bd.reserve( n_unknowns * max_size_elem_dofs);</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>  vector &lt; double &gt;   Jac_g;   Jac_g.reserve( n_unknowns * max_size_elem_dofs * n_unknowns * max_size_elem_dofs);</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>  vector &lt; real_num &gt; Res_g;   Res_g.reserve( n_unknowns * max_size_elem_dofs);</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>  vector &lt; vector &lt; double &gt; &gt; Jac_outer(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>  vector &lt; vector &lt; real_num &gt; &gt; Res_dctrl_dot_n(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>  vector &lt; real_num &gt; Res_outer(1);</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; i++) {  </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>             Jac_outer[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>             Res_dctrl_dot_n[i].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        }</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>  <span class="comment">// geometry (at dofs) --------------------------------</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>  vector&lt; vector &lt; real_num_mov &gt; &gt;   coords(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>  vector  &lt; vector  &lt; double &gt; &gt;  coords_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>  vector  &lt; vector  &lt; double &gt; &gt;  coords_hat_bd(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>  <span class="keywordtype">unsigned</span> coordsType = <a class="code hl_define" href="_f_e_type_enum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>; <span class="comment">// get the finite element type for &quot;x&quot;, it is always 2 (LAGRANGE TENSOR-PRODUCT-QUADRATIC)</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; i++) {   </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>           coords[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>       coords_hat[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    coords_hat_bd[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span> }</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span> <span class="comment">//************** geometry phi **************************</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>  vector &lt; vector &lt; double &gt; &gt; phi_dof_qp_domain(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_x_dof_qp_domain(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_xx_dof_qp_domain(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>  vector &lt; vector &lt; double &gt; &gt; phi_dof_qp_domain_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>  vector &lt; vector &lt; double &gt; &gt; phi_x_dof_qp_domain_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>  vector &lt; vector &lt; double &gt; &gt; phi_xx_dof_qp_domain_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> dom_coord = 0; dom_coord &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; dom_coord++) {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        phi_dof_qp_domain[dom_coord].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>      phi_x_dof_qp_domain[dom_coord].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>     phi_xx_dof_qp_domain[dom_coord].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>        phi_dof_qp_domain_hat[dom_coord].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>      phi_x_dof_qp_domain_hat[dom_coord].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>     phi_xx_dof_qp_domain_hat[dom_coord].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>   }</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span> </div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span> </div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>  <span class="comment">// geometry ------------------------------------------</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>  </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>  <span class="comment">//------------ at quadrature points ---------------------</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>  real_num_mov weight_qp = 0.;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="keywordtype">double</span> weight_hat_qp = 0.;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <span class="keywordtype">double</span> weight_hat_bd_qp = 0.;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    vector &lt; real_num &gt; SolVAR_qp(n_unknowns);</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    vector &lt; real_num &gt; SolVAR_hat_qp(n_unknowns);</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    vector &lt; vector &lt; real_num &gt; &gt; gradSolVAR_qp(n_unknowns);</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    vector &lt; vector &lt; real_num &gt; &gt; gradSolVAR_hat_qp(n_unknowns);</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0; k &lt; n_unknowns; k++) { </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>          gradSolVAR_qp[k].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>      gradSolVAR_hat_qp[k].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    }</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>      </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span> </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>   <span class="comment">// ------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="comment">// Physical parameters</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    <span class="keyword">const</span> <span class="keywordtype">int</span>    solid_model    = solid_in.<a class="code hl_function" href="classfemus_1_1_solid.html#a19ca2da625aede63d5277cb034584718">get_physical_model</a>();</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>    <span class="keywordtype">double</span> rhos                 = solid_in.<a class="code hl_function" href="classfemus_1_1_material.html#aa1968d4c8018a8fca33acb32a5be3dbc">get_density</a>();</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mu_lame        = solid_in.<a class="code hl_function" href="classfemus_1_1_solid.html#a5f3228eab52c343a13167eaf73f568bc">get_lame_shear_modulus</a>();</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> lambda_lame    = solid_in.<a class="code hl_function" href="classfemus_1_1_solid.html#a25307ed3e65fea474b2d74b130348e4b">get_lame_lambda</a>();</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> incompressible   = (0.5  ==  solid_in.<a class="code hl_function" href="classfemus_1_1_solid.html#a3d971cfb0d2a1810e6b31830f1f4b900">get_poisson_coeff</a>()) ? 1 : 0;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> penalty = solid_in.<a class="code hl_function" href="classfemus_1_1_solid.html#a032c01f0f6e345f2818a7ffe24bad883">get_if_penalty</a>();</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> young_modulus = solid_in.<a class="code hl_function" href="classfemus_1_1_solid.html#a1a27599fb327424255b0823dcddd863a">get_young_module</a>();</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> Lref = solid_in.<a class="code hl_variable" href="classfemus_1_1_material.html#a393992ac63eb6eaae7d5cbad9c6ac4ec">_parameter</a>-&gt;<a class="code hl_function" href="classfemus_1_1_parameter.html#a010508c1540e2547bcbf77f2c1103695">Get_reference_length</a>();</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> nondim_number = Lref/young_modulus;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mus   =  <span class="comment">/*nondim_number **/</span> mu_lame/rhos;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="comment">// -----------------------------------------------------------------</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span> </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    RES-&gt;<a class="code hl_function" href="classfemus_1_1_numeric_vector.html#a80b1efdc7101659f2035c2da880360e7">zero</a>();</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>  <span class="keywordflow">if</span> (assembleMatrix) JAC-&gt;<a class="code hl_function" href="classfemus_1_1_sparse_matrix.html#a45654dbe423d1970565b94c792ce6df3">zero</a>();</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>  </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>  adept::Stack &amp; stack = <a class="code hl_variable" href="classfemus_1_1_femus_init.html#ab48c1191eb7ebb370a323d3ec4f713c9">FemusInit::_adeptStack</a>;  <span class="comment">// call the adept stack object for potential use of AD</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>  <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1assemble__jacobian.html">assemble_jacobian</a>&lt; real_num, <span class="keywordtype">double</span><span class="comment">/*real_num_mov*/</span> &gt; assemble_jac;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span> <span class="comment">//=================state_only - for Jac retrieval via AD</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>  adept::Stack &amp; stack_state = <a class="code hl_variable" href="classfemus_1_1_femus_init.html#ab48c1191eb7ebb370a323d3ec4f713c9">FemusInit::_adeptStack</a>;  <span class="comment">// call the adept stack object for potential use of AD</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>  <span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1assemble__jacobian.html">assemble_jacobian</a>&lt; real_num, <span class="keywordtype">double</span><span class="comment">/*real_num_mov*/</span> &gt; assemble_jac_state;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iel = msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">_elementOffset</a>[iproc]; iel &lt; msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">_elementOffset</a>[iproc + 1]; iel++) {</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>   <span class="comment">//all vars ###################################################################  </span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fake_iel_flag = 0;</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_row_index_bdry_constr = pdeSys-&gt;<a class="code hl_variable" href="classfemus_1_1_linear_equation.html#ae3ec0b2dd39e7527448bc35f108f6093">KKoffset</a>[SolPdeIndex[theta_index]][iproc];</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <span class="keywordtype">unsigned</span> ndofs_unk = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, SolFEType[k]);</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>       Sol_n_el_dofs[k] = ndofs_unk;</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>       SolVAR_eldofs[k].resize(Sol_n_el_dofs[k]);</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>          L2G_dofmap[k].resize(Sol_n_el_dofs[k]); </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; SolVAR_eldofs[k].size(); i++) {</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>       <span class="keywordtype">unsigned</span> solDof = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, SolFEType[k]);</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>       SolVAR_eldofs[k][i] = (*sol-&gt;<a class="code hl_variable" href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[SolIndex[k]])(solDof);</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>          L2G_dofmap[k][i] = pdeSys-&gt;<a class="code hl_function" href="classfemus_1_1_linear_equation.html#a4e339f53ed51e108cd33e1577dae9c18">GetSystemDof</a>(SolIndex[k], SolPdeIndex[k], i, iel);    <span class="comment">// global to global mapping between solution node and pdeSys dof</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>     <span class="keywordflow">if</span> (k == SolPdeIndex[theta_index] &amp;&amp; L2G_dofmap[k][i] == global_row_index_bdry_constr) {       fake_iel_flag = iel;  }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>      }</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    }</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    L2G_dofmap_AllVars.resize(0);</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++)     L2G_dofmap_AllVars.insert(L2G_dofmap_AllVars.end(),L2G_dofmap[k].begin(),L2G_dofmap[k].end());</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="keywordtype">unsigned</span> sum_Sol_n_el_dofs = 0;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) { sum_Sol_n_el_dofs += Sol_n_el_dofs[k]; }</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    Jac.resize(sum_Sol_n_el_dofs * sum_Sol_n_el_dofs);  std::fill(Jac.begin(), Jac.end(), 0.);</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    Res.resize(sum_Sol_n_el_dofs);                      std::fill(Res.begin(), Res.end(), 0.);</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>   Res_bd.resize(sum_Sol_n_el_dofs);                      std::fill(Res_bd.begin(), Res_bd.end(), 0.);</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    Jac_g.resize(sum_Sol_n_el_dofs * sum_Sol_n_el_dofs);  std::fill(Jac_g.begin(), Jac_g.end(), 0.);</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    Res_g.resize(sum_Sol_n_el_dofs);                      std::fill(Res_g.begin(), Res_g.end(), 0.);</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> <span class="comment">//=================state_only - for Jac retrieval via AD</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordtype">unsigned</span> state_sum_Sol_n_el_dofs = 0;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_state_vars; k++) { state_sum_Sol_n_el_dofs += Sol_n_el_dofs[k]; }</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    Jac_state_true.resize(state_sum_Sol_n_el_dofs * state_sum_Sol_n_el_dofs);    std::fill(Jac_state_true.begin(), Jac_state_true.end(), 0.);</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    Jac_state_false.resize(state_sum_Sol_n_el_dofs * state_sum_Sol_n_el_dofs);    std::fill(Jac_state_false.begin(), Jac_state_false.end(), 0.);</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    Res_state.resize(state_sum_Sol_n_el_dofs);                              std::fill(Res_state.begin(), Res_state.end(), 0.);</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ivar = 0; ivar &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar++)    {</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>        Jac_outer[ivar].resize(Sol_n_el_dofs[ivar + ctrl_pos_begin]);</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>        Res_dctrl_dot_n[ivar].resize(Sol_n_el_dofs[ivar + ctrl_pos_begin]);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    }</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    Res_outer[0] = 0.;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="comment">//all vars ###################################################################</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>  </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>  </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">//indices for restr --------------------------------------</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>           vector &lt; int &gt; ind_dtheta(theta_index - sol_index_press_adj);</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; ind_dtheta.size(); k++){</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                ind_dtheta[k] = <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, sum_Sol_n_el_dofs, SolPdeIndex[theta_index] , SolPdeIndex[ctrl_pos_begin + k], 0 , 0);</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            }</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>           vector &lt; int &gt; ind_res_dctrl_dtheta(theta_index - sol_index_press_adj);</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; ind_res_dctrl_dtheta.size(); k++){</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                ind_res_dctrl_dtheta[k] = <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[ctrl_pos_begin + k], 0);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            }</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span><span class="comment">//indices for restr --------------------------------------</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>  <span class="comment">// geometry *****************************</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> ielGeom = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#af92bd9944b1d887562b460ede06acf44">GetElementType</a>(iel);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>      <span class="keywordtype">unsigned</span> nDofsX = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, coordsType);    <span class="comment">// number of coordinate element dofs</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ivar=0; ivar&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar++) {</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>      coords[ivar].resize(nDofsX);</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>      coords_hat[ivar].resize(nDofsX);</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    }</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>   <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0; i &lt; nDofsX; i++) {</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>      <span class="keywordtype">unsigned</span> coordsDof  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, coordsType);    <span class="comment">// global to global mapping between coordinates node and coordinate dof // via local to global solution node</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar = 0; ivar &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar++) {</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>          <span class="comment">//Fixed coordinates (Reference frame)</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    coords_hat[ivar][i] = (*msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">_topology</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[ivar])(coordsDof);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>      }</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    }</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>  <span class="comment">//***************************************  </span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    assert(nDofsX == Sol_n_el_dofs[sol_index_displ]);</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    <span class="comment">//Moving coordinates (Moving frame)</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> idim = 0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; nDofsX; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>          coords[idim][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = coords_hat[idim][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] + SolVAR_eldofs[SolIndex[idim]][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>];</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>        }</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>      }</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  </div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>     <span class="comment">// elem average point </span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    vector &lt; double &gt; elem_center(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);   </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = 0.;  }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nDofsX; i++) {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>         elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] += coords_hat[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>][i];</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>       }</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    }</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) { elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>]/nDofsX; }</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>  <span class="comment">//*************************************** </span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>  </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>  <span class="comment">//***** set target domain flag ********************************** </span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>   <span class="keywordtype">int</span> target_flag = 0;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>   target_flag = ElementTargetFlag &lt; double &gt; (elem_center);</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>  <span class="comment">// geometry end *****************************</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>      </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="comment">//************ set control flag *********************</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    <span class="keywordtype">int</span> control_el_flag = 0;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        control_el_flag = <a class="code hl_function" href="solidopt__params_8hpp.html#a1dffa717bb8f2e25ad41baaf598c703f">ControlDomainFlag</a>(elem_center);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    std::vector&lt; std::vector&lt;int&gt; &gt; control_node_flag(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> idim=0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>              control_node_flag[idim].resize(Sol_n_el_dofs[ctrl_pos_begin]);</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    std::fill(control_node_flag[idim].begin(), control_node_flag[idim].end(), 0);</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        }</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span> <span class="comment">//*************************************************** </span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>      </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>   <span class="comment">//************ set fake theta flag: this flag tells me what degrees of freedom of the current element are fake for the theta variable *********************</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    std::vector&lt;int&gt;  bdry_int_constr_pos_vec(1,global_row_index_bdry_constr); <span class="comment">/*KKoffset[SolPdeIndex[PADJ]][iproc]*/</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    std::vector&lt;int&gt; fake_theta_flag(Sol_n_el_dofs[theta_index],0);</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[theta_index]; i++) {</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>      <span class="keywordflow">if</span> ( L2G_dofmap[ SolPdeIndex[theta_index] ] [i] == bdry_int_constr_pos_vec[0]) {  fake_theta_flag[i] = 1;       }</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>    }</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> <span class="comment">//************ end set fake theta flag *********************</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>     assemble_jac.prepare_before_integration_loop(stack);</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>     assemble_jac_state.prepare_before_integration_loop(stack_state); <span class="comment">//=================state_only - for Jac retrieval via AD</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>     </div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>  </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span><span class="comment">//========BoundaryLoop=====================================================================</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>  <span class="comment">// Perform face loop over elements that contain some control face</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>  <span class="keywordflow">if</span> (control_el_flag == 1) {</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>      </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>      <span class="keywordtype">double</span> tau = 0.;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>      vector &lt; double &gt; normal(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>,0);</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>      </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> jface = 0; jface &lt; msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a5a0c1124aca095fd4327252ebac3660f">GetElementFaceNumber</a>(iel); jface++) {</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>      std::vector &lt; double &gt; xyz_bdc(3,0.);  <span class="comment">//not being used, because the boundaries are identified by the face numbers</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>      <span class="comment">// look for boundary faces</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>      <span class="keywordflow">if</span>(el-&gt;<a class="code hl_function" href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">GetFaceElementIndex</a>(iel,jface) &lt; 0) {</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = -( msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a62689335aebc9de69b7490bfb32f0978">el</a>-&gt;<a class="code hl_function" href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">GetFaceElementIndex</a>(iel,jface)+1);</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>          <span class="keywordflow">if</span>(  face == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) { <span class="comment">//control face</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span><span class="comment">//=================================================== </span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>           <span class="comment">//we use the dirichlet flag to say: if dirichlet == true, we set 1 on the diagonal. if dirichlet == false, we put the boundary equation</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>          std::vector &lt; bool &gt; dir_bool(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> idim=0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>              dir_bool[idim] = <span class="keyword">false</span>; <span class="comment">//mlSol-&gt;GetBdcFunction()(xyz_bdc,ctrl_name[idim].c_str(),tau,face,0.);</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>          }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>      </div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="comment">//=================================================== </span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        <span class="keywordtype">unsigned</span> nve_bd = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#af372596998e5d55a1fa15d6c5f58f52b">GetElementFaceDofNumber</a>(iel,jface, SolFEType[ctrl_pos_begin] ); <span class="comment">//AAAAAAAAAAAAAAAAA</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> felt_bd = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a57f92951660269429cc7f04ee3c26c17">GetElementFaceType</a>(iel, jface);    </div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0; i &lt; nve_bd; i++) {</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i);</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>            <span class="keywordtype">unsigned</span>      iDof = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i_vol, iel, coordsType);</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> idim=0; idim&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) { coords_hat_bd[idim][i]=(*msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">_topology</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[idim])(iDof); }</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>        }</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        </div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span><span class="comment">//========= initialize gauss quantities on the boundary ============================================</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>        vector &lt; real_num &gt;                      SolVAR_bd_qp(n_unknowns);</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        vector &lt; vector &lt; real_num &gt; &gt;       gradSolVAR_bd_qp(n_unknowns);</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;n_unknowns; k++) {  gradSolVAR_bd_qp[k].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);  }</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span><span class="comment">//========= gauss_loop boundary===============================================================</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ig_bd=0; ig_bd &lt; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a34890e6aa9d88946571fa050ee544c39">GetQuadratureRule</a>(felt_bd).GetGaussPointsNumber(); ig_bd++) {</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>              ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_multi_level_mesh.html#ad59554c65099f852ba8797f09bc40227">_finiteElement</a>[felt_bd][SolFEType[theta_index]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a41bf5e7188a121649319194e846e533f">JacobianSur</a>(coords_hat_bd,ig_bd,weight_hat_bd_qp,phi_hat_bd_dof_qp[theta_index],phi_hat_bd_x_dof_qp[theta_index],normal);</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>              ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_multi_level_mesh.html#ad59554c65099f852ba8797f09bc40227">_finiteElement</a>[felt_bd][SolFEType[kdim + ctrl_pos_begin]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a41bf5e7188a121649319194e846e533f">JacobianSur</a>(coords_hat_bd,ig_bd,weight_hat_bd_qp,phi_hat_bd_dof_qp[kdim + ctrl_pos_begin],phi_hat_bd_x_dof_qp[kdim + ctrl_pos_begin],normal);</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>              ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_multi_level_mesh.html#ad59554c65099f852ba8797f09bc40227">_finiteElement</a>[ielGeom][SolFEType[kdim + adj_pos_begin]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a6d73c16abce658954e974bf32a5846c7">fill_volume_shape_funcs_at_boundary_quadrature_points_on_current_elem</a>(coords_hat,coords_hat_bd,jface,ig_bd,phi_hat_vol_at_bdry_dof[kdim + adj_pos_begin],phi_hat_x_vol_at_bdry_dof[kdim + adj_pos_begin]);</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            }</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>            </div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            </div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#abdd1e0dbfc8ed6ec0a237d9654d0bce9">set_phi_gradient_surface</a>(<a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a668a0b03c0385e061dad5178865e3b99">AXIS_DIRECTION_CONTROL_SIDE</a>, msh, ig_bd, SolFEType, felt_bd, nve_bd, coords_hat_bd, phi_hat_bd_x_dof_qp, <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>, ctrl_pos_begin);</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span> </div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span> </div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span><span class="comment">//========== compute gauss quantities on the boundary ===============================================</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctrl_index = kdim + ctrl_pos_begin;</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                                          SolVAR_bd_qp[ SolPdeIndex[ctrl_index] ] = 0.;</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>              <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2=0; ivar2&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++) {  gradSolVAR_bd_qp[ SolPdeIndex[ctrl_index] ][ivar2] = 0.; }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>            }</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>      </div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctrl_index = kdim + ctrl_pos_begin;</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_bd = 0; i_bd &lt; nve_bd; i_bd++) {</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i_bd);</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>                                                                    SolVAR_bd_qp[SolPdeIndex[ctrl_index]]           += phi_hat_bd_dof_qp  [ ctrl_index ][i_bd]                  * SolVAR_eldofs[ SolPdeIndex[ ctrl_index ] ][i_vol];</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2=0; ivar2&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++) {  gradSolVAR_bd_qp[SolPdeIndex[ctrl_index]][ivar2]     += phi_hat_bd_x_dof_qp[ ctrl_index ][i_bd + ivar2 * nve_bd] * SolVAR_eldofs[ SolPdeIndex[ ctrl_index ] ][i_vol];      }</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>              }</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            }<span class="comment">//kdim</span></div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span> <span class="comment">//end unknowns eval at gauss points ********************************</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span><span class="comment">//=============== grad dot n for residual ========================================= </span></div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span><span class="comment">//     compute gauss quantities on the boundary through VOLUME interpolation</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ldim=0; ldim&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ldim++) {   sol_hat_adj_x_vol_at_bdry_qp[ldim].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>); }</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        grad_dot_n_adj_res.resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>        grad_adj_dot_n.resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ldim=0; ldim&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ldim++) {   std::fill(sol_hat_adj_x_vol_at_bdry_qp[ldim].begin(), sol_hat_adj_x_vol_at_bdry_qp[ldim].end(), 0.);  }</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ldim=0; ldim&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ldim++) {  </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iv = 0; iv &lt; Sol_n_el_dofs[adj_pos_begin]; iv++)  {</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>               sol_hat_adj_x_vol_at_bdry_qp[ldim][d] += SolVAR_eldofs[SolPdeIndex[ldim + adj_pos_begin]][iv] * phi_hat_x_vol_at_bdry_dof[ldim + adj_pos_begin][iv * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + d];<span class="comment">//notice that the convention of the orders x y z is different from vol to bdry</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>             }</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>          }  </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>              </div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>          grad_dot_n_adj_res[ldim] = 0.;</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> d=0; d&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>              grad_dot_n_adj_res[ldim] += sol_hat_adj_x_vol_at_bdry_qp[ldim][d]*normal[d];  </div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>          }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>        }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="comment">//=============== grad dot n  for residual =========================================       </span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>          </div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span><span class="comment">//========== compute gauss quantities on the boundary ================================================</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span> </div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        </div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>  <span class="comment">// *** phi_i loop ***</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_bdry=0; i_bdry &lt; nve_bd; i_bdry++) {</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i_bdry);</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>                 </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="comment">//=============== construct control node flag field on the go  =========================================    </span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>          <span class="comment">/* (control_node_flag[i])       picks nodes on \Gamma_c</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span><span class="comment">             (1 - control_node_flag[i])   picks nodes on \Omega \setminus \Gamma_c</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span><span class="comment">           */</span></div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> idim=0; idim&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>            <span class="keywordflow">if</span> (dir_bool[idim] == <span class="keyword">false</span>) { </div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span><span class="comment">//      std::cout &lt;&lt; &quot; found boundary control nodes ==== &quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>                <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> k=0; k &lt; control_node_flag[idim].size(); k++) {</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>                  control_node_flag[idim][i_vol] = 1;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>                }</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>            }</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>            }</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span><span class="comment">//=============== construct control node flag field on the go  =========================================    </span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>        </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>          </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span><span class="comment">//Boundary Residuals  and Jacobians ==================  </span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span> </div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>          </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span><span class="comment">//============ Boundary Residuals============================================================================================</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>          </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>            </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>                real_num lap_res_dctrl_ctrl_bd = 0.;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>                  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> jdim = 0; jdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; jdim++) {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>                  lap_res_dctrl_ctrl_bd += gradSolVAR_bd_qp[SolPdeIndex[kdim + ctrl_pos_begin]][jdim]*phi_hat_bd_x_dof_qp[kdim + ctrl_pos_begin][i_bdry + jdim*nve_bd];</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>                  }<span class="comment">//jdim</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span> </div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>            </div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span><span class="comment">/*delta_state row */</span>        <span class="keywordflow">if</span>(i_vol&lt;Sol_n_el_dofs[state_pos_begin])   Res_bd[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[kdim], i_vol) ]                += control_node_flag[kdim][i_vol] * <a class="code hl_variable" href="01__solid__control__boundary_8cpp.html#a92a609d215ec3c30302b119aa0df10f0">penalty_ctrl</a> * (SolVAR_eldofs[SolPdeIndex[kdim + state_pos_begin]][i_vol] - SolVAR_eldofs[SolPdeIndex[kdim + ctrl_pos_begin]][i_vol]);     <span class="comment">//u-g</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span><span class="comment">/*delta_adjoint row */</span>     <span class="keywordflow">if</span>(i_vol&lt;Sol_n_el_dofs[adj_pos_begin])   Res_bd[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[kdim + adj_pos_begin], i_vol) ] += 0.;      </div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span><span class="comment">/*delta_control row */</span>     <span class="keywordflow">if</span>(i_vol&lt;Sol_n_el_dofs[ctrl_pos_begin])  Res_bd[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[kdim + ctrl_pos_begin], i_vol) ]  += control_node_flag[kdim][i_vol] * weight_hat_bd_qp * (</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>                                                                                          <a class="code hl_variable" href="solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a>* SolVAR_bd_qp[SolPdeIndex[kdim + ctrl_pos_begin]] * phi_hat_bd_dof_qp[kdim +  ctrl_pos_begin][i_bdry]</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>                                                                                        + <a class="code hl_variable" href="_conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a>* lap_res_dctrl_ctrl_bd</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>                                                                                        - nondim_number * mus * grad_dot_n_adj_res[kdim]  * phi_hat_bd_dof_qp[kdim +  ctrl_pos_begin][i_bdry]</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>                                                                                        );      </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>              }<span class="comment">//kdim  </span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span><span class="comment">//============ Boundary Residuals  ==================================================================================================</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span> </div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span> </div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>                        }<span class="comment">//end i_bdry loop</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span> </div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>                    }  <span class="comment">//end ig_bdry loop</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>      </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                }    <span class="comment">//end if control face</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            }  <span class="comment">//end if boundary faces</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>        }  <span class="comment">// loop over element faces //jface   </span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>  } <span class="comment">//end if control element flag</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span> </div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span><span class="comment">//End Boundary Residuals  and Jacobians ==================  </span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span> </div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span><span class="comment">//======================= Loop without Integration =====================================================    </span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="comment">//============ delta_theta - theta row ==================================================================================================</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[theta_index]; i++) {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>             <span class="comment">/* if ( fake_theta_flag[i] != 1 ) */</span>       Res[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[theta_index], i) ]    = (1 - fake_theta_flag[i]) * ( <a class="code hl_variable" href="01__solid__control__boundary_8cpp.html#a949680fe5298ccbe0a9d804df0b792ee">theta_value_outside_fake_element</a> - SolVAR_eldofs[SolPdeIndex[theta_index]][i]);  <span class="comment">// Res_outer for the exact row (i.e. when fakeflag=1 , res =0(use Res_outer) and if not 1 this loop) and this is to take care of fake placement for the rest of dofs of theta values as 8</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        }<span class="comment">//i_theta loop</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>   </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span> <span class="comment">//============ delta_theta row ==================================================================================================</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> <span class="comment">//======================= Loop without Integration =====================================================    </span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span> </div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span> </div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span><span class="comment">//======================= VolumeLoop with Integration (and fake boundary) =====================================================    </span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="comment">// *** Gauss point loop ***</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> = 0; <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> &lt; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a34890e6aa9d88946571fa050ee544c39">GetQuadratureRule</a>(ielGeom).<a class="code hl_function" href="classfemus_1_1_gauss.html#ab1eb96997b69ce4ebec7283eb3bf1c01">GetGaussPointsNumber</a>(); <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>++) {</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    <span class="comment">// *** get Jacobian and test function and test function derivatives ***</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> unk=0; unk &lt; n_unknowns; unk++) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[unk]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords,    <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>,weight_qp,    phi_dof_qp[unk],    phi_x_dof_qp[unk],    phi_xx_dof_qp[unk]);</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>    msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[unk]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_hat,<a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>,weight_hat_qp,phi_hat_dof_qp[unk],phi_x_hat_dof_qp[unk],phi_xx_hat_dof_qp[unk]);</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>      }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>      </div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>   <span class="comment">//=============== Integration at qp ========================================</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>         <span class="comment">//HAVE TO RECALL IT TO HAVE BIQUADRATIC JACOBIAN...</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>         msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][coordsType]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords,    <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_qp,    phi_dof_qp_domain[d],     phi_x_dof_qp_domain[d],     phi_xx_dof_qp_domain[d]);</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>         msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][coordsType]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_hat,<a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_hat_qp,phi_dof_qp_domain_hat[d], phi_x_dof_qp_domain_hat[d], phi_xx_dof_qp_domain_hat[d]);</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>      }</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>     </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>  <span class="comment">//begin unknowns eval at gauss points ********************************</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> unk = 0; unk &lt;  n_unknowns; unk++) {</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>      SolVAR_qp[SolPdeIndex[unk]] = 0.;</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>      SolVAR_hat_qp[SolPdeIndex[unk] ]= 0.;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span> </div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2=0; ivar2&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++){ </div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>        gradSolVAR_qp[SolPdeIndex[unk]][ivar2] = 0.; </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>        gradSolVAR_hat_qp[SolPdeIndex[unk]][ivar2] = 0.; </div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>      }</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    }</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>      </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> unk = 0; unk &lt;  n_unknowns; unk++) {</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[unk]; i++) {</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        SolVAR_qp[SolPdeIndex[unk]]    += phi_dof_qp[ unk ][i] * SolVAR_eldofs[SolPdeIndex[unk]][i];</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>        SolVAR_hat_qp[SolPdeIndex[unk]]    += phi_hat_dof_qp[ unk ][i] * SolVAR_eldofs[SolPdeIndex[unk]][i];</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2 = 0; ivar2 &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++) {</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>          gradSolVAR_qp[SolPdeIndex[unk]][ivar2]     += phi_x_dof_qp[ unk ][i*<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>+ivar2] * SolVAR_eldofs[SolPdeIndex[unk]][i]; </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>          gradSolVAR_hat_qp[SolPdeIndex[unk]][ivar2] += phi_x_hat_dof_qp[ unk ][i*<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>+ivar2] * SolVAR_eldofs[SolPdeIndex[unk]][i]; </div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        }</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>      }</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>      </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    }  </div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span> <span class="comment">//end unknowns eval at gauss points ********************************</span></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span><span class="comment">//  assemble_jacobian&lt; real_num, real_num_mov &gt;::mass_residual (Res, Sol_n_el_dofs, sum_Sol_n_el_dofs, SolPdeIndex, phi_dof_qp, SolVAR_qp, weight_hat_qp); //identity</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span> </div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span> </div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span> <span class="comment">//*******************************************************************************************************</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>   vector &lt; vector &lt; real_num_mov &gt; &gt; Cauchy(3); <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Cauchy.size(); i++) Cauchy[i].resize(3);</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>   real_num_mov J_hat;</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>   real_num_mov trace_e_hat;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> Cauchy = Solid::get_Cauchy_stress_tensor&lt; real_num_mov &gt;(solid_model, mus, lambda_lame, incompressible, <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>, sol_index_displ, sol_index_press, gradSolVAR_hat_qp, SolVAR_qp, SolPdeIndex, J_hat, trace_e_hat);</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span> </div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>  <span class="comment">//STATE=====================================</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span><span class="comment">//----------from displ_state and p_state</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>              <span class="comment">//BEGIN residual Solid Momentum in moving domain</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[sol_index_displ]; i++) {</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>              real_num_mov Cauchy_direction[3] = {0., 0., 0.};</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idim = 0.; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jdim = 0.; jdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; jdim++) {</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>                  Cauchy_direction[idim] += nondim_number * phi_x_dof_qp[ idim ][i * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + jdim] * Cauchy[idim][jdim];</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                }</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>              }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idim = 0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>                Res[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[idim], i) ] += ( Cauchy_direction[idim] -  phi_dof_qp[ idim ][i] * <a class="code hl_variable" href="solidopt__params_8hpp.html#a491774c0485f249809d76f7933b79419">_gravity</a>[idim] ) * weight_qp;</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>              }</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span> </div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>            }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>              <span class="comment">//END residual Solid Momentum in moving domain</span></div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span><span class="comment">//----------from displ_state and p_state</span></div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>              </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span> </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span><span class="comment">//----------from displ_state of divergence</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>              <span class="comment">//BEGIN residual solid mass balance in reference domain</span></div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[sol_index_press]; i++) {</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                </div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>              Res[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[sol_index_press], i) ] += </div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>                - weight_hat_qp * phi_hat_dof_qp[ sol_index_press ][i] * Solid::get_mass_balance_reference_domain&lt; real_num_mov &gt;(solid_model, penalty, incompressible, lambda_lame, trace_e_hat, J_hat, SolVAR_qp, SolPdeIndex, sol_index_press);</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span><span class="comment">//               - weight_hat_qp * phi_dof_qp[ sol_index_press ][i] * Solid::get_mass_balance_moving_domain&lt; real_num_mov &gt;(gradSolVAR_qp, SolPdeIndex);</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>              </div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>            }</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>              <span class="comment">//END residual solid mass balance in reference domain</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span><span class="comment">//----------from displ_state of div</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>  <span class="comment">//STATE=====================================</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span> </div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span> <span class="comment">//ADJOINT=====================================</span></div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span><span class="comment">//----------from displ_state and displ_ctrl</span></div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[sol_index_adj]; i++) {</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idim = 0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>   Res[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[idim + adj_pos_begin], i)] += </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    - <a class="code hl_variable" href="solidopt__params_8hpp.html#a101671cfe5078b188740d5d892832ea9">cost_functional_coeff</a> * target_flag * (SolVAR_hat_qp[SolPdeIndex[idim]] - <a class="code hl_variable" href="solidopt__params_8hpp.html#a80e1487a07155d5b24edd6eca186b73b">TargetDisp</a>[idim]) </div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>     * phi_dof_qp[ idim + adj_pos_begin ][i] * weight_qp;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>               }</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>          }</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span><span class="comment">//----------from displ_state and displ_ctrl</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span> <span class="comment">//ADJOINT=====================================</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span> </div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>               </div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span> <span class="comment">//CONTROL=====================================</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span> <span class="comment">//============ delta_control row ==================================================================================================</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span><span class="comment">// delta_control</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) { </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[ctrl_pos_begin]; i++) {</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>       Res[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[kdim + ctrl_pos_begin], i) ] += - <a class="code hl_variable" href="01__solid__control__boundary_8cpp.html#a480ad40eedfb9ced9d7b090e19b3b85a">penalty_outside_control_boundary</a> * ( (1 - control_node_flag[kdim][i]) * (  SolVAR_eldofs[SolPdeIndex[kdim + ctrl_pos_begin]][i] - 0.)  );              <span class="comment">//enforce control zero outside the control boundary</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        }<span class="comment">//i_ctrl loop</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    }  <span class="comment">//kdim</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span> <span class="comment">//============ delta_control row ==================================================================================================</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> <span class="comment">//CONTROL=====================================</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span> </div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>        </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>        </div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    } <span class="comment">// end gauss point loop</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    <span class="comment">//--------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span> </div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    </div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Res_state.size(); i++) {</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>        Res_state[i] = Res[i];</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>  }</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>  </div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    std::vector &lt; double &gt; Res_state_double(Res_state.size());</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Res_state_double.size(); i++) {</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>      Res_state_double[i] = - Res_state[i].value();</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    }</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span> </div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    stack_state.dependent(  &amp; Res_state[0], Res_state_double.size());      <span class="comment">// define the dependent variables</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_state_vars; k++) {   </div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>    stack_state.independent(&amp;SolVAR_eldofs[k][0],       SolVAR_eldofs[k].size());    <span class="comment">// define the independent variables</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>    }</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>    </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>    stack_state.jacobian(&amp;Jac_state_true[0], <span class="keyword">true</span>);    <span class="comment">// get the jacobian matrix (ordered by row major for Ctrl block in delta_state) </span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    stack_state.jacobian(&amp;Jac_state_false[0], <span class="keyword">false</span>);    <span class="comment">// get the jacobian matrix (ordered by column major for Adjoint) // Adj = transpose of state block</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span> </div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    stack_state.clear_independents();</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>    stack_state.clear_dependents();    </div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span> </div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>  <span class="comment">//ADJOINT=====================================</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span><span class="comment">//----------from adj displ</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_block = adj_pos_begin; i_block &lt; adj_pos_begin + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; i_block++) {</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_dof = 0; i_dof &lt; Sol_n_el_dofs[i_block]; i_dof++) {</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j_block = 0; j_block &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; j_block++) {</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>               <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j_dof = 0; j_dof &lt; Sol_n_el_dofs[j_block]; j_dof++) {</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    Res[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, i_block, i_dof)] += </div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>        Jac_state_false[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, state_sum_Sol_n_el_dofs,i_block - adj_pos_begin , j_block, i_dof, j_dof )] </div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>            * SolVAR_eldofs[SolPdeIndex[j_block + adj_pos_begin]][j_dof];</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                }</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>           }</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>        }</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>   }</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span><span class="comment">//----------from adj displ </span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span><span class="comment">//----------from p_adj only</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_block = adj_pos_begin; i_block &lt; adj_pos_begin + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> ; i_block++) {</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_dof = 0; i_dof &lt; Sol_n_el_dofs[i_block]; i_dof++) {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j_block = <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; j_block &lt; n_state_vars; j_block++) {</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>               <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j_dof = 0; j_dof &lt; Sol_n_el_dofs[j_block]; j_dof++) {</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    Res[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, i_block, i_dof)] += </div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        Jac_state_true[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, state_sum_Sol_n_el_dofs,i_block - adj_pos_begin , j_block, i_dof, j_dof )] </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>            * SolVAR_eldofs[SolPdeIndex[j_block + adj_pos_begin]][j_dof];</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>                }</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>           }</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>        }</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>   }</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span><span class="comment">//----------from p_adj only</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span> </div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span><span class="comment">//----------from div of displ_adj</span></div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_block = sol_index_press_adj; i_block &lt; ctrl_pos_begin ; i_block++) {</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_dof = 0; i_dof &lt; Sol_n_el_dofs[i_block]; i_dof++) {</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j_block = 0; j_block &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; j_block++) {</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>               <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j_dof = 0; j_dof &lt; Sol_n_el_dofs[j_block]; j_dof++) {</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    Res[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, i_block, i_dof)] += </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>        Jac_state_true[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, state_sum_Sol_n_el_dofs,i_block - adj_pos_begin , j_block, i_dof, j_dof )] </div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>            * SolVAR_eldofs[SolPdeIndex[j_block + adj_pos_begin]][j_dof];</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>                }</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>           }</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        }</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>   }</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span><span class="comment">// ----------from div of displ_adj</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>  <span class="comment">//ADJOINT=====================================</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span> </div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_block = 0; i_block &lt; n_unknowns; i_block++) {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_dof = 0; i_dof &lt; Sol_n_el_dofs[i_block]; i_dof++) {</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>                Res[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, i_block, i_dof)] += </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>                Res_bd[<a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, i_block, i_dof)];</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>            }</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    }</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span> </div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>  </div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>      </div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>     <span class="keywordflow">if</span> (assembleMatrix) assemble_jac.compute_jacobian_outside_integration_loop(stack, SolVAR_eldofs, Res, Jac, L2G_dofmap_AllVars, RES, JAC);</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span> </div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span><span class="comment">//       //***************************************************************************************************************</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>     </div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>  <span class="keywordflow">if</span> (control_el_flag == 1) {</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>      </div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>      vector &lt; double &gt; normal(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>,0);</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span> </div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> jface = 0; jface &lt; msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a5a0c1124aca095fd4327252ebac3660f">GetElementFaceNumber</a>(iel); jface++) {</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>                </div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>              <span class="keywordflow">if</span>(el-&gt;<a class="code hl_function" href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">GetFaceElementIndex</a>(iel,jface) &lt; 0) {  <span class="comment">//I am on the boundary</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span> </div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = -( msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a62689335aebc9de69b7490bfb32f0978">el</a>-&gt;<a class="code hl_function" href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">GetFaceElementIndex</a>(iel,jface)+1);</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>                        <span class="keywordflow">if</span>(  face == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) { <span class="comment">//I am a control face</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>              </div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <span class="keywordtype">unsigned</span> nve_bd = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#af372596998e5d55a1fa15d6c5f58f52b">GetElementFaceDofNumber</a>(iel,jface, SolFEType[ctrl_pos_begin] ); <span class="comment">//AAAAAAAAAAAAAAAAA</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> felt_bd = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a57f92951660269429cc7f04ee3c26c17">GetElementFaceType</a>(iel, jface);    </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span> </div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        vector &lt; real_num &gt;                      SolVAR_bd_qp(n_unknowns);</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span> </div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ig_bd=0; ig_bd &lt; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a34890e6aa9d88946571fa050ee544c39">GetQuadratureRule</a>(felt_bd).GetGaussPointsNumber(); ig_bd++) {</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>              </div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>              ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_multi_level_mesh.html#ad59554c65099f852ba8797f09bc40227">_finiteElement</a>[felt_bd][SolFEType[kdim + ctrl_pos_begin]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a41bf5e7188a121649319194e846e533f">JacobianSur</a>(coords_hat_bd,ig_bd,weight_hat_bd_qp,phi_hat_bd_dof_qp[kdim + ctrl_pos_begin],phi_hat_bd_x_dof_qp[kdim + ctrl_pos_begin],normal);</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>                        }</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>              </div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>              </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctrl_index = kdim + ctrl_pos_begin;</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>                                          SolVAR_bd_qp[ SolPdeIndex[ctrl_index] ] = 0.;</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>                                          </div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_bd = 0; i_bd &lt; nve_bd; i_bd++) {</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>                          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i_bd);</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>                                SolVAR_bd_qp[SolPdeIndex[ctrl_index]] += phi_hat_bd_dof_qp  [ ctrl_index ][i_bd]  * SolVAR_eldofs[ SolPdeIndex[ ctrl_index ] ][i_vol];</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>                              }                                         </div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>                        }</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>              </div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>              </div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>  <span class="comment">//============ Res _ Boundary Integral Constraint ============================================================================================</span></div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>              <span class="comment">//residual  -  delta_theta  * g dot n =========================================</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span><span class="comment">//      for(unsigned i=0; i &lt; Sol_n_el_dofs[theta_index]; i ++) { //avoid because it is an element dof</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span><span class="comment">/*delta_theta row */</span>     <span class="comment">/*Res_bd[ assemble_jacobian&lt;double,double&gt;::res_row_index(Sol_n_el_dofs, SolPdeIndex[theta_index], i) ] */</span>Res_outer[0] += - <span class="comment">/*fake_theta_flag[i] **/</span> weight_hat_bd_qp * SolVAR_bd_qp[SolPdeIndex[kdim + ctrl_pos_begin]] * normal[kdim] ;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span><span class="comment">//      }  </span></div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>      }</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>              <span class="comment">//residual  -  delta_theta * g dot n =========================================</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>              </div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>                    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i_bdry=0; i_bdry &lt; nve_bd; i_bdry++) {</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i_bdry);</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>          </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>              <span class="comment">//residual  -  theta * delta_g dot n =========================================</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>                          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>            </div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>            </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span><span class="comment">/*delta_control row */</span>     <span class="keywordflow">if</span>( i_vol &lt; Sol_n_el_dofs[ctrl_pos_begin] )  Res_g[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs, SolPdeIndex[kdim + ctrl_pos_begin], i_vol) ]  += -</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>                                                                                       control_node_flag[kdim][i_vol] * weight_hat_bd_qp * (</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>                                                                                         SolVAR_eldofs[SolPdeIndex[theta_index]][0] <span class="comment">/*(*sol-&gt;_Sol[SolIndex[theta_index]])(0)*/</span> * phi_hat_bd_dof_qp[kdim +  ctrl_pos_begin][i_bdry] * normal[kdim]  </div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>                                                                                        <span class="comment">//*sol-&gt;_Sol[SolIndex[theta_index]])(0) finds the global value from KKDof pos(63, 169,etc), SolVAReldof_theta gets the value in the boundary point which will be zero. Theta is just a const</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>                                                                                        );      </div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>                                }<span class="comment">//kdim  </span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>              <span class="comment">//residual  -  theta * delta_g dot n =========================================</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>              <span class="comment">//residual - end =========================================</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span><span class="comment">//============ End of Res _ Boundary Integral Constraint ============================================================================================</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>              </div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>              <span class="comment">//jacobian =========================================</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>              </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>  <span class="comment">//============ Jac _ Boundary Integral Constraint ============================================================================================</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) { </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>              <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i =0; i &lt; Sol_n_el_dofs[theta_index]; i ++) {</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>                <span class="keywordflow">if</span>(i_vol &lt; Sol_n_el_dofs[ctrl_pos_begin]) {</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>                <span class="keywordtype">double</span> temp = weight_hat_bd_qp * ( phi_hat_bd_dof_qp[kdim + ctrl_pos_begin][i_bdry] * normal[kdim]);</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span><span class="comment">//ROW_BLOCK delta_theta - control -- loop over i in the VOLUME (while j(/i_vol) is in the boundary) -------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>                  Jac_g[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, sum_Sol_n_el_dofs, theta_index , ctrl_pos_begin + kdim, i, i_vol) ]  +=  temp;</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span><span class="comment">//COLUMN_BLOCK delta_control - theta ---- loop over j in the VOLUME (while i(/i_vol) is in the boundary) ---------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>                  Jac_g[ <a class="code hl_function" href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, sum_Sol_n_el_dofs, ctrl_pos_begin + kdim, theta_index , i_vol, i) ] +=  control_node_flag[kdim][i_vol] * temp;</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                }<span class="comment">//endif</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>              }<span class="comment">// i </span></div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>            }<span class="comment">//kdim</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span><span class="comment">//============ End of Jac _ Boundary Integral Constraint ============================================================================================</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>            </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>              </div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>              </div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>              <span class="comment">//jacobian - end =========================================</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>              </div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>                    } <span class="comment">//i_bdry</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>                    </div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>          }  <span class="comment">//end gauss boundary loop</span></div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span> </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>              </div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++){</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>          vector &lt; double &gt; Jac_dtheta_g(Jac_g.begin() + ind_dtheta[kdim], Jac_g.begin() + ind_dtheta[kdim + 1]);</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>          vector &lt; real_num &gt;  Res_dctrl_dot_n_theta(Res_g.begin() + ind_res_dctrl_dtheta[kdim], Res_g.begin() + ind_res_dctrl_dtheta[kdim + 1]);</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>          Jac_outer[kdim] = Jac_dtheta_g;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>          Res_dctrl_dot_n[kdim] = Res_dctrl_dot_n_theta;</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>     }</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>             </div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>                        }</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>                    }</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>                }      </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>            }</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>     </div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span> </div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>     vector &lt; double &gt; Res_outer_double(1,0.);</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; Res_outer_double.size(); i++){   Res_outer_double[i] = Res_outer[i].value();   }</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span> </div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>     vector &lt; vector &lt; double &gt; &gt; Res_dctrl_dot_n_double(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> kdim =0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) Res_dctrl_dot_n_double[kdim].resize(Sol_n_el_dofs[ctrl_pos_begin + kdim]);</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> kdim =0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; Res_dctrl_dot_n_double[kdim].size(); i++){</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            Res_dctrl_dot_n_double[kdim][i] = Res_dctrl_dot_n[kdim][i].value();</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        }</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>     }</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>   <span class="comment">//--------------------------------------------------------------------------------------------------------  </span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>    <span class="comment">// THE BLOCKS WITH THETA ROW OR COLUMN </span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span><span class="comment">//  /*delta_theta-theta*/    JAC-&gt;add_matrix_blocked( Jac[ SolPdeIndex[n_unknowns-1] ][ SolPdeIndex[n_unknowns-1] ], L2G_dofmap[n_unknowns-1], L2G_dofmap[n_unknowns-1]);</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        </div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>     <span class="keywordflow">if</span> (control_el_flag == 1) {</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>                          <span class="comment">/*delta_control*/</span>       RES-&gt;<a class="code hl_function" href="classfemus_1_1_numeric_vector.html#a0440021963af01ac49a6f02df562e44b">add_vector_blocked</a>(Res_dctrl_dot_n_double[kdim],L2G_dofmap[n_unknowns-2-kdim]); </div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="keywordflow">if</span>(assembleMatrix) {</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>                          <span class="comment">/*delta_theta-control*/</span> JAC-&gt;<a class="code hl_function" href="classfemus_1_1_sparse_matrix.html#aac0370cebbcc2d7111660dcf7115ebbf">add_matrix_blocked</a>( Jac_outer[kdim], bdry_int_constr_pos_vec, L2G_dofmap[n_unknowns-2-kdim]);</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>                          <span class="comment">/*delta_control-theta*/</span> JAC-&gt;<a class="code hl_function" href="classfemus_1_1_sparse_matrix.html#aac0370cebbcc2d7111660dcf7115ebbf">add_matrix_blocked</a>( Jac_outer[kdim], L2G_dofmap[n_unknowns-2-kdim], bdry_int_constr_pos_vec); </div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        }</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>          }  <span class="comment">//kdim</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>     }  <span class="comment">//add control boundary element contributions</span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>     </div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>     </div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>          <span class="keywordflow">if</span> (control_el_flag == 1) {</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>          <span class="comment">/*delta_theta(bdry constr)*/</span>         RES-&gt;<a class="code hl_function" href="classfemus_1_1_numeric_vector.html#a0440021963af01ac49a6f02df562e44b">add_vector_blocked</a>(Res_outer_double,bdry_int_constr_pos_vec);</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>      }</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>      </div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span><span class="comment">//      /* if (L2G_dofmap[n_unknowns-1][0] != bdry_int_constr_pos_vec[0]) */ /*delta_theta(fake)*/          RES-&gt;add_vector_blocked( Res[ SolPdeIndex[n_unknowns-1]],       L2G_dofmap[n_unknowns-1]);</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>      </div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>   <span class="comment">//--------------------------------------------------------------------------------------------------------  </span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span> </div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>       </div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span><span class="comment">//     assemble_jacobian&lt;real_num,real_num_mov&gt;::print_element_residual(iel, Res, Sol_n_el_dofs, 9, 3);</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span><span class="comment">//     assemble_jacobian&lt;real_num,real_num_mov&gt;::print_element_jacobian(iel, Jac, Sol_n_el_dofs, 4, 1);</span></div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    </div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>  } <span class="comment">//end element loop for each process</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span> </div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span> </div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span> <span class="keywordflow">if</span> (assembleMatrix) JAC-&gt;<a class="code hl_function" href="classfemus_1_1_sparse_matrix.html#a6eb9fbd88830b0d10c88f0ce066b07ae">close</a>();</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>                     RES-&gt;<a class="code hl_function" href="classfemus_1_1_numeric_vector.html#a80eb1dc1f53018fd7d08bcc4a511cc09">close</a>();</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>  </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>  </div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>  </div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>    <span class="comment">//print JAC and RES to files</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="comment">//     const unsigned nonlin_iter = mlPdeSys-&gt;GetNonlinearIt();</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span><span class="comment">//     assemble_jacobian&lt; real_num_mov,double &gt;::print_global_jacobian(assembleMatrix, ml_prob, JAC, nonlin_iter);</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="comment">//     assemble_jacobian&lt; real_num_mov,double &gt;::print_global_residual(ml_prob, RES, nonlin_iter);</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span> </div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>  </div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>}</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span> </div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span> </div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span> </div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> real_num &gt; </div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span><span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_solution.html">MultiLevelSolution</a>  <a class="code hl_function" href="class_solution__generation__1.html#a2a0001fac52be7a97cc9cc3c901c5f9f">Solution_generation_1&lt; real_num &gt;::run_on_single_level</a>(<a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a> &amp; ml_prob,</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>                                                                                <a class="code hl_class" href="classfemus_1_1_multi_level_mesh.html">MultiLevelMesh</a> &amp; ml_mesh,</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>                                                                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> lev,</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                                                                                <span class="keyword">const</span> std::vector&lt; Unknown &gt; &amp;  unknowns,</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>                                                                                <span class="keyword">const</span> std::vector&lt; <a class="code hl_class" href="classfemus_1_1_math_1_1_function.html">Math::Function&lt; double &gt;</a> * &gt; &amp;  exact_sol,</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                                                                                <span class="keyword">const</span> <a class="code hl_typedef" href="classfemus_1_1_multi_level_solution.html#a51e1cff061477ba02672e5ef790c465f">MultiLevelSolution::InitFuncMLProb</a> SetInitialCondition_in,</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>                                                                                <span class="keyword">const</span> <a class="code hl_typedef" href="classfemus_1_1_multi_level_solution.html#ac2ecfa36125c8626b6fdf20f71dbde0c">MultiLevelSolution::BoundaryFuncMLProb</a> SetBoundaryCondition_in,</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>                                                  <span class="keyword">const</span> <span class="keywordtype">bool</span> equation_sol</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>                                                                                )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>                                                                                    </div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>                                                                                    </div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>  <span class="comment">// ======= Mesh  ==================</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>            <span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> = lev + 1;  <span class="comment">//this has to have a + 1 for the convergence study</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>            <span class="keywordtype">unsigned</span> numberOfSelectiveLevels = 0;</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>            ml_mesh.<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#a06c4fe014434c2bafdd2c6e94e018620">RefineMesh</a>(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> , <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> + numberOfSelectiveLevels, NULL);</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>            ml_mesh.<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#ac474afe18c6be4e181b2bb72695f57e9">EraseCoarseLevels</a>(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> - 1);</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span> </div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>            ml_mesh.<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#a09c12975f18035d5369ae411c0208648">PrintInfo</a>();</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>                                                                                    </div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>  <span class="comment">// ======= Solution  ==================</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>  <a class="code hl_class" href="classfemus_1_1_multi_level_solution.html">MultiLevelSolution</a> ml_sol(&amp;ml_mesh);</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>  ml_sol.SetWriter(<a class="code hl_enumvalue" href="_writer_enum_8hpp.html#a18b827c3c1f62b8a57febdcad0c871a8a37fb55ddbbe1465cec5f3d154db73e67">VTK</a>);</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>  ml_sol.GetWriter()-&gt;SetDebugOutput(<span class="keyword">true</span>);</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>  </div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>  <span class="comment">// ======= Problem ========================</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>  ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#ad86fcf047c83e4a719e09455a2fa247a">SetMultiLevelMeshAndSolution</a>(&amp; ml_sol);</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>  </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>  ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#adf745f778b0a76c7a748da2f65de99b3">get_systems_map</a>().clear();</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span> </div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>  <span class="comment">//material  ==================</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>              <span class="comment">//Adimensional quantity (Lref,Uref)</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>            <span class="keywordtype">double</span> Lref = 1.;</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>            <span class="keywordtype">double</span> Uref = 1.;</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>           <span class="comment">// *** apparently needed by non-AD assemble only **********************</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>            <span class="comment">// add fluid material</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>            <a class="code hl_class" href="classfemus_1_1_parameter.html">Parameter</a> par(Lref,Uref);</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>            </div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>            <span class="comment">// Generate Solid Object</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>            <span class="keywordtype">double</span> E = <a class="code hl_define" href="solidopt__params_8hpp.html#a9bdeca9b39b7e230510d2b7362e0115a">YOUNGS_MODULUS</a>;</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>            <span class="keywordtype">double</span> ni = <a class="code hl_define" href="solidopt__params_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a>;</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>            <span class="keywordtype">double</span> rhos = <a class="code hl_define" href="solidopt__params_8hpp.html#ac21b807d42c30aa7ebaa6a45a78134bd">SOLID_DENSITY</a>;</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>            <a class="code hl_class" href="classfemus_1_1_solid.html">Solid</a> solid;</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>            solid = <a class="code hl_class" href="classfemus_1_1_solid.html">Solid</a>(par,E,ni,rhos,<a class="code hl_define" href="00__solid__state_8cpp.html#a7c60e913478d07a44ac15c6fb2c5937f">MODEL</a>);</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>            std::cout &lt;&lt; <span class="stringliteral">&quot;Solid properties: &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>            std::cout &lt;&lt; solid &lt;&lt; std::endl;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>            </div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>            </div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>            ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a537b31965e5402b9c9febebce96ce01c">parameters</a>.<a class="code hl_function" href="classfemus_1_1_parameters.html#a552a70edef7b7d9119b1cd4797af776b">set</a>&lt;<a class="code hl_class" href="classfemus_1_1_solid.html">Solid</a>&gt;(<span class="stringliteral">&quot;Solid&quot;</span>) = solid;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>  <span class="comment">//end material  ==================</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>  <span class="comment">// ======= Solution, II ==================</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span> </div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>  ml_sol.AttachSetBoundaryConditionFunction(SetBoundaryCondition_in);</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; u &lt; unknowns.size(); u++)  { </div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>      ml_sol.AddSolution(unknowns[u]._name.c_str(), unknowns[u]._fe_family, unknowns[u]._fe_order, unknowns[u]._time_order, unknowns[u]._is_pde_unknown);</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>      ml_sol.Initialize(unknowns[u]._name.c_str(), SetInitialCondition_in, &amp;ml_prob);</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>      ml_sol.GenerateBdc(unknowns[u]._name.c_str(), <span class="stringliteral">&quot;Steady&quot;</span>, &amp; ml_prob);</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>  }</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>  </div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>  <span class="comment">// ======= System ========================</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>  <a class="code hl_class" href="classfemus_1_1_non_linear_implicit_system.html">NonLinearImplicitSystem</a>&amp; system = ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#ad54bc6b7254d2331491ac48b58a2d9e3">add_system</a> &lt; <a class="code hl_class" href="classfemus_1_1_non_linear_implicit_system.html">NonLinearImplicitSystem</a> &gt; (<span class="stringliteral">&quot;SolidMech&quot;</span>);</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span> </div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> u = 0; u &lt; unknowns.size(); u++)   system.<a class="code hl_function" href="classfemus_1_1_system.html#a606e07526d7a0d31eed638404ee2ed24">AddSolutionToSystemPDE</a>(unknowns[u]._name.c_str());</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span> </div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>  system.<a class="code hl_function" href="classfemus_1_1_system.html#ae3c161c5a12d55227effe9acf01b6535">set_unknown_list_for_assembly</a>(unknowns); </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>            </div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>  system.<a class="code hl_function" href="classfemus_1_1_system.html#a42a5b5b5d2c7673b1d4c896762d8db9e">SetAssembleFunction</a>( AssembleSolidMech&lt; NonLinearImplicitSystem, adept::adouble, adept::adouble &gt;);</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span> </div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>  <span class="comment">// initialize and solve the system</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>  system.<a class="code hl_function" href="classfemus_1_1_non_linear_implicit_system.html#ad2d20975e0c919a9d99bdd9368a0212a">init</a>();</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>  </div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>  <span class="comment">// Solver and preconditioner</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>  system.<a class="code hl_function" href="classfemus_1_1_linear_implicit_system.html#ad0a0195fe959aca497e2a7251b43405b">SetOuterSolver</a>(<a class="code hl_enumvalue" href="_solvertype_enum_8hpp.html#a8b06041d7c1fb05f379714f4312306ecaac04ac264cd7722642583eccd43a75ab">PREONLY</a>);</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>  system.<a class="code hl_function" href="classfemus_1_1_linear_implicit_system.html#a03b082409d094d87e46e023356c4cb8e">SetSolverFineGrids</a>(<a class="code hl_enumvalue" href="_solvertype_enum_8hpp.html#a8b06041d7c1fb05f379714f4312306ecaac04ac264cd7722642583eccd43a75ab">PREONLY</a>);</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>  system.<a class="code hl_function" href="classfemus_1_1_linear_implicit_system.html#aaff342b69e3dd0e77a1bc084030f795c">SetPreconditionerFineGrids</a>(<a class="code hl_enumvalue" href="_precondtype_enum_8hpp.html#a8b341faac6531c4543c9dc6e5e4592cfad035adc4d5a17adbb5db52fa62a98f88">LU_PRECOND</a>);</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span> </div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>  <span class="comment">//for Vanka   </span></div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>  system.<a class="code hl_function" href="classfemus_1_1_linear_implicit_system.html#a71658025becd1238e92318c950792b4b">ClearVariablesToBeSolved</a>();</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>  system.<a class="code hl_function" href="classfemus_1_1_linear_implicit_system.html#ab0c6f96601a00ae5f20a44bd137592b8">AddVariableToBeSolved</a>(<span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span> </div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>  system.<a class="code hl_function" href="classfemus_1_1_non_linear_implicit_system.html#ad263ecc83efc0d9ea26200bfa3c4cadf">SetDebugNonlinear</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>  </div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span><span class="comment">// // //   system.SetDebugFunction( ComputeIntegral&lt; NonLinearImplicitSystem, adept::adouble, adept::adouble &gt;);   </span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span><span class="comment"></span> </div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span><span class="comment">//   system.SetMaxNumberOfNonLinearIterations(3);</span></div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span><span class="comment">//   system.SetNonLinearConvergenceTolerance(1.e-2);</span></div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span><span class="comment">//   system.SetDebugLinear(true);</span></div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span><span class="comment">//   system.SetMaxNumberOfLinearIterations(4);</span></div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span><span class="comment">//   system.SetAbsoluteLinearConvergenceTolerance(1.e-10);</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span> </div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>  system.<a class="code hl_function" href="classfemus_1_1_non_linear_implicit_system.html#a438462e18c01e8fb08358526c04c50b5">MGsolve</a>();</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span> </div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>  <span class="comment">// ======= Print ========================</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>  std::vector &lt; std::string &gt; displ;</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>  displ.push_back(<span class="stringliteral">&quot;DX&quot;</span>);</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>  displ.push_back(<span class="stringliteral">&quot;DY&quot;</span>);</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>  <span class="keywordflow">if</span> ( ml_mesh.<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#a65dabdf1e308c1a44ebe5c6a41d09284">GetDimension</a>() == 3 ) displ.push_back(<span class="stringliteral">&quot;DZ&quot;</span>);</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>  </div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>  <span class="comment">// set DX as moving variable</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>  ml_sol.GetWriter()-&gt;SetMovingMesh(displ);</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>  </div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>  <span class="comment">// print solutions</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>  std::vector &lt; std::string &gt; variablesToBePrinted;  variablesToBePrinted.push_back(<span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>  ml_sol.GetWriter()-&gt;Write(ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a274e91e352c0d6b69c5925fdfca67d1f">GetFilesHandler</a>()-&gt;<a class="code hl_function" href="classfemus_1_1_files.html#acf59b68932959fe552a95acc362c3920">GetOutputPath</a>(),<span class="stringliteral">&quot;biquadratic&quot;</span>, variablesToBePrinted, lev);</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span> <span class="keywordflow">return</span> ml_sol;</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span> </div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>}</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span> </div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov = <span class="keywordtype">double</span> &gt;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#ad6b2e165d5cf19933c60a49927c5bf64"> 1300</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#ad6b2e165d5cf19933c60a49927c5bf64">ComputeIntegral</a>(<span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob) {</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>    ComputeIntegral&lt; system_type, real_num, real_num_mov &gt; (  ml_prob, </div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>                                                            &amp; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a3d90edba93be2c202ea2bf8e87e20854">get_system</a>&lt; system_type &gt;(0), </div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>                                                              ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a3d90edba93be2c202ea2bf8e87e20854">get_system</a>&lt; system_type &gt;(0).get_unknown_list_for_assembly());</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>}</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span> </div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span><span class="keyword">template</span> &lt; <span class="keyword">class</span> system_type, <span class="keyword">class</span> real_num, <span class="keyword">class</span> real_num_mov = <span class="keywordtype">double</span> &gt;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"><a class="line" href="01__solid__control__boundary_8cpp.html#a2b4961693657f83b36edc7f4e2e17de6"> 1307</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#ad6b2e165d5cf19933c60a49927c5bf64">ComputeIntegral</a>(<span class="keyword">const</span> <a class="code hl_class" href="classfemus_1_1_multi_level_problem.html">MultiLevelProblem</a>&amp; ml_prob,</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>                     <span class="keyword">const</span> system_type * mlPdeSys,</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>                     <span class="keyword">const</span> std::vector&lt; Unknown &gt; &amp; unknowns) {</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span> </div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>        level       = mlPdeSys-&gt;GetLevelToAssemble();</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span> </div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>  <a class="code hl_class" href="classfemus_1_1_mesh.html">Mesh</a>*                 msh         = ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_mesh.html#af0dec057961b41903215bb9927cbfeed">GetLevel</a>(level);</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>  <a class="code hl_class" href="classfemus_1_1elem.html">elem</a>*                 el          = msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a62689335aebc9de69b7490bfb32f0978">el</a>;</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span> </div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>  <a class="code hl_class" href="classfemus_1_1_multi_level_solution.html">MultiLevelSolution</a>*       ml_sol  = ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>;</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>  <a class="code hl_class" href="classfemus_1_1_solution.html">Solution</a>*             sol         = ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_solution.html#a9bb3681ff25b06b030d75b1ab1bdfdc3">GetSolutionLevel</a>(level); </div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span> </div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span> </div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>    <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a6f753fa456d2313d902bf184c4bb9e3b">GetDimension</a>();</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>   dim2  = (3 * (<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1) + !(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1));</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>  iproc  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_parallel_object.html#a6438b3ffcc8cde2d6ccfb4ec563dfce1">processor_id</a>();</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>  <span class="comment">// reserve memory for the local standard vectors</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> max_size_elem_dofs = <span class="keyword">static_cast&lt;</span> <span class="keywordtype">unsigned</span> <span class="keyword">&gt;</span>(ceil(pow(3, <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)));          <span class="comment">// conservative: based on line3, quad9, hex27 </span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>  </div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>  <span class="comment">//----------- unknowns ------------------------------</span></div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_unknowns = mlPdeSys-&gt;GetSolPdeIndex().size();</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>   </div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> sol_index_displ      = 0;     <span class="comment">//known at compile time</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_press      = sol_index_displ + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>;      <span class="comment">//known at run time</span></div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> state_pos_begin      = sol_index_displ;   <span class="comment">//known at compile time</span></div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> adj_pos_begin        = <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + 1;</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_adj        = adj_pos_begin;      </div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_press_adj  = sol_index_adj + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>;     </div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> ctrl_pos_begin       = 2 * (<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + 1);</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> sol_index_ctrl       = ctrl_pos_begin;     </div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>  <span class="keyword">const</span>     <span class="keywordtype">int</span> theta_index = sol_index_ctrl + <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>;      </div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span> </div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>  </div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>  vector &lt; std::string &gt; Solname(n_unknowns);     </div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>  vector &lt; unsigned int &gt; SolIndex(n_unknowns);  </div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>  vector &lt; unsigned int &gt; SolPdeIndex(n_unknowns);</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>  vector &lt; unsigned int &gt; SolFEType(n_unknowns);  </div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span> </div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span> </div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar=0; ivar &lt; n_unknowns; ivar++) {</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>       Solname[ivar]    = unknowns[ivar]._name; </div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>      SolIndex[ivar]    = ml_sol-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_solution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>        (Solname[ivar].c_str());</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="comment">//     SolPdeIndex[ivar]    = mlPdeSys-&gt;GetSolPdeIndex(Solname[ivar].c_str());</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span><span class="comment">//       assert(ivar == SolPdeIndex[ivar]);  //I would like this ivar order to coincide either with SolIndex or with SolPdeIndex, otherwise too many orders... it has to be  with SolPdeIndex, because SolIndex is related to the Solution object which can have more fields... This has to match the order of the unknowns[] argument</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>    SolFEType[ivar] = ml_sol-&gt;<a class="code hl_function" href="classfemus_1_1_multi_level_solution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>(SolIndex[ivar]);<span class="comment">//</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>  }</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span> </div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>   <span class="keyword">constexpr</span> <span class="keywordtype">int</span> solFEType_max = <a class="code hl_define" href="_f_e_type_enum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>;  <span class="comment">//biquadratic, this is the highest-order FE </span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span> </div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>   vector &lt; unsigned int &gt; Sol_n_el_dofs(n_unknowns);</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>  </div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>  <span class="comment">//----------- of dofs and at quadrature points ------------------------------</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>  vector &lt; vector &lt; double &gt; &gt; phi_dof_qp(n_unknowns);</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_x_dof_qp(n_unknowns);   <span class="comment">//the derivatives depend on the Jacobian, which depends on the unknown, so we have to be adept here  //some of these should be real_num, some real_num_mov...</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_xx_dof_qp(n_unknowns);  <span class="comment">//the derivatives depend on the Jacobian, which depends on the unknown, so we have to be adept here</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>  vector &lt; vector &lt; double &gt; &gt; phi_hat_dof_qp(n_unknowns);</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>  vector &lt; vector &lt; double &gt; &gt; phi_x_hat_dof_qp(n_unknowns);</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>  vector &lt; vector &lt; double &gt; &gt; phi_xx_hat_dof_qp(n_unknowns);</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span> </div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> unk=0; unk &lt; n_unknowns; unk++) {  </div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>        phi_dof_qp[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    phi_hat_dof_qp[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>      phi_x_dof_qp[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>  phi_x_hat_dof_qp[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>     phi_xx_dof_qp[unk].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span> phi_xx_hat_dof_qp[unk].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>   }</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>   </div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span><span class="comment">//----------boundary shape functions----------------------  </span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>  vector &lt; vector &lt; double &gt; &gt; phi_hat_bd_dof_qp(n_unknowns);</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>  vector &lt; vector &lt; double &gt; &gt; phi_hat_bd_x_dof_qp(n_unknowns);</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span> </div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span> </div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> unk=0; unk &lt; n_unknowns ; unk++) {  </div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>        phi_hat_bd_dof_qp[unk].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>      phi_hat_bd_x_dof_qp[unk].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    }</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span> </div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>  <span class="comment">//----------- at dofs ------------------------------</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>  vector &lt; vector &lt; real_num &gt; &gt; SolVAR_eldofs(n_unknowns);  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0; k &lt; n_unknowns; k++) { SolVAR_eldofs[k].reserve(max_size_elem_dofs); }</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span> </div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span> </div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>  <span class="comment">// geometry (at dofs) --------------------------------//</span></div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>  vector&lt; vector &lt; real_num_mov &gt; &gt;   coords(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>  vector  &lt; vector  &lt; double &gt; &gt;  coords_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>  vector  &lt; vector  &lt; double &gt; &gt;  coords_hat_bd(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>  <span class="keywordtype">unsigned</span> coordsType = <a class="code hl_define" href="_f_e_type_enum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>; <span class="comment">// get the finite element type for &quot;x&quot;, it is always 2 (LAGRANGE TENSOR-PRODUCT-QUADRATIC)</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; i++) {   </div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>           coords[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>       coords_hat[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    coords_hat_bd[i].reserve(max_size_elem_dofs); </div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span> }</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span> <span class="comment">//************** geometry phi **************************</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>  vector &lt; vector &lt; double &gt; &gt; phi_dof_qp_domain(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_x_dof_qp_domain(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>  vector &lt; vector &lt; real_num_mov &gt; &gt; phi_xx_dof_qp_domain(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>  vector &lt; vector &lt; double &gt; &gt; phi_dof_qp_domain_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>  vector &lt; vector &lt; double &gt; &gt; phi_x_dof_qp_domain_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>  vector &lt; vector &lt; double &gt; &gt; phi_xx_dof_qp_domain_hat(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span> </div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> dom_coord = 0; dom_coord &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; dom_coord++) {</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>        phi_dof_qp_domain[dom_coord].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>      phi_x_dof_qp_domain[dom_coord].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>     phi_xx_dof_qp_domain[dom_coord].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>        phi_dof_qp_domain_hat[dom_coord].reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>      phi_x_dof_qp_domain_hat[dom_coord].reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>     phi_xx_dof_qp_domain_hat[dom_coord].reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>   }</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span> </div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>   <span class="comment">// geometry ------------------------------------------</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>  </div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span> </div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>  <span class="comment">//------------ at quadrature points ---------------------</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>  real_num_mov weight_qp = 0.;<span class="comment">//</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>    <span class="keywordtype">double</span> weight_hat_qp = 0.;</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>    <span class="keywordtype">double</span> weight_hat_bd_qp = 0.;</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>    vector &lt; real_num &gt; SolVAR_qp(n_unknowns);</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>    vector &lt; real_num &gt; SolVAR_hat_qp(n_unknowns);</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>    vector &lt; vector &lt; real_num &gt; &gt; gradSolVAR_qp(n_unknowns);</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>    vector &lt; vector &lt; real_num &gt; &gt; gradSolVAR_hat_qp(n_unknowns);</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0; k &lt; n_unknowns; k++) { </div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>          gradSolVAR_qp[k].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>      gradSolVAR_hat_qp[k].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>    }</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>      </div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span> </div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span> </div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span><span class="comment">// Displ_desired##################################################################</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>  vector &lt; double &gt; phi_des_dof_qp;</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>  vector &lt; real_num_mov &gt; phi_des_x_dof_qp;   <span class="comment">//the derivatives depend on the Jacobian, which depends on the unknown, so we have to be adept here  //some of these should be real_num, some real_num_mov...</span></div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>  vector &lt; real_num_mov &gt; phi_des_xx_dof_qp;  </div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span> </div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>  vector &lt; double &gt; phi_des_hat_dof_qp;</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>  vector &lt; double &gt; phi_des_x_hat_dof_qp;</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>  vector &lt; double &gt; phi_des_xx_hat_dof_qp;</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span> </div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>        phi_des_dof_qp.reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>      phi_des_x_dof_qp.reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>     phi_des_xx_dof_qp.reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>    phi_des_hat_dof_qp.reserve(max_size_elem_dofs);</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>  phi_des_x_hat_dof_qp.reserve(max_size_elem_dofs * <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span> phi_des_xx_hat_dof_qp.reserve(max_size_elem_dofs * dim2);</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>   </div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>   </div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>  vector &lt; real_num &gt;  SolDisp_eldofs(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>,0.);</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>  vector &lt; real_num &gt; SolDisp_des_qp(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>, 0.);  </div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>  </div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>  vector &lt; real_num &gt; SolDisp_des_hat_qp(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>, 0.);  </div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span><span class="comment">// Displ_desired##################################################################</span></div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span> </div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span> </div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span> </div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span> </div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>real_num  integral_target_alpha = 0.;</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>real_num    integral_beta   = 0.;</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>real_num    integral_gamma  = 0.;</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>real_num   integral_g_dot_n = 0.;</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>  <span class="comment">// element loop: each process loops only on the elements that owns</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iel = msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">_elementOffset</a>[iproc]; iel &lt; msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">_elementOffset</a>[iproc + 1]; iel++) {</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span> </div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span> </div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>   <span class="comment">//all vars ###################################################################  </span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>    <span class="keywordtype">unsigned</span> ndofs_unk = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, SolFEType[k]);</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>       Sol_n_el_dofs[k] = ndofs_unk;</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>       SolVAR_eldofs[k].resize(Sol_n_el_dofs[k]);</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; SolVAR_eldofs[k].size(); i++) {</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>       <span class="keywordtype">unsigned</span> solDof = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, SolFEType[k]);</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>       SolVAR_eldofs[k][i] = (*sol-&gt;<a class="code hl_variable" href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[SolIndex[k]])(solDof);</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>      }</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>    }</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>   <span class="comment">//all vars ###################################################################</span></div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>  </div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>    </div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>  <span class="comment">// geometry *****************************</span></div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>    <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> ielGeom = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#af92bd9944b1d887562b460ede06acf44">GetElementType</a>(iel);</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span> </div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>      <span class="keywordtype">unsigned</span> nDofsX = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, coordsType);    <span class="comment">// number of coordinate element dofs</span></div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>    </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ivar=0; ivar&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar++) {</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>      coords[ivar].resize(nDofsX);</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>      coords_hat[ivar].resize(nDofsX);</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>    }</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>    </div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>   <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0; i &lt; nDofsX; i++) {</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>      <span class="keywordtype">unsigned</span> coordsDof  = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, coordsType);    <span class="comment">// global to global mapping between coordinates node and coordinate dof // via local to global solution node</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar = 0; ivar &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar++) {</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>          <span class="comment">//Fixed coordinates (Reference frame)</span></div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>    coords_hat[ivar][i] = (*msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">_topology</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[ivar])(coordsDof);</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>      }</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>    }</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span> </div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>  <span class="comment">//***************************************  </span></div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>    assert(nDofsX == Sol_n_el_dofs[sol_index_displ]);</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>    <span class="comment">//Moving coordinates (Moving frame)</span></div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> idim = 0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; nDofsX; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>          coords[idim][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = coords_hat[idim][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] + SolVAR_eldofs[SolIndex[idim]][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>];</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>        }</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>      }</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>  </div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>     <span class="comment">// elem average point </span></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    vector &lt; double &gt; elem_center(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);   </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = 0.;  }</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  </div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nDofsX; i++) {</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>         elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] += coords_hat[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>][i];</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>       }</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>    }</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>    </div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) { elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = elem_center[<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>]/nDofsX; }</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>  <span class="comment">//*************************************** </span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>  </div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>  <span class="comment">//***** set target domain flag ********************************** </span></div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>   <span class="keywordtype">int</span> target_flag = 0;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>   target_flag = ElementTargetFlag &lt; double &gt;(elem_center); <span class="comment">//domain is considered wrt moving</span></div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span> </div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>  <span class="comment">// geometry end *****************************</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span> </div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span> <span class="comment">//************ set control flag *********************</span></div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>    <span class="keywordtype">int</span> control_el_flag = 0;</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>        control_el_flag = <a class="code hl_function" href="solidopt__params_8hpp.html#a1dffa717bb8f2e25ad41baaf598c703f">ControlDomainFlag</a>(elem_center);</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>    std::vector&lt; std::vector&lt;int&gt; &gt; control_node_flag(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> idim=0; idim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) {</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>              control_node_flag[idim].resize(Sol_n_el_dofs[ctrl_pos_begin]);</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    std::fill(control_node_flag[idim].begin(), control_node_flag[idim].end(), 0);</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>        }</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span> <span class="comment">//*************************************************** </span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>  </div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span> </div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>  <span class="comment">//DESIRED DISPL###################################################################  </span></div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>    <span class="comment">// displacement ************</span></div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span><span class="comment">//     for (unsigned i = 0; i &lt; Sol_n_el_dofs[sol_index_displ]; i++) {</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span><span class="comment">//       unsigned solDdesDof = msh-&gt;GetSolutionDof(i, iel, solDType);    // global to global mapping between solution node and solution dof</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span> </div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; SolDisp_eldofs.size() <span class="comment">/*dim*/</span>; k++) {</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>        SolDisp_eldofs[k]<span class="comment">/*[i]*/</span> = <a class="code hl_variable" href="solidopt__params_8hpp.html#a80e1487a07155d5b24edd6eca186b73b">TargetDisp</a>[k] <span class="comment">/*(*sol-&gt;_Sol[solDIndex[k]])(solDdesDof)*/</span>;      <span class="comment">// global extraction and local storage for the solution</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>      }</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span><span class="comment">//     }</span></div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span> <span class="comment">//DESIRED DISPL###################################################################</span></div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span> </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span> <span class="comment">//========BoundaryLoop=====================================================================</span></div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span> </div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>  <span class="comment">// Perform face loop over elements that contain some control face</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>  <span class="keywordflow">if</span> (control_el_flag == 1) {</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>      </div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>      <span class="keywordtype">double</span> tau = 0.;</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>      vector &lt; double &gt; normal(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>,0);</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>      </div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> jface = 0; jface &lt; msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a5a0c1124aca095fd4327252ebac3660f">GetElementFaceNumber</a>(iel); jface++) {</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>      std::vector &lt; double &gt; xyz_bdc(3,0.);  <span class="comment">//not being used, because the boundaries are identified by the face numbers</span></div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>      <span class="comment">// look for boundary faces</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>      <span class="keywordflow">if</span>(el-&gt;<a class="code hl_function" href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">GetFaceElementIndex</a>(iel,jface) &lt; 0) {</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> face = -( msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a62689335aebc9de69b7490bfb32f0978">el</a>-&gt;<a class="code hl_function" href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">GetFaceElementIndex</a>(iel,jface)+1);</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>          <span class="keywordflow">if</span>(  face == <a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a>) { <span class="comment">//control face</span></div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span><span class="comment">//=================================================== </span></div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>        <span class="keywordtype">unsigned</span> nve_bd = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#af372596998e5d55a1fa15d6c5f58f52b">GetElementFaceDofNumber</a>(iel,jface, SolFEType[ctrl_pos_begin] ); <span class="comment">//AAAAAAAAAAAAAAAAA</span></div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> felt_bd = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#a57f92951660269429cc7f04ee3c26c17">GetElementFaceType</a>(iel, jface);    </div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0; i &lt; nve_bd; i++) {</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i);</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>            <span class="keywordtype">unsigned</span>      iDof = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i_vol, iel, coordsType);</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> idim=0; idim&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; idim++) { coords_hat_bd[idim][i]=(*msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">_topology</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[idim])(iDof); }</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>        }</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>        </div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span><span class="comment">//========= initialize gauss quantities on the boundary ============================================</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>        vector &lt; real_num &gt;                      SolVAR_bd_qp(n_unknowns);</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>        vector &lt; vector &lt; real_num &gt; &gt;       gradSolVAR_bd_qp(n_unknowns);</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;n_unknowns; k++) {    gradSolVAR_bd_qp[k].resize(<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);  }</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span> </div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span><span class="comment">//========= gauss_loop boundary===============================================================</span></div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ig_bd=0; ig_bd &lt; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a34890e6aa9d88946571fa050ee544c39">GetQuadratureRule</a>(felt_bd).GetGaussPointsNumber(); ig_bd++) {</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>              ml_prob.<a class="code hl_variable" href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code hl_variable" href="classfemus_1_1_multi_level_mesh.html#ad59554c65099f852ba8797f09bc40227">_finiteElement</a>[felt_bd][SolFEType[ctrl_pos_begin]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a41bf5e7188a121649319194e846e533f">JacobianSur</a>(coords_hat_bd,ig_bd,weight_hat_bd_qp,phi_hat_bd_dof_qp[kdim + ctrl_pos_begin],phi_hat_bd_x_dof_qp[kdim + ctrl_pos_begin],normal);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>            }</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>            </div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span> <a class="code hl_function" href="01__solid__control__boundary_8cpp.html#abdd1e0dbfc8ed6ec0a237d9654d0bce9">set_phi_gradient_surface</a>(<a class="code hl_define" href="01__solid__control__boundary_8cpp.html#a668a0b03c0385e061dad5178865e3b99">AXIS_DIRECTION_CONTROL_SIDE</a>, msh, ig_bd, SolFEType, felt_bd, nve_bd, coords_hat_bd, phi_hat_bd_x_dof_qp, <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>, ctrl_pos_begin);</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>            </div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>          </div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span><span class="comment">//========== compute gauss quantities on the boundary ===============================================</span></div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctrl_index = kdim + ctrl_pos_begin;</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>                                          SolVAR_bd_qp[ SolPdeIndex[ctrl_index] ] = 0.;</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>              <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2=0; ivar2&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++) {  gradSolVAR_bd_qp[ SolPdeIndex[ctrl_index] ][ivar2] = 0.; }</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>            }<span class="comment">//kdim</span></div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>      </div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  kdim = 0; kdim &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; kdim++) {</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ctrl_index = kdim + ctrl_pos_begin;</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i_bd = 0; i_bd &lt; nve_bd; i_bd++) {</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>                          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_vol = msh-&gt;<a class="code hl_function" href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">GetLocalFaceVertexIndex</a>(iel, jface, i_bd);</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>                        SolVAR_bd_qp[SolPdeIndex[ctrl_index]]   += phi_hat_bd_dof_qp  [ ctrl_index ][i_bd] * SolVAR_eldofs[ SolPdeIndex[ ctrl_index ] ][i_vol];</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>              <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2=0; ivar2&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++) {  </div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>                      gradSolVAR_bd_qp[SolPdeIndex[ctrl_index]][ivar2]  += phi_hat_bd_x_dof_qp[ ctrl_index ][i_bd + ivar2 * nve_bd] * SolVAR_eldofs[ SolPdeIndex[ ctrl_index ] ][i_vol];      </div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>                }</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>              }</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>            }<span class="comment">//kdim</span></div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span> <span class="comment">//end unknowns eval at gauss points ********************************</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span> </div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span> <span class="comment">//========== compute gauss quantities on the boundary ================================================</span></div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; k++) {</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        integral_beta    += SolVAR_bd_qp[SolPdeIndex[k + ctrl_pos_begin]] * SolVAR_bd_qp[SolPdeIndex[k + ctrl_pos_begin]] * weight_hat_bd_qp;</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        integral_g_dot_n += SolVAR_bd_qp[SolPdeIndex[k + ctrl_pos_begin]] * normal[k] * weight_hat_bd_qp; </div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>      }</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; k++) {</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {   </div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>        integral_gamma    += gradSolVAR_bd_qp[SolPdeIndex[k + ctrl_pos_begin]][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] * gradSolVAR_bd_qp[SolPdeIndex[k + ctrl_pos_begin]][<a class="code hl_variable" href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] * weight_hat_bd_qp;</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>            }</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>      }</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>          </div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span> </div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>                }  <span class="comment">//end ig_bdry loop</span></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>      </div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>             }    <span class="comment">//end if control face</span></div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>     }  <span class="comment">//end if boundary faces</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>      }  <span class="comment">// loop over element faces //jface   </span></div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>  } <span class="comment">//end if control element flag</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span> </div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span> </div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>     <span class="comment">// *** Gauss point loop ***</span></div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> = 0; <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> &lt; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a34890e6aa9d88946571fa050ee544c39">GetQuadratureRule</a>(ielGeom).GetGaussPointsNumber(); <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>++) {</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span> </div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>    <span class="comment">// *** get Jacobian and test function and test function derivatives ***</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> unk=0; unk &lt; n_unknowns; unk++) {</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>    msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[unk]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords,    <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>,weight_qp,    phi_dof_qp[unk],    phi_x_dof_qp[unk],    phi_xx_dof_qp[unk]);</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>    msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[unk]]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_hat,<a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>,weight_hat_qp,phi_hat_dof_qp[unk],phi_x_hat_dof_qp[unk],phi_xx_hat_dof_qp[unk]);</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>      }</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>      </div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>   <span class="comment">//=============== Integration at qp ========================================</span></div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>         <span class="comment">//HAVE TO RECALL IT TO HAVE BIQUADRATIC JACOBIAN...</span></div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>         msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][coordsType]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords,    <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_qp,    phi_dof_qp_domain[d],     phi_x_dof_qp_domain[d],     phi_xx_dof_qp_domain[d]);</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>         msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][coordsType]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_hat,<a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_hat_qp,phi_dof_qp_domain_hat[d], phi_x_dof_qp_domain_hat[d], phi_xx_dof_qp_domain_hat[d]);</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>      }</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>     </div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>  <span class="comment">//begin unknowns eval at gauss points ********************************</span></div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> unk = 0; unk &lt;  n_unknowns; unk++) {</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>      SolVAR_qp[SolPdeIndex[unk]] = 0.;</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>      SolVAR_hat_qp[SolPdeIndex[unk]] = 0.;</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span> </div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2=0; ivar2&lt;<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++){ </div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>        gradSolVAR_qp[SolPdeIndex[unk]][ivar2] = 0.; </div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>        gradSolVAR_hat_qp[SolPdeIndex[unk]][ivar2] = 0.; </div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>      }</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>    }</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>      </div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> unk = 0; unk &lt;  n_unknowns; unk++) {</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[unk]; i++) {</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>        SolVAR_qp[SolPdeIndex[unk]]    += phi_dof_qp[ unk ][i] * SolVAR_eldofs[SolPdeIndex[unk]][i];</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>        SolVAR_hat_qp[SolPdeIndex[unk]]    += phi_hat_dof_qp[ unk ][i] * SolVAR_eldofs[SolPdeIndex[unk]][i];</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar2 = 0; ivar2 &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; ivar2++) {</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>          gradSolVAR_qp[SolPdeIndex[unk]][ivar2]     += phi_x_dof_qp[ unk ][i*<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>+ivar2] * SolVAR_eldofs[SolPdeIndex[unk]][i]; </div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>          gradSolVAR_hat_qp[SolPdeIndex[unk]][ivar2] += phi_x_hat_dof_qp[ unk ][i*<a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>+ivar2] * SolVAR_eldofs[SolPdeIndex[unk]][i]; </div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>        }</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>      }</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>      </div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>    }  </div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span> <span class="comment">//end unknowns eval at gauss points ********************************</span></div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span> </div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>    msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[sol_index_displ]  <span class="comment">/*SolDisp_eldofs*/</span>]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords, <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_qp, phi_des_dof_qp, phi_des_x_dof_qp, phi_des_xx_dof_qp);</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>    msh-&gt;<a class="code hl_variable" href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[sol_index_displ]  <span class="comment">/*SolDisp_eldofs*/</span>]-&gt;<a class="code hl_function" href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_hat, <a class="code hl_variable" href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_hat_qp, phi_des_hat_dof_qp, phi_des_x_hat_dof_qp, phi_des_xx_hat_dof_qp);</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span> </div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; k++) {      SolDisp_des_qp[k]    = 0.;     }</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    </div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; k++) {</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[sol_index_displ]; i++) {</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>                SolDisp_des_qp[k] += SolDisp_eldofs[k]<span class="comment">/*[i]*/</span> * phi_des_dof_qp[i];</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>            SolDisp_des_hat_qp[k] += SolDisp_eldofs[k]<span class="comment">/*[i]*/</span> * phi_des_hat_dof_qp[i];</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>        }</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>      }</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>    </div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>      </div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>          </div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; <a class="code hl_variable" href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; k++) {  </div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>          integral_target_alpha += target_flag * (SolVAR_qp[SolPdeIndex[k]]  - SolDisp_des_qp[k]) * </div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>                                                 (SolVAR_qp[SolPdeIndex[k]]  - SolDisp_des_qp[k]) * weight_qp; </div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>                }</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>   </div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>  </div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>      }<span class="comment">// end gauss point loop</span></div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>    } <span class="comment">//end element loop  </span></div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span> </div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>       std::ostringstream filename_out; filename_out &lt;&lt; ml_prob.<a class="code hl_function" href="classfemus_1_1_multi_level_problem.html#a274e91e352c0d6b69c5925fdfca67d1f">GetFilesHandler</a>()-&gt;<a class="code hl_function" href="classfemus_1_1_files.html#acf59b68932959fe552a95acc362c3920">GetOutputPath</a>() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; <span class="stringliteral">&quot;Integral_computation&quot;</span>  &lt;&lt; <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span> </div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>       std::ofstream intgr_fstream;</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacefemus_1_1paral.html#aaa59cb24784a64914811ba1045135a05">paral::get_rank</a>() == 0 ) {</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>      intgr_fstream.open(filename_out.str().c_str(),std::ios_base::app);</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot; ***************************** Non Linear Iteration &quot;</span>&lt;&lt; mlPdeSys-&gt;GetNonlinearIt() &lt;&lt; <span class="stringliteral">&quot; *********************************** &quot;</span> &lt;&lt;  std::endl &lt;&lt; std::endl;</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot;The value of the target functional for &quot;</span> &lt;&lt; <span class="stringliteral">&quot;alpha &quot;</span> &lt;&lt;   std::setprecision(0) &lt;&lt; std::scientific &lt;&lt; <a class="code hl_variable" href="solidopt__params_8hpp.html#a101671cfe5078b188740d5d892832ea9">cost_functional_coeff</a> &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt;  std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt;  integral_target_alpha &lt;&lt; std::endl;</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot;The value of the L2 control for        &quot;</span> &lt;&lt; <span class="stringliteral">&quot;beta  &quot;</span> &lt;&lt;   std::setprecision(0) &lt;&lt; std::scientific &lt;&lt; <a class="code hl_variable" href="solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a>  &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt;  std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt;  integral_beta         &lt;&lt; std::endl;</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot;The value of the H1 control for        &quot;</span> &lt;&lt; <span class="stringliteral">&quot;gamma &quot;</span> &lt;&lt;   std::setprecision(0) &lt;&lt; std::scientific &lt;&lt; <a class="code hl_variable" href="_conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a> &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> &lt;&lt;  std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt;  integral_gamma        &lt;&lt; std::endl;</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot;The value of the integral of g.n &quot;</span>&lt;&lt;    integral_g_dot_n &lt;&lt; std::endl;</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot;The value of the theta is                             &quot;</span> &lt;&lt;    std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt;  SolVAR_eldofs[SolPdeIndex[theta_index]][0] &lt;&lt; std::endl;</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>      intgr_fstream &lt;&lt; <span class="stringliteral">&quot;The value of the total integral is &quot;</span> &lt;&lt; std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt;  integral_target_alpha * <a class="code hl_variable" href="solidopt__params_8hpp.html#a101671cfe5078b188740d5d892832ea9">cost_functional_coeff</a>*0.5  + integral_beta *<a class="code hl_variable" href="solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a>*0.5 + integral_gamma *<a class="code hl_variable" href="_conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a>*0.5 &lt;&lt; std::endl;</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>      intgr_fstream &lt;&lt;  std::endl;</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>      intgr_fstream.close();  <span class="comment">//you have to close to disassociate the file from the stream</span></div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>}  </div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span> </div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    <span class="keywordflow">return</span>; </div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>      </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>  </div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>}</div>
<div class="ttc" id="a00__solid__state_8cpp_html_a7c60e913478d07a44ac15c6fb2c5937f"><div class="ttname"><a href="00__solid__state_8cpp.html#a7c60e913478d07a44ac15c6fb2c5937f">MODEL</a></div><div class="ttdeci">#define MODEL</div><div class="ttdef"><b>Definition</b> <a href="00__solid__state_8cpp_source.html#l00016">00_solid_state.cpp:16</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a1afc17d1ddb3752caf6910ec9a7c39ef"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a1afc17d1ddb3752caf6910ec9a7c39ef">Solution_set_boundary_conditions</a></div><div class="ttdeci">bool Solution_set_boundary_conditions(const MultiLevelProblem *ml_prob, const std::vector&lt; double &gt; &amp;x, const char SolName[], double &amp;value, const int facename, const double time)</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00083">01_solid_control_boundary.cpp:83</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a480ad40eedfb9ced9d7b090e19b3b85a"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a480ad40eedfb9ced9d7b090e19b3b85a">penalty_outside_control_boundary</a></div><div class="ttdeci">double penalty_outside_control_boundary</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00030">01_solid_control_boundary.cpp:30</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a5dec9191b407f5f1913e563b23777741"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a></div><div class="ttdeci">double Solution_set_initial_conditions(const MultiLevelProblem *ml_prob, const std::vector&lt; double &gt; &amp;x, const char name[])</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00035">01_solid_control_boundary.cpp:35</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a668a0b03c0385e061dad5178865e3b99"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a668a0b03c0385e061dad5178865e3b99">AXIS_DIRECTION_CONTROL_SIDE</a></div><div class="ttdeci">#define AXIS_DIRECTION_CONTROL_SIDE</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00020">01_solid_control_boundary.cpp:20</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a8267a4060045c8116d32a821091e43cd"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a8267a4060045c8116d32a821091e43cd">CTRL_FACE_IDX</a></div><div class="ttdeci">#define CTRL_FACE_IDX</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00025">01_solid_control_boundary.cpp:25</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a92a609d215ec3c30302b119aa0df10f0"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a92a609d215ec3c30302b119aa0df10f0">penalty_ctrl</a></div><div class="ttdeci">double penalty_ctrl</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00031">01_solid_control_boundary.cpp:31</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_a949680fe5298ccbe0a9d804df0b792ee"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#a949680fe5298ccbe0a9d804df0b792ee">theta_value_outside_fake_element</a></div><div class="ttdeci">double theta_value_outside_fake_element</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00032">01_solid_control_boundary.cpp:32</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_abdd1e0dbfc8ed6ec0a237d9654d0bce9"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#abdd1e0dbfc8ed6ec0a237d9654d0bce9">set_phi_gradient_surface</a></div><div class="ttdeci">void set_phi_gradient_surface(const unsigned int axis_direction_control_side, const Mesh *msh, const unsigned int ig_bd, const std::vector&lt; unsigned int &gt; SolFEType, const unsigned int felt_bd, const unsigned int nve_bd, const std::vector&lt; std::vector&lt; double &gt; &gt; &amp;coords_hat_bd, std::vector&lt; std::vector&lt; double &gt; &gt; &amp;phi_hat_bd_x_dof_qp, const unsigned int dim, const unsigned int ctrl_pos_begin)</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00212">01_solid_control_boundary.cpp:212</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_ad6b2e165d5cf19933c60a49927c5bf64"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#ad6b2e165d5cf19933c60a49927c5bf64">ComputeIntegral</a></div><div class="ttdeci">void ComputeIntegral(const MultiLevelProblem &amp;ml_prob)</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l01300">01_solid_control_boundary.cpp:1300</a></div></div>
<div class="ttc" id="a01__solid__control__boundary_8cpp_html_aea610d910b5d696b3e500ed9636d8367"><div class="ttname"><a href="01__solid__control__boundary_8cpp.html#aea610d910b5d696b3e500ed9636d8367">AssembleSolidMech</a></div><div class="ttdeci">void AssembleSolidMech(MultiLevelProblem &amp;ml_prob)</div><div class="ttdef"><b>Definition</b> <a href="01__solid__control__boundary_8cpp_source.html#l00311">01_solid_control_boundary.cpp:311</a></div></div>
<div class="ttc" id="a_assemble__jacobian_8hpp_html"><div class="ttname"><a href="_assemble__jacobian_8hpp.html">Assemble_jacobian.hpp</a></div></div>
<div class="ttc" id="a_conformal_2ex3_2ex3_8cpp_html_a4049344c4d6020a322197047b513967f"><div class="ttname"><a href="_conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a></div><div class="ttdeci">const double beta</div><div class="ttdef"><b>Definition</b> <a href="_conformal_2ex3_2ex3_8cpp_source.html#l00023">ex3.cpp:23</a></div></div>
<div class="ttc" id="a_elem_type_enum_8hpp_html_a1b014294b9757a001707c979e2bab627"><div class="ttname"><a href="_elem_type_enum_8hpp.html#a1b014294b9757a001707c979e2bab627">ElemType</a></div><div class="ttdeci">ElemType</div><div class="ttdef"><b>Definition</b> <a href="_elem_type_enum_8hpp_source.html#l00006">ElemTypeEnum.hpp:6</a></div></div>
<div class="ttc" id="a_elem_type_enum_8hpp_html_a1b014294b9757a001707c979e2bab627ac17e6803e9d62a4d807c62341c5f7d59"><div class="ttname"><a href="_elem_type_enum_8hpp.html#a1b014294b9757a001707c979e2bab627ac17e6803e9d62a4d807c62341c5f7d59">QUAD9</a></div><div class="ttdeci">@ QUAD9</div><div class="ttdef"><b>Definition</b> <a href="_elem_type_enum_8hpp_source.html#l00016">ElemTypeEnum.hpp:16</a></div></div>
<div class="ttc" id="a_f_e__convergence_8hpp_html"><div class="ttname"><a href="_f_e__convergence_8hpp.html">FE_convergence.hpp</a></div></div>
<div class="ttc" id="a_f_e_type_enum_8hpp_html_a789a31c8b16fddbe5ad66911ec7933c6"><div class="ttname"><a href="_f_e_type_enum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a></div><div class="ttdeci">#define BIQUADR_FE</div><div class="ttdef"><b>Definition</b> <a href="_f_e_type_enum_8hpp_source.html#l00010">FETypeEnum.hpp:10</a></div></div>
<div class="ttc" id="a_f_elem_type_enum_8hpp_html_a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1"><div class="ttname"><a href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a></div><div class="ttdeci">@ FIRST</div><div class="ttdef"><b>Definition</b> <a href="_f_elem_type_enum_8hpp_source.html#l00015">FElemTypeEnum.hpp:15</a></div></div>
<div class="ttc" id="a_f_elem_type_enum_8hpp_html_a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3"><div class="ttname"><a href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa7cb36ff0a80f238d5b987d9250d369e3">SECOND</a></div><div class="ttdeci">@ SECOND</div><div class="ttdef"><b>Definition</b> <a href="_f_elem_type_enum_8hpp_source.html#l00018">FElemTypeEnum.hpp:17</a></div></div>
<div class="ttc" id="a_f_elem_type_enum_8hpp_html_a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf"><div class="ttname"><a href="_f_elem_type_enum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf">ZERO</a></div><div class="ttdeci">@ ZERO</div><div class="ttdef"><b>Definition</b> <a href="_f_elem_type_enum_8hpp_source.html#l00014">FElemTypeEnum.hpp:14</a></div></div>
<div class="ttc" id="a_f_elem_type_enum_8hpp_html_a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df"><div class="ttname"><a href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df">DISCONTINUOUS_POLYNOMIAL</a></div><div class="ttdeci">@ DISCONTINUOUS_POLYNOMIAL</div><div class="ttdef"><b>Definition</b> <a href="_f_elem_type_enum_8hpp_source.html#l00006">FElemTypeEnum.hpp:6</a></div></div>
<div class="ttc" id="a_f_elem_type_enum_8hpp_html_a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e"><div class="ttname"><a href="_f_elem_type_enum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a></div><div class="ttdeci">@ LAGRANGE</div><div class="ttdef"><b>Definition</b> <a href="_f_elem_type_enum_8hpp_source.html#l00005">FElemTypeEnum.hpp:5</a></div></div>
<div class="ttc" id="a_femus_init_8hpp_html"><div class="ttname"><a href="_femus_init_8hpp.html">FemusInit.hpp</a></div></div>
<div class="ttc" id="a_files_8hpp_html"><div class="ttname"><a href="_files_8hpp.html">Files.hpp</a></div></div>
<div class="ttc" id="a_fluid_8hpp_html"><div class="ttname"><a href="_fluid_8hpp.html">Fluid.hpp</a></div></div>
<div class="ttc" id="a_i_s_m_2ex4_2ex4_8cpp_html_a0aca793820b6ff7705450e2043256938"><div class="ttname"><a href="_i_s_m_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a></div><div class="ttdeci">unsigned numberOfUniformLevels</div><div class="ttdef"><b>Definition</b> <a href="_i_s_m_2ex4_2ex4_8cpp_source.html#l00089">ex4.cpp:89</a></div></div>
<div class="ttc" id="a_i_s_m_2ex4_2ex4_8cpp_html_aece1bc3fff4b670afc08354a6d995a0e"><div class="ttname"><a href="_i_s_m_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a></div><div class="ttdeci">unsigned dim</div><div class="ttdef"><b>Definition</b> <a href="_i_s_m_2ex4_2ex4_8cpp_source.html#l00031">ex4.cpp:31</a></div></div>
<div class="ttc" id="a_linear_implicit_system_8hpp_html"><div class="ttname"><a href="_linear_implicit_system_8hpp.html">LinearImplicitSystem.hpp</a></div></div>
<div class="ttc" id="a_m_g_a_m_r_2ex9_2_m_g__precond_8m_html_ac86694252f8dfdb19aaeadc4b7c342c6"><div class="ttname"><a href="_m_g_a_m_r_2ex9_2_m_g__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a></div><div class="ttdeci">for j</div><div class="ttdef"><b>Definition</b> <a href="_m_g_a_m_r_2ex9_2_m_g__precond_8m_source.html#l00032">MG_precond.m:32</a></div></div>
<div class="ttc" id="a_multi_level_problem_8hpp_html"><div class="ttname"><a href="_multi_level_problem_8hpp.html">MultiLevelProblem.hpp</a></div></div>
<div class="ttc" id="a_non_linear_implicit_system_8hpp_html"><div class="ttname"><a href="_non_linear_implicit_system_8hpp.html">NonLinearImplicitSystem.hpp</a></div></div>
<div class="ttc" id="a_numeric_vector_8hpp_html"><div class="ttname"><a href="_numeric_vector_8hpp.html">NumericVector.hpp</a></div></div>
<div class="ttc" id="a_parameter_8hpp_html"><div class="ttname"><a href="_parameter_8hpp.html">Parameter.hpp</a></div></div>
<div class="ttc" id="a_petsc_matrix_8hpp_html"><div class="ttname"><a href="_petsc_matrix_8hpp.html">PetscMatrix.hpp</a></div></div>
<div class="ttc" id="a_precondtype_enum_8hpp_html_a8b341faac6531c4543c9dc6e5e4592cfad035adc4d5a17adbb5db52fa62a98f88"><div class="ttname"><a href="_precondtype_enum_8hpp.html#a8b341faac6531c4543c9dc6e5e4592cfad035adc4d5a17adbb5db52fa62a98f88">LU_PRECOND</a></div><div class="ttdeci">@ LU_PRECOND</div><div class="ttdef"><b>Definition</b> <a href="_precondtype_enum_8hpp_source.html#l00017">PrecondtypeEnum.hpp:17</a></div></div>
<div class="ttc" id="a_solid_8hpp_html"><div class="ttname"><a href="_solid_8hpp.html">Solid.hpp</a></div></div>
<div class="ttc" id="a_solvertype_enum_8hpp_html_a8b06041d7c1fb05f379714f4312306ecaac04ac264cd7722642583eccd43a75ab"><div class="ttname"><a href="_solvertype_enum_8hpp.html#a8b06041d7c1fb05f379714f4312306ecaac04ac264cd7722642583eccd43a75ab">PREONLY</a></div><div class="ttdeci">@ PREONLY</div><div class="ttdef"><b>Definition</b> <a href="_solvertype_enum_8hpp_source.html#l00028">SolvertypeEnum.hpp:27</a></div></div>
<div class="ttc" id="a_v_t_k_writer_8hpp_html"><div class="ttname"><a href="_v_t_k_writer_8hpp.html">VTKWriter.hpp</a></div></div>
<div class="ttc" id="a_writer_enum_8hpp_html_a18b827c3c1f62b8a57febdcad0c871a8a37fb55ddbbe1465cec5f3d154db73e67"><div class="ttname"><a href="_writer_enum_8hpp.html#a18b827c3c1f62b8a57febdcad0c871a8a37fb55ddbbe1465cec5f3d154db73e67">VTK</a></div><div class="ttdeci">@ VTK</div><div class="ttdef"><b>Definition</b> <a href="_writer_enum_8hpp_source.html#l00004">WriterEnum.hpp:4</a></div></div>
<div class="ttc" id="aclass_solution__generation__1_html"><div class="ttname"><a href="class_solution__generation__1.html">Solution_generation_1</a></div><div class="ttdef"><b>Definition</b> <a href="ex02__poisson__convergence_8cpp_source.html#l00116">ex02_poisson_convergence.cpp:116</a></div></div>
<div class="ttc" id="aclass_solution__generation__1_html_a2a0001fac52be7a97cc9cc3c901c5f9f"><div class="ttname"><a href="class_solution__generation__1.html#a2a0001fac52be7a97cc9cc3c901c5f9f">Solution_generation_1::run_on_single_level</a></div><div class="ttdeci">const MultiLevelSolution run_on_single_level(MultiLevelProblem &amp;ml_prob, MultiLevelMesh &amp;ml_mesh, const unsigned i, const std::vector&lt; Unknown &gt; &amp;unknowns, const std::vector&lt; Math::Function&lt; double &gt; * &gt; &amp;exact_sol, const MultiLevelSolution::InitFuncMLProb SetInitialCondition_in, const MultiLevelSolution::BoundaryFuncMLProb SetBoundaryCondition_in, const bool equation_solve) const</div><div class="ttdef"><b>Definition</b> <a href="ex02__poisson__convergence_8cpp_source.html#l00307">ex02_poisson_convergence.cpp:307</a></div></div>
<div class="ttc" id="aclass_solution__generation__1_html_a68765d1e79777165c518157310035844"><div class="ttname"><a href="class_solution__generation__1.html#a68765d1e79777165c518157310035844">Solution_generation_1::run_on_single_level</a></div><div class="ttdeci">const MultiLevelSolution run_on_single_level(MultiLevelProblem &amp;ml_prob, MultiLevelMesh &amp;ml_mesh, const unsigned i, const std::vector&lt; Unknown &gt; &amp;unknowns, const std::vector&lt; Math::Function&lt; double &gt; * &gt; &amp;exact_sol, const MultiLevelSolution::InitFuncMLProb SetInitialCondition_in, const MultiLevelSolution::BoundaryFuncMLProb SetBoundaryCondition_in, const bool equation_sol) const</div></div>
<div class="ttc" id="aclassfemus_1_1_femus_init_html"><div class="ttname"><a href="classfemus_1_1_femus_init.html">femus::FemusInit</a></div><div class="ttdef"><b>Definition</b> <a href="_femus_init_8hpp_source.html#l00049">FemusInit.hpp:49</a></div></div>
<div class="ttc" id="aclassfemus_1_1_femus_init_html_ab48c1191eb7ebb370a323d3ec4f713c9"><div class="ttname"><a href="classfemus_1_1_femus_init.html#ab48c1191eb7ebb370a323d3ec4f713c9">femus::FemusInit::_adeptStack</a></div><div class="ttdeci">static adept::Stack _adeptStack</div><div class="ttdef"><b>Definition</b> <a href="_femus_init_8hpp_source.html#l00059">FemusInit.hpp:59</a></div></div>
<div class="ttc" id="aclassfemus_1_1_files_html"><div class="ttname"><a href="classfemus_1_1_files.html">femus::Files</a></div><div class="ttdef"><b>Definition</b> <a href="_files_8hpp_source.html#l00040">Files.hpp:40</a></div></div>
<div class="ttc" id="aclassfemus_1_1_files_html_aac199200ffda7ba50611cc41f6a874bc"><div class="ttname"><a href="classfemus_1_1_files.html#aac199200ffda7ba50611cc41f6a874bc">femus::Files::RedirectCout</a></div><div class="ttdeci">void RedirectCout(const bool redirect_cout_to_file) const</div><div class="ttdef"><b>Definition</b> <a href="_files_8cpp_source.html#l00553">Files.cpp:553</a></div></div>
<div class="ttc" id="aclassfemus_1_1_files_html_ab8c41974c4980d87c7e1467b153854e6"><div class="ttname"><a href="classfemus_1_1_files.html#ab8c41974c4980d87c7e1467b153854e6">femus::Files::CheckIODirectories</a></div><div class="ttdeci">void CheckIODirectories(const bool use_output_time_folder)</div><div class="ttdef"><b>Definition</b> <a href="_files_8cpp_source.html#l00515">Files.cpp:515</a></div></div>
<div class="ttc" id="aclassfemus_1_1_files_html_acf59b68932959fe552a95acc362c3920"><div class="ttname"><a href="classfemus_1_1_files.html#acf59b68932959fe552a95acc362c3920">femus::Files::GetOutputPath</a></div><div class="ttdeci">std::string GetOutputPath() const</div><div class="ttdef"><b>Definition</b> <a href="_files_8hpp_source.html#l00064">Files.hpp:64</a></div></div>
<div class="ttc" id="aclassfemus_1_1_gauss_html_ab1eb96997b69ce4ebec7283eb3bf1c01"><div class="ttname"><a href="classfemus_1_1_gauss.html#ab1eb96997b69ce4ebec7283eb3bf1c01">femus::Gauss::GetGaussPointsNumber</a></div><div class="ttdeci">const unsigned GetGaussPointsNumber() const</div><div class="ttdef"><b>Definition</b> <a href="_gauss_points_8hpp_source.html#l00136">GaussPoints.hpp:136</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_equation_html_a20ac8999e714492516cd8a2be53fb54f"><div class="ttname"><a href="classfemus_1_1_linear_equation.html#a20ac8999e714492516cd8a2be53fb54f">femus::LinearEquation::_RES</a></div><div class="ttdeci">NumericVector * _RES</div><div class="ttdef"><b>Definition</b> <a href="_linear_equation_8hpp_source.html#l00115">LinearEquation.hpp:115</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_equation_html_a4e339f53ed51e108cd33e1577dae9c18"><div class="ttname"><a href="classfemus_1_1_linear_equation.html#a4e339f53ed51e108cd33e1577dae9c18">femus::LinearEquation::GetSystemDof</a></div><div class="ttdeci">unsigned GetSystemDof(const unsigned &amp;index_sol, const unsigned &amp;kkindex_sol, const unsigned &amp;i, const unsigned &amp;iel) const</div><div class="ttdef"><b>Definition</b> <a href="_linear_equation_8cpp_source.html#l00071">LinearEquation.cpp:71</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_equation_html_aa10eb0eb318cf0d449f5ecdcec2823bc"><div class="ttname"><a href="classfemus_1_1_linear_equation.html#aa10eb0eb318cf0d449f5ecdcec2823bc">femus::LinearEquation::_KK</a></div><div class="ttdeci">SparseMatrix * _KK</div><div class="ttdef"><b>Definition</b> <a href="_linear_equation_8hpp_source.html#l00118">LinearEquation.hpp:118</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_equation_html_ae3ec0b2dd39e7527448bc35f108f6093"><div class="ttname"><a href="classfemus_1_1_linear_equation.html#ae3ec0b2dd39e7527448bc35f108f6093">femus::LinearEquation::KKoffset</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; unsigned &gt; &gt; KKoffset</div><div class="ttdef"><b>Definition</b> <a href="_linear_equation_8hpp_source.html#l00125">LinearEquation.hpp:125</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_equation_solver_html"><div class="ttname"><a href="classfemus_1_1_linear_equation_solver.html">femus::LinearEquationSolver</a></div><div class="ttdef"><b>Definition</b> <a href="_linear_equation_solver_8hpp_source.html#l00055">LinearEquationSolver.hpp:55</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_implicit_system_html_a03b082409d094d87e46e023356c4cb8e"><div class="ttname"><a href="classfemus_1_1_linear_implicit_system.html#a03b082409d094d87e46e023356c4cb8e">femus::LinearImplicitSystem::SetSolverFineGrids</a></div><div class="ttdeci">void SetSolverFineGrids(const SolverType &amp;solvertype)</div><div class="ttdef"><b>Definition</b> <a href="_linear_implicit_system_8cpp_source.html#l01029">LinearImplicitSystem.cpp:1029</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_implicit_system_html_a71658025becd1238e92318c950792b4b"><div class="ttname"><a href="classfemus_1_1_linear_implicit_system.html#a71658025becd1238e92318c950792b4b">femus::LinearImplicitSystem::ClearVariablesToBeSolved</a></div><div class="ttdeci">void ClearVariablesToBeSolved()</div><div class="ttdef"><b>Definition</b> <a href="_linear_implicit_system_8cpp_source.html#l00975">LinearImplicitSystem.cpp:975</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_implicit_system_html_aaff342b69e3dd0e77a1bc084030f795c"><div class="ttname"><a href="classfemus_1_1_linear_implicit_system.html#aaff342b69e3dd0e77a1bc084030f795c">femus::LinearImplicitSystem::SetPreconditionerFineGrids</a></div><div class="ttdeci">void SetPreconditionerFineGrids(const PreconditionerType &amp;preconditioner_type)</div><div class="ttdef"><b>Definition</b> <a href="_linear_implicit_system_8cpp_source.html#l01047">LinearImplicitSystem.cpp:1047</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_implicit_system_html_ab0c6f96601a00ae5f20a44bd137592b8"><div class="ttname"><a href="classfemus_1_1_linear_implicit_system.html#ab0c6f96601a00ae5f20a44bd137592b8">femus::LinearImplicitSystem::AddVariableToBeSolved</a></div><div class="ttdeci">void AddVariableToBeSolved(const char solname[])</div><div class="ttdef"><b>Definition</b> <a href="_linear_implicit_system_8cpp_source.html#l00944">LinearImplicitSystem.cpp:944</a></div></div>
<div class="ttc" id="aclassfemus_1_1_linear_implicit_system_html_ad0a0195fe959aca497e2a7251b43405b"><div class="ttname"><a href="classfemus_1_1_linear_implicit_system.html#ad0a0195fe959aca497e2a7251b43405b">femus::LinearImplicitSystem::SetOuterSolver</a></div><div class="ttdeci">void SetOuterSolver(const SolverType &amp;mgOuterSolver)</div><div class="ttdef"><b>Definition</b> <a href="_linear_implicit_system_8hpp_source.html#l00184">LinearImplicitSystem.hpp:184</a></div></div>
<div class="ttc" id="aclassfemus_1_1_material_html_a393992ac63eb6eaae7d5cbad9c6ac4ec"><div class="ttname"><a href="classfemus_1_1_material.html#a393992ac63eb6eaae7d5cbad9c6ac4ec">femus::Material::_parameter</a></div><div class="ttdeci">Parameter * _parameter</div><div class="ttdef"><b>Definition</b> <a href="_material_8hpp_source.html#l00052">Material.hpp:52</a></div></div>
<div class="ttc" id="aclassfemus_1_1_material_html_aa1968d4c8018a8fca33acb32a5be3dbc"><div class="ttname"><a href="classfemus_1_1_material.html#aa1968d4c8018a8fca33acb32a5be3dbc">femus::Material::get_density</a></div><div class="ttdeci">const double get_density() const</div><div class="ttdef"><b>Definition</b> <a href="_material_8cpp_source.html#l00058">Material.cpp:58</a></div></div>
<div class="ttc" id="aclassfemus_1_1_math_1_1_function_html"><div class="ttname"><a href="classfemus_1_1_math_1_1_function.html">femus::Math::Function&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html"><div class="ttname"><a href="classfemus_1_1_mesh.html">femus::Mesh</a></div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00048">Mesh.hpp:48</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a24f5ab73a260d61b0ea9ff28f03bc815"><div class="ttname"><a href="classfemus_1_1_mesh.html#a24f5ab73a260d61b0ea9ff28f03bc815">femus::Mesh::GetLevel</a></div><div class="ttdeci">unsigned GetLevel() const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00260">Mesh.hpp:260</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a555c4982e81fc0042426c6741a792ca2"><div class="ttname"><a href="classfemus_1_1_mesh.html#a555c4982e81fc0042426c6741a792ca2">femus::Mesh::_finiteElement</a></div><div class="ttdeci">const elem_type * _finiteElement[N_GEOM_ELS][5]</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00321">Mesh.hpp:321</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a57f92951660269429cc7f04ee3c26c17"><div class="ttname"><a href="classfemus_1_1_mesh.html#a57f92951660269429cc7f04ee3c26c17">femus::Mesh::GetElementFaceType</a></div><div class="ttdeci">const unsigned GetElementFaceType(const unsigned &amp;kel, const unsigned &amp;jface) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l01227">Mesh.cpp:1227</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a5a0c1124aca095fd4327252ebac3660f"><div class="ttname"><a href="classfemus_1_1_mesh.html#a5a0c1124aca095fd4327252ebac3660f">femus::Mesh::GetElementFaceNumber</a></div><div class="ttdeci">unsigned GetElementFaceNumber(const unsigned &amp;iel, const unsigned &amp;type=1) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l01252">Mesh.cpp:1252</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a62689335aebc9de69b7490bfb32f0978"><div class="ttname"><a href="classfemus_1_1_mesh.html#a62689335aebc9de69b7490bfb32f0978">femus::Mesh::el</a></div><div class="ttdeci">elem * el</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00159">Mesh.hpp:159</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a679fa1625833f437ea38d2cc651c7462"><div class="ttname"><a href="classfemus_1_1_mesh.html#a679fa1625833f437ea38d2cc651c7462">femus::Mesh::GetElementDofNumber</a></div><div class="ttdeci">unsigned GetElementDofNumber(const unsigned &amp;iel, const unsigned &amp;type) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l01222">Mesh.cpp:1222</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_a6f753fa456d2313d902bf184c4bb9e3b"><div class="ttname"><a href="classfemus_1_1_mesh.html#a6f753fa456d2313d902bf184c4bb9e3b">femus::Mesh::GetDimension</a></div><div class="ttdeci">const unsigned GetDimension() const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00074">Mesh.hpp:74</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_ab5bcfd4be738d47ae025a06eddc66f61"><div class="ttname"><a href="classfemus_1_1_mesh.html#ab5bcfd4be738d47ae025a06eddc66f61">femus::Mesh::GetNumberOfElements</a></div><div class="ttdeci">unsigned GetNumberOfElements() const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00099">Mesh.hpp:99</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_ac436cfb1f4caaec0c4335358ff8a51d8"><div class="ttname"><a href="classfemus_1_1_mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">femus::Mesh::_topology</a></div><div class="ttdeci">Solution * _topology</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00464">Mesh.hpp:464</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_aca17a5dc69b8cfb941b8bbe7ae4a615e"><div class="ttname"><a href="classfemus_1_1_mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">femus::Mesh::_elementOffset</a></div><div class="ttdeci">std::vector&lt; unsigned &gt; _elementOffset</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8hpp_source.html#l00162">Mesh.hpp:162</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_ace44edec2dc2ffb42c0456f03fa227ff"><div class="ttname"><a href="classfemus_1_1_mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">femus::Mesh::GetSolutionDof</a></div><div class="ttdeci">unsigned GetSolutionDof(const unsigned &amp;i, const unsigned &amp;iel, const short unsigned &amp;solType) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l00902">Mesh.cpp:902</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_ad18fca5dab8c3567b644996e682043d3"><div class="ttname"><a href="classfemus_1_1_mesh.html#ad18fca5dab8c3567b644996e682043d3">femus::Mesh::GetLocalFaceVertexIndex</a></div><div class="ttdeci">unsigned GetLocalFaceVertexIndex(const unsigned &amp;iel, const unsigned &amp;iface, const unsigned &amp;jnode) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l01235">Mesh.cpp:1235</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_af372596998e5d55a1fa15d6c5f58f52b"><div class="ttname"><a href="classfemus_1_1_mesh.html#af372596998e5d55a1fa15d6c5f58f52b">femus::Mesh::GetElementFaceDofNumber</a></div><div class="ttdeci">unsigned GetElementFaceDofNumber(const unsigned &amp;iel, const unsigned jface, const unsigned &amp;type) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l01246">Mesh.cpp:1246</a></div></div>
<div class="ttc" id="aclassfemus_1_1_mesh_html_af92bd9944b1d887562b460ede06acf44"><div class="ttname"><a href="classfemus_1_1_mesh.html#af92bd9944b1d887562b460ede06acf44">femus::Mesh::GetElementType</a></div><div class="ttdeci">short unsigned GetElementType(const unsigned &amp;iel) const</div><div class="ttdef"><b>Definition</b> <a href="_mesh_8cpp_source.html#l01212">Mesh.cpp:1212</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html">femus::MultiLevelMesh</a></div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8hpp_source.html#l00046">MultiLevelMesh.hpp:46</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_a06c4fe014434c2bafdd2c6e94e018620"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#a06c4fe014434c2bafdd2c6e94e018620">femus::MultiLevelMesh::RefineMesh</a></div><div class="ttdeci">void RefineMesh(const unsigned short &amp;igridn, const unsigned short &amp;igridr, bool(*SetRefinementFlag)(const std::vector&lt; double &gt; &amp;x, const int &amp;ElemGroupNumber, const int &amp;level))</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8cpp_source.html#l00495">MultiLevelMesh.cpp:495</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_a0988cbee341d6361df77622b3ce65080"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#a0988cbee341d6361df77622b3ce65080">femus::MultiLevelMesh::GenerateCoarseBoxMesh</a></div><div class="ttdeci">void GenerateCoarseBoxMesh(const unsigned int nx, const unsigned int ny, const unsigned int nz, const double xmin, const double xmax, const double ymin, const double ymax, const double zmin, const double zmax, const ElemType type, const char GaussOrder[])</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8cpp_source.html#l00472">MultiLevelMesh.cpp:472</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_a09c12975f18035d5369ae411c0208648"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#a09c12975f18035d5369ae411c0208648">femus::MultiLevelMesh::PrintInfo</a></div><div class="ttdeci">void PrintInfo()</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8cpp_source.html#l00462">MultiLevelMesh.cpp:462</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_a65dabdf1e308c1a44ebe5c6a41d09284"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#a65dabdf1e308c1a44ebe5c6a41d09284">femus::MultiLevelMesh::GetDimension</a></div><div class="ttdeci">const unsigned GetDimension() const</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8cpp_source.html#l00541">MultiLevelMesh.cpp:541</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_ac474afe18c6be4e181b2bb72695f57e9"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#ac474afe18c6be4e181b2bb72695f57e9">femus::MultiLevelMesh::EraseCoarseLevels</a></div><div class="ttdeci">void EraseCoarseLevels(unsigned levels_to_be_erased)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8cpp_source.html#l00449">MultiLevelMesh.cpp:449</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_ad59554c65099f852ba8797f09bc40227"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#ad59554c65099f852ba8797f09bc40227">femus::MultiLevelMesh::_finiteElement</a></div><div class="ttdeci">elem_type * _finiteElement[N_GEOM_ELS][NFE_FAMS]</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8hpp_source.html#l00204">MultiLevelMesh.hpp:204</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_mesh_html_af0dec057961b41903215bb9927cbfeed"><div class="ttname"><a href="classfemus_1_1_multi_level_mesh.html#af0dec057961b41903215bb9927cbfeed">femus::MultiLevelMesh::GetLevel</a></div><div class="ttdeci">Mesh * GetLevel(const unsigned i)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_mesh_8hpp_source.html#l00147">MultiLevelMesh.hpp:147</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html">femus::MultiLevelProblem</a></div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00054">MultiLevelProblem.hpp:54</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a274e91e352c0d6b69c5925fdfca67d1f"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a274e91e352c0d6b69c5925fdfca67d1f">femus::MultiLevelProblem::GetFilesHandler</a></div><div class="ttdeci">const Files * GetFilesHandler() const</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00425">MultiLevelProblem.hpp:425</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a34890e6aa9d88946571fa050ee544c39"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a34890e6aa9d88946571fa050ee544c39">femus::MultiLevelProblem::GetQuadratureRule</a></div><div class="ttdeci">const Gauss &amp; GetQuadratureRule(const unsigned geom_elem_type) const</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00282">MultiLevelProblem.hpp:282</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a3d90edba93be2c202ea2bf8e87e20854"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a3d90edba93be2c202ea2bf8e87e20854">femus::MultiLevelProblem::get_system</a></div><div class="ttdeci">const T_sys &amp; get_system(const std::string &amp;name) const</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00519">MultiLevelProblem.hpp:519</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a537b31965e5402b9c9febebce96ce01c"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a537b31965e5402b9c9febebce96ce01c">femus::MultiLevelProblem::parameters</a></div><div class="ttdeci">Parameters parameters</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00397">MultiLevelProblem.hpp:397</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a623bdc2aefd83cf0c6d74fc265ee5c3f"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a623bdc2aefd83cf0c6d74fc265ee5c3f">femus::MultiLevelProblem::SetFilesHandler</a></div><div class="ttdeci">void SetFilesHandler(const Files *files_in)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00423">MultiLevelProblem.hpp:423</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a6dd8fec26a0ffbaae07e6df7ea42d12b"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">femus::MultiLevelProblem::_ml_sol</a></div><div class="ttdeci">MultiLevelSolution * _ml_sol</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00079">MultiLevelProblem.hpp:79</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a8b72e984b63d5ff97c1e7a0f0a5eee5a"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a8b72e984b63d5ff97c1e7a0f0a5eee5a">femus::MultiLevelProblem::SetQuadratureRuleAllGeomElems</a></div><div class="ttdeci">void SetQuadratureRuleAllGeomElems(const std::string quadr_order_in)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8cpp_source.html#l00177">MultiLevelProblem.cpp:177</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_a946d39c3fba7fac859822702248fe065"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#a946d39c3fba7fac859822702248fe065">femus::MultiLevelProblem::_ml_msh</a></div><div class="ttdeci">MultiLevelMesh * _ml_msh</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00116">MultiLevelProblem.hpp:116</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_ad54bc6b7254d2331491ac48b58a2d9e3"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#ad54bc6b7254d2331491ac48b58a2d9e3">femus::MultiLevelProblem::add_system</a></div><div class="ttdeci">virtual System &amp; add_system(const std::string &amp;system_type, const std::string &amp;name)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8cpp_source.html#l00077">MultiLevelProblem.cpp:77</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_ad86fcf047c83e4a719e09455a2fa247a"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#ad86fcf047c83e4a719e09455a2fa247a">femus::MultiLevelProblem::SetMultiLevelMeshAndSolution</a></div><div class="ttdeci">void SetMultiLevelMeshAndSolution(MultiLevelSolution *ml_sol)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8cpp_source.html#l00068">MultiLevelProblem.cpp:68</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_problem_html_adf745f778b0a76c7a748da2f65de99b3"><div class="ttname"><a href="classfemus_1_1_multi_level_problem.html#adf745f778b0a76c7a748da2f65de99b3">femus::MultiLevelProblem::get_systems_map</a></div><div class="ttdeci">std::map&lt; std::string, System * &gt; &amp; get_systems_map()</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_problem_8hpp_source.html#l00150">MultiLevelProblem.hpp:150</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_solution_html"><div class="ttname"><a href="classfemus_1_1_multi_level_solution.html">femus::MultiLevelSolution</a></div><div class="ttdef"><b>Definition</b> <a href="_multi_level_solution_8hpp_source.html#l00043">MultiLevelSolution.hpp:43</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_solution_html_a0c3d81a9146a8e96552da43955f0c7ae"><div class="ttname"><a href="classfemus_1_1_multi_level_solution.html#a0c3d81a9146a8e96552da43955f0c7ae">femus::MultiLevelSolution::GetIndex</a></div><div class="ttdeci">unsigned GetIndex(const char name[]) const</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_solution_8cpp_source.html#l00444">MultiLevelSolution.cpp:444</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_solution_html_a51e1cff061477ba02672e5ef790c465f"><div class="ttname"><a href="classfemus_1_1_multi_level_solution.html#a51e1cff061477ba02672e5ef790c465f">femus::MultiLevelSolution::InitFuncMLProb</a></div><div class="ttdeci">double(* InitFuncMLProb)(const MultiLevelProblem *ml_prob, const std::vector&lt; double &gt; &amp;x, const char name[])</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_solution_8hpp_source.html#l00244">MultiLevelSolution.hpp:244</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_solution_html_a9bb3681ff25b06b030d75b1ab1bdfdc3"><div class="ttname"><a href="classfemus_1_1_multi_level_solution.html#a9bb3681ff25b06b030d75b1ab1bdfdc3">femus::MultiLevelSolution::GetSolutionLevel</a></div><div class="ttdeci">Solution * GetSolutionLevel(const unsigned i)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_solution_8hpp_source.html#l00138">MultiLevelSolution.hpp:138</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_solution_html_ac2ecfa36125c8626b6fdf20f71dbde0c"><div class="ttname"><a href="classfemus_1_1_multi_level_solution.html#ac2ecfa36125c8626b6fdf20f71dbde0c">femus::MultiLevelSolution::BoundaryFuncMLProb</a></div><div class="ttdeci">bool(* BoundaryFuncMLProb)(const MultiLevelProblem *ml_prob, const std::vector&lt; double &gt; &amp;x, const char name[], double &amp;value, const int FaceName, const double time)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_solution_8hpp_source.html#l00333">MultiLevelSolution.hpp:333</a></div></div>
<div class="ttc" id="aclassfemus_1_1_multi_level_solution_html_ac6285c5a1907ad1f93ad7b380a08dabe"><div class="ttname"><a href="classfemus_1_1_multi_level_solution.html#ac6285c5a1907ad1f93ad7b380a08dabe">femus::MultiLevelSolution::GetSolutionType</a></div><div class="ttdeci">int GetSolutionType(unsigned i)</div><div class="ttdef"><b>Definition</b> <a href="_multi_level_solution_8hpp_source.html#l00186">MultiLevelSolution.hpp:186</a></div></div>
<div class="ttc" id="aclassfemus_1_1_non_linear_implicit_system_html"><div class="ttname"><a href="classfemus_1_1_non_linear_implicit_system.html">femus::NonLinearImplicitSystem</a></div><div class="ttdef"><b>Definition</b> <a href="_non_linear_implicit_system_8hpp_source.html#l00035">NonLinearImplicitSystem.hpp:35</a></div></div>
<div class="ttc" id="aclassfemus_1_1_non_linear_implicit_system_html_a438462e18c01e8fb08358526c04c50b5"><div class="ttname"><a href="classfemus_1_1_non_linear_implicit_system.html#a438462e18c01e8fb08358526c04c50b5">femus::NonLinearImplicitSystem::MGsolve</a></div><div class="ttdeci">virtual void MGsolve(const MgSmootherType &amp;mgSmootherType=MULTIPLICATIVE)</div><div class="ttdef"><b>Definition</b> <a href="_non_linear_implicit_system_8cpp_source.html#l00155">NonLinearImplicitSystem.cpp:155</a></div></div>
<div class="ttc" id="aclassfemus_1_1_non_linear_implicit_system_html_ad263ecc83efc0d9ea26200bfa3c4cadf"><div class="ttname"><a href="classfemus_1_1_non_linear_implicit_system.html#ad263ecc83efc0d9ea26200bfa3c4cadf">femus::NonLinearImplicitSystem::SetDebugNonlinear</a></div><div class="ttdeci">void SetDebugNonlinear(const bool my_value)</div><div class="ttdef"><b>Definition</b> <a href="_non_linear_implicit_system_8cpp_source.html#l00101">NonLinearImplicitSystem.cpp:101</a></div></div>
<div class="ttc" id="aclassfemus_1_1_non_linear_implicit_system_html_ad2d20975e0c919a9d99bdd9368a0212a"><div class="ttname"><a href="classfemus_1_1_non_linear_implicit_system.html#ad2d20975e0c919a9d99bdd9368a0212a">femus::NonLinearImplicitSystem::init</a></div><div class="ttdeci">virtual void init()</div><div class="ttdef"><b>Definition</b> <a href="_non_linear_implicit_system_8cpp_source.html#l00047">NonLinearImplicitSystem.cpp:47</a></div></div>
<div class="ttc" id="aclassfemus_1_1_numeric_vector_html"><div class="ttname"><a href="classfemus_1_1_numeric_vector.html">femus::NumericVector</a></div><div class="ttdef"><b>Definition</b> <a href="_numeric_vector_8hpp_source.html#l00051">NumericVector.hpp:51</a></div></div>
<div class="ttc" id="aclassfemus_1_1_numeric_vector_html_a0440021963af01ac49a6f02df562e44b"><div class="ttname"><a href="classfemus_1_1_numeric_vector.html#a0440021963af01ac49a6f02df562e44b">femus::NumericVector::add_vector_blocked</a></div><div class="ttdeci">virtual void add_vector_blocked(const std::vector&lt; double &gt; &amp;v, const std::vector&lt; int &gt; &amp;dof_indices)=0</div><div class="ttdoc">where v is a std::vector !!!fast</div></div>
<div class="ttc" id="aclassfemus_1_1_numeric_vector_html_a80b1efdc7101659f2035c2da880360e7"><div class="ttname"><a href="classfemus_1_1_numeric_vector.html#a80b1efdc7101659f2035c2da880360e7">femus::NumericVector::zero</a></div><div class="ttdeci">virtual void zero()=0</div><div class="ttdoc">Set all entries to zero. Equivalent to v = 0.</div></div>
<div class="ttc" id="aclassfemus_1_1_numeric_vector_html_a80eb1dc1f53018fd7d08bcc4a511cc09"><div class="ttname"><a href="classfemus_1_1_numeric_vector.html#a80eb1dc1f53018fd7d08bcc4a511cc09">femus::NumericVector::close</a></div><div class="ttdeci">virtual void close()=0</div></div>
<div class="ttc" id="aclassfemus_1_1_parallel_object_html_a6438b3ffcc8cde2d6ccfb4ec563dfce1"><div class="ttname"><a href="classfemus_1_1_parallel_object.html#a6438b3ffcc8cde2d6ccfb4ec563dfce1">femus::ParallelObject::processor_id</a></div><div class="ttdeci">int processor_id() const</div><div class="ttdef"><b>Definition</b> <a href="_parallel_object_8hpp_source.html#l00053">ParallelObject.hpp:53</a></div></div>
<div class="ttc" id="aclassfemus_1_1_parameter_html"><div class="ttname"><a href="classfemus_1_1_parameter.html">femus::Parameter</a></div><div class="ttdef"><b>Definition</b> <a href="_parameter_8hpp_source.html#l00028">Parameter.hpp:28</a></div></div>
<div class="ttc" id="aclassfemus_1_1_parameter_html_a010508c1540e2547bcbf77f2c1103695"><div class="ttname"><a href="classfemus_1_1_parameter.html#a010508c1540e2547bcbf77f2c1103695">femus::Parameter::Get_reference_length</a></div><div class="ttdeci">double Get_reference_length()</div><div class="ttdef"><b>Definition</b> <a href="_parameter_8cpp_source.html#l00032">Parameter.cpp:32</a></div></div>
<div class="ttc" id="aclassfemus_1_1_parameters_html_a419ddd3d0965dbca868a5072249b8374"><div class="ttname"><a href="classfemus_1_1_parameters.html#a419ddd3d0965dbca868a5072249b8374">femus::Parameters::get</a></div><div class="ttdeci">const T &amp; get(const std::string &amp;) const</div><div class="ttdef"><b>Definition</b> <a href="_parameters_8hpp_source.html#l00414">Parameters.hpp:414</a></div></div>
<div class="ttc" id="aclassfemus_1_1_parameters_html_a552a70edef7b7d9119b1cd4797af776b"><div class="ttname"><a href="classfemus_1_1_parameters.html#a552a70edef7b7d9119b1cd4797af776b">femus::Parameters::set</a></div><div class="ttdeci">T &amp; set(const std::string &amp;)</div><div class="ttdef"><b>Definition</b> <a href="_parameters_8hpp_source.html#l00450">Parameters.hpp:450</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html"><div class="ttname"><a href="classfemus_1_1_solid.html">femus::Solid</a></div><div class="ttdef"><b>Definition</b> <a href="_solid_8hpp_source.html#l00036">Solid.hpp:36</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html_a032c01f0f6e345f2818a7ffe24bad883"><div class="ttname"><a href="classfemus_1_1_solid.html#a032c01f0f6e345f2818a7ffe24bad883">femus::Solid::get_if_penalty</a></div><div class="ttdeci">const bool get_if_penalty() const</div><div class="ttdef"><b>Definition</b> <a href="_solid_8cpp_source.html#l00161">Solid.cpp:161</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html_a19ca2da625aede63d5277cb034584718"><div class="ttname"><a href="classfemus_1_1_solid.html#a19ca2da625aede63d5277cb034584718">femus::Solid::get_physical_model</a></div><div class="ttdeci">const unsigned get_physical_model() const</div><div class="ttdef"><b>Definition</b> <a href="_solid_8cpp_source.html#l00141">Solid.cpp:141</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html_a1a27599fb327424255b0823dcddd863a"><div class="ttname"><a href="classfemus_1_1_solid.html#a1a27599fb327424255b0823dcddd863a">femus::Solid::get_young_module</a></div><div class="ttdeci">const double get_young_module() const</div><div class="ttdef"><b>Definition</b> <a href="_solid_8cpp_source.html#l00145">Solid.cpp:145</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html_a25307ed3e65fea474b2d74b130348e4b"><div class="ttname"><a href="classfemus_1_1_solid.html#a25307ed3e65fea474b2d74b130348e4b">femus::Solid::get_lame_lambda</a></div><div class="ttdeci">const double get_lame_lambda() const</div><div class="ttdef"><b>Definition</b> <a href="_solid_8cpp_source.html#l00153">Solid.cpp:153</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html_a3d971cfb0d2a1810e6b31830f1f4b900"><div class="ttname"><a href="classfemus_1_1_solid.html#a3d971cfb0d2a1810e6b31830f1f4b900">femus::Solid::get_poisson_coeff</a></div><div class="ttdeci">const double get_poisson_coeff() const</div><div class="ttdef"><b>Definition</b> <a href="_solid_8cpp_source.html#l00149">Solid.cpp:149</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solid_html_a5f3228eab52c343a13167eaf73f568bc"><div class="ttname"><a href="classfemus_1_1_solid.html#a5f3228eab52c343a13167eaf73f568bc">femus::Solid::get_lame_shear_modulus</a></div><div class="ttdeci">const double get_lame_shear_modulus() const</div><div class="ttdef"><b>Definition</b> <a href="_solid_8cpp_source.html#l00157">Solid.cpp:157</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solution__generation__single__level_html"><div class="ttname"><a href="classfemus_1_1_solution__generation__single__level.html">femus::Solution_generation_single_level</a></div><div class="ttdef"><b>Definition</b> <a href="_f_e__convergence_8hpp_source.html#l00020">FE_convergence.hpp:20</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solution_html"><div class="ttname"><a href="classfemus_1_1_solution.html">femus::Solution</a></div><div class="ttdef"><b>Definition</b> <a href="_solution_8hpp_source.html#l00049">Solution.hpp:49</a></div></div>
<div class="ttc" id="aclassfemus_1_1_solution_html_a5c725da69d0b94b7ff4a4e2509c86d53"><div class="ttname"><a href="classfemus_1_1_solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">femus::Solution::_Sol</a></div><div class="ttdeci">std::vector&lt; NumericVector * &gt; _Sol</div><div class="ttdef"><b>Definition</b> <a href="_solution_8hpp_source.html#l00151">Solution.hpp:151</a></div></div>
<div class="ttc" id="aclassfemus_1_1_sparse_matrix_html"><div class="ttname"><a href="classfemus_1_1_sparse_matrix.html">femus::SparseMatrix</a></div><div class="ttdef"><b>Definition</b> <a href="_sparse_matrix_8hpp_source.html#l00047">SparseMatrix.hpp:47</a></div></div>
<div class="ttc" id="aclassfemus_1_1_sparse_matrix_html_a45654dbe423d1970565b94c792ce6df3"><div class="ttname"><a href="classfemus_1_1_sparse_matrix.html#a45654dbe423d1970565b94c792ce6df3">femus::SparseMatrix::zero</a></div><div class="ttdeci">virtual void zero()=0</div></div>
<div class="ttc" id="aclassfemus_1_1_sparse_matrix_html_a6eb9fbd88830b0d10c88f0ce066b07ae"><div class="ttname"><a href="classfemus_1_1_sparse_matrix.html#a6eb9fbd88830b0d10c88f0ce066b07ae">femus::SparseMatrix::close</a></div><div class="ttdeci">virtual void close() const =0</div></div>
<div class="ttc" id="aclassfemus_1_1_sparse_matrix_html_aac0370cebbcc2d7111660dcf7115ebbf"><div class="ttname"><a href="classfemus_1_1_sparse_matrix.html#aac0370cebbcc2d7111660dcf7115ebbf">femus::SparseMatrix::add_matrix_blocked</a></div><div class="ttdeci">virtual void add_matrix_blocked(const std::vector&lt; double &gt; &amp;mat_value, const std::vector&lt; int &gt; &amp;rows, const std::vector&lt; int &gt; &amp;cols)=0</div></div>
<div class="ttc" id="aclassfemus_1_1_system_html_a42a5b5b5d2c7673b1d4c896762d8db9e"><div class="ttname"><a href="classfemus_1_1_system.html#a42a5b5b5d2c7673b1d4c896762d8db9e">femus::System::SetAssembleFunction</a></div><div class="ttdeci">void SetAssembleFunction(AssembleFunctionType)</div><div class="ttdef"><b>Definition</b> <a href="_system_8cpp_source.html#l00058">System.cpp:58</a></div></div>
<div class="ttc" id="aclassfemus_1_1_system_html_a606e07526d7a0d31eed638404ee2ed24"><div class="ttname"><a href="classfemus_1_1_system.html#a606e07526d7a0d31eed638404ee2ed24">femus::System::AddSolutionToSystemPDE</a></div><div class="ttdeci">virtual void AddSolutionToSystemPDE(const char solname[])</div><div class="ttdef"><b>Definition</b> <a href="_system_8cpp_source.html#l00075">System.cpp:75</a></div></div>
<div class="ttc" id="aclassfemus_1_1_system_html_ae3c161c5a12d55227effe9acf01b6535"><div class="ttname"><a href="classfemus_1_1_system.html#ae3c161c5a12d55227effe9acf01b6535">femus::System::set_unknown_list_for_assembly</a></div><div class="ttdeci">void set_unknown_list_for_assembly(const std::vector&lt; Unknown &gt; unknown_in)</div><div class="ttdef"><b>Definition</b> <a href="_system_8cpp_source.html#l00115">System.cpp:115</a></div></div>
<div class="ttc" id="aclassfemus_1_1assemble__jacobian_html"><div class="ttname"><a href="classfemus_1_1assemble__jacobian.html">femus::assemble_jacobian</a></div><div class="ttdef"><b>Definition</b> <a href="_assemble__jacobian_8hpp_source.html#l00026">Assemble_jacobian.hpp:26</a></div></div>
<div class="ttc" id="aclassfemus_1_1assemble__jacobian_html_a298fb51789fa086f4ac3904b43336f76"><div class="ttname"><a href="classfemus_1_1assemble__jacobian.html#a298fb51789fa086f4ac3904b43336f76">femus::assemble_jacobian::res_row_index</a></div><div class="ttdeci">static unsigned int res_row_index(const std::vector&lt; unsigned int &gt; &amp;_Sol_n_el_dofs, const int my_row_pos, const int i)</div><div class="ttdef"><b>Definition</b> <a href="_assemble__jacobian_8hpp_source.html#l00284">Assemble_jacobian.hpp:284</a></div></div>
<div class="ttc" id="aclassfemus_1_1assemble__jacobian_html_afafa42b312f4db1f55298eb039ada1c6"><div class="ttname"><a href="classfemus_1_1assemble__jacobian.html#afafa42b312f4db1f55298eb039ada1c6">femus::assemble_jacobian::jac_row_col_index</a></div><div class="ttdeci">static unsigned int jac_row_col_index(const std::vector&lt; unsigned int &gt; &amp;_Sol_n_el_dofs, const int nDof_AllVars, const int my_row_pos, const int my_col_pos, const int i, const int j)</div><div class="ttdef"><b>Definition</b> <a href="_assemble__jacobian_8hpp_source.html#l00296">Assemble_jacobian.hpp:296</a></div></div>
<div class="ttc" id="aclassfemus_1_1elem__type__1_d_html"><div class="ttname"><a href="classfemus_1_1elem__type__1_d.html">femus::elem_type_1D</a></div><div class="ttdef"><b>Definition</b> <a href="_elem_type_8hpp_source.html#l00439">ElemType.hpp:440</a></div></div>
<div class="ttc" id="aclassfemus_1_1elem__type__1_d_html_a231d3fc282fc57ca178f9cbd0d10df7c"><div class="ttname"><a href="classfemus_1_1elem__type__1_d.html#a231d3fc282fc57ca178f9cbd0d10df7c">femus::elem_type_1D::GetDPhiDXi</a></div><div class="ttdeci">double * GetDPhiDXi(const unsigned &amp;ig) const</div><div class="ttdef"><b>Definition</b> <a href="_elem_type_8hpp_source.html#l00581">ElemType.hpp:581</a></div></div>
<div class="ttc" id="aclassfemus_1_1elem__type_html_a41bf5e7188a121649319194e846e533f"><div class="ttname"><a href="classfemus_1_1elem__type.html#a41bf5e7188a121649319194e846e533f">femus::elem_type::JacobianSur</a></div><div class="ttdeci">virtual void JacobianSur(const std::vector&lt; std::vector&lt; adept::adouble &gt; &gt; &amp;vt, const unsigned &amp;ig, adept::adouble &amp;Weight, std::vector&lt; double &gt; &amp;other_phi, std::vector&lt; adept::adouble &gt; &amp;gradphi, std::vector&lt; adept::adouble &gt; &amp;normal) const =0</div></div>
<div class="ttc" id="aclassfemus_1_1elem__type_html_a64c3ed0fd9cd8afcb765144362147a2e"><div class="ttname"><a href="classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">femus::elem_type::Jacobian</a></div><div class="ttdeci">virtual void Jacobian(const std::vector&lt; std::vector&lt; adept::adouble &gt; &gt; &amp;vt, const unsigned &amp;ig, adept::adouble &amp;Weight, std::vector&lt; double &gt; &amp;phi, std::vector&lt; adept::adouble &gt; &amp;gradphi, boost::optional&lt; std::vector&lt; adept::adouble &gt; &amp; &gt; nablaphi=boost::none) const =0</div></div>
<div class="ttc" id="aclassfemus_1_1elem__type_html_a6d73c16abce658954e974bf32a5846c7"><div class="ttname"><a href="classfemus_1_1elem__type.html#a6d73c16abce658954e974bf32a5846c7">femus::elem_type::fill_volume_shape_funcs_at_boundary_quadrature_points_on_current_elem</a></div><div class="ttdeci">virtual void fill_volume_shape_funcs_at_boundary_quadrature_points_on_current_elem(const std::vector&lt; std::vector&lt; double &gt; &gt; &amp;vt, const std::vector&lt; std::vector&lt; double &gt; &gt; &amp;vt_bdry, const unsigned &amp;jface, const unsigned &amp;ig, std::vector&lt; double &gt; &amp;phi, std::vector&lt; double &gt; &amp;gradphi) const =0</div></div>
<div class="ttc" id="aclassfemus_1_1elem_html"><div class="ttname"><a href="classfemus_1_1elem.html">femus::elem</a></div><div class="ttdef"><b>Definition</b> <a href="_elem_8hpp_source.html#l00040">Elem.hpp:40</a></div></div>
<div class="ttc" id="aclassfemus_1_1elem_html_a491172d27d04d10ce166f42161d0c1d1"><div class="ttname"><a href="classfemus_1_1elem.html#a491172d27d04d10ce166f42161d0c1d1">femus::elem::GetFaceElementIndex</a></div><div class="ttdeci">int GetFaceElementIndex(const unsigned &amp;iel, const unsigned &amp;iface)</div><div class="ttdef"><b>Definition</b> <a href="_elem_8cpp_source.html#l00309">Elem.cpp:309</a></div></div>
<div class="ttc" id="aex40__other__a_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="ex40__other__a_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> <a href="ex40__other__a_8cpp_source.html#l00017">ex40_other_a.cpp:17</a></div></div>
<div class="ttc" id="anamespacefemus_1_1paral_html_aaa59cb24784a64914811ba1045135a05"><div class="ttname"><a href="namespacefemus_1_1paral.html#aaa59cb24784a64914811ba1045135a05">femus::paral::get_rank</a></div><div class="ttdeci">int get_rank()</div><div class="ttdef"><b>Definition</b> <a href="paral_8hpp_source.html#l00049">paral.hpp:49</a></div></div>
<div class="ttc" id="anamespacefemus_html"><div class="ttname"><a href="namespacefemus.html">femus</a></div><div class="ttdoc">Class FemusInit.</div><div class="ttdef"><b>Definition</b> <a href="_geom_el_type_enum_8hpp_source.html#l00007">GeomElTypeEnum.hpp:7</a></div></div>
<div class="ttc" id="anamespacefemus_html_a865501b20d45caeb12e3f10935e38cf6"><div class="ttname"><a href="namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">femus::ig</a></div><div class="ttdeci">const unsigned ig[N_GEOM_ELS][6][9]</div><div class="ttdef"><b>Definition</b> <a href="_elem_8hpp_source.html#l00345">Elem.hpp:345</a></div></div>
<div class="ttc" id="aparal_8hpp_html"><div class="ttname"><a href="paral_8hpp.html">paral.hpp</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a101671cfe5078b188740d5d892832ea9"><div class="ttname"><a href="solidopt__params_8hpp.html#a101671cfe5078b188740d5d892832ea9">cost_functional_coeff</a></div><div class="ttdeci">double cost_functional_coeff</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00025">solidopt_params.hpp:25</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a1dffa717bb8f2e25ad41baaf598c703f"><div class="ttname"><a href="solidopt__params_8hpp.html#a1dffa717bb8f2e25ad41baaf598c703f">ControlDomainFlag</a></div><div class="ttdeci">int ControlDomainFlag(const std::vector&lt; double &gt; &amp;elem_center)</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00080">solidopt_params.hpp:80</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a20f4c4490bc8ecbdd1ffcb79acce6035"><div class="ttname"><a href="solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a></div><div class="ttdeci">double alpha</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00026">solidopt_params.hpp:26</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a40646ef4581e21d1eac608c36580fff3"><div class="ttname"><a href="solidopt__params_8hpp.html#a40646ef4581e21d1eac608c36580fff3">NSUB</a></div><div class="ttdeci">#define NSUB</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00007">solidopt_params.hpp:7</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a491774c0485f249809d76f7933b79419"><div class="ttname"><a href="solidopt__params_8hpp.html#a491774c0485f249809d76f7933b79419">_gravity</a></div><div class="ttdeci">double _gravity[3]</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00020">solidopt_params.hpp:20</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a80e1487a07155d5b24edd6eca186b73b"><div class="ttname"><a href="solidopt__params_8hpp.html#a80e1487a07155d5b24edd6eca186b73b">TargetDisp</a></div><div class="ttdeci">double TargetDisp[3]</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00021">solidopt_params.hpp:21</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a860bedb684529775463fa3a6cb467efa"><div class="ttname"><a href="solidopt__params_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a></div><div class="ttdeci">#define NI</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00017">solidopt_params.hpp:17</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a9bdeca9b39b7e230510d2b7362e0115a"><div class="ttname"><a href="solidopt__params_8hpp.html#a9bdeca9b39b7e230510d2b7362e0115a">YOUNGS_MODULUS</a></div><div class="ttdeci">#define YOUNGS_MODULUS</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00015">solidopt_params.hpp:15</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_ac21b807d42c30aa7ebaa6a45a78134bd"><div class="ttname"><a href="solidopt__params_8hpp.html#ac21b807d42c30aa7ebaa6a45a78134bd">SOLID_DENSITY</a></div><div class="ttdeci">#define SOLID_DENSITY</div><div class="ttdef"><b>Definition</b> <a href="solidopt__params_8hpp_source.html#l00016">solidopt_params.hpp:16</a></div></div>
<div class="ttc" id="azzz__giorgiobornia__collect__all_8cpp_html_aa6cf7e343af28b995b6fab3d3528f6ef"><div class="ttname"><a href="zzz__giorgiobornia__collect__all_8cpp.html#aa6cf7e343af28b995b6fab3d3528f6ef">provide_list_of_unknowns</a></div><div class="ttdeci">const std::vector&lt; Unknown &gt; provide_list_of_unknowns()</div><div class="ttdef"><b>Definition</b> <a href="zzz__giorgiobornia__collect__all_8cpp_source.html#l00617">zzz_giorgiobornia_collect_all.cpp:617</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_a6e4fee11f07c3b70486e88fe92cbbdc.html">applications</a></li><li class="navelem"><a class="el" href="dir_501217f22831be4f16217d730416b2a6.html">OptimalControl</a></li><li class="navelem"><a class="el" href="dir_aceb110b2b68474a8d362ab18e84482d.html">04_solidopt</a></li><li class="navelem"><a class="el" href="dir_248c02187595740231b47fa26839acf7.html">01_solid_control_boundary</a></li><li class="navelem"><a class="el" href="01__solid__control__boundary_8cpp.html">01_solid_control_boundary.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
