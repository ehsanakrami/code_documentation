<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>femus: /home/ehsan/Desktop/insync_Poweredge/work/doxygen/femus/applications/OptimalControl/01_distributed_control_elliptic_nonlin/01_distributed_control_elliptic_nonlin.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">femus
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">01_distributed_control_elliptic_nonlin.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../da/d0d/FemusInit_8hpp_source.html">FemusInit.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d29/MultiLevelSolution_8hpp_source.html">MultiLevelSolution.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../da/de0/MultiLevelProblem_8hpp_source.html">MultiLevelProblem.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d64/VTKWriter_8hpp_source.html">VTKWriter.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d8f/NonLinearImplicitSystemWithPrimalDualActiveSetMethod_8hpp_source.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../df/d05/NumericVector_8hpp_source.html">NumericVector.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/df1/Math_8hpp_source.html">Math.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/d73/Assemble__jacobian_8hpp_source.html">Assemble_jacobian.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html">./elliptic_nonlin_param.hpp</a>&quot;</code><br />
</div>
<p><a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0d54f4d825c63982cb96543030037395"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a0d54f4d825c63982cb96543030037395">nonlin_term_function</a> (const double &amp;v)</td></tr>
<tr class="separator:a0d54f4d825c63982cb96543030037395"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae121ae9c414a6f68412c17068b0de5f3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#ae121ae9c414a6f68412c17068b0de5f3">nonlin_term_derivative</a> (const double &amp;v)</td></tr>
<tr class="separator:ae121ae9c414a6f68412c17068b0de5f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dec9191b407f5f1913e563b23777741"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a> (const <a class="el" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> *ml_prob, const std::vector&lt; double &gt; &amp;x, const char name[])</td></tr>
<tr class="separator:a5dec9191b407f5f1913e563b23777741"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ab90a1f3f518239872121a5071597ad"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a8ab90a1f3f518239872121a5071597ad">SetBoundaryCondition</a> (const std::vector&lt; double &gt; &amp;x, const char name[], double &amp;value, const int faceName, const double time)</td></tr>
<tr class="separator:a8ab90a1f3f518239872121a5071597ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa47a0490569399968fe2c22812a80a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#afa47a0490569399968fe2c22812a80a1">ComputeIntegral</a> (const <a class="el" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> &amp;ml_prob)</td></tr>
<tr class="separator:afa47a0490569399968fe2c22812a80a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a288dd20ec0c83eb3c427ca7ec6a6f107"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a288dd20ec0c83eb3c427ca7ec6a6f107">AssembleProblem</a> (<a class="el" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> &amp;ml_prob)</td></tr>
<tr class="separator:a288dd20ec0c83eb3c427ca7ec6a6f107"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a29781a20c5dd4153c3c1cecf0ff328"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a7a29781a20c5dd4153c3c1cecf0ff328">main</a> (int argc, char **args)</td></tr>
<tr class="separator:a7a29781a20c5dd4153c3c1cecf0ff328"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a288dd20ec0c83eb3c427ca7ec6a6f107"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a288dd20ec0c83eb3c427ca7ec6a6f107">&#9670;&nbsp;</a></span>AssembleProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AssembleProblem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> &amp;&#160;</td>
          <td class="paramname"><em>ml_prob</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00210">210</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                                 {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// ************** J dx = f - J x_old ******************  </span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">//  level is the level of the PDE system to be assembled</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">//  levelMax is the Maximum level of the MultiLevelProblem</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">//  assembleMatrix is a flag that tells if only the residual or also the matrix should be assembled</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a>* mlPdeSys  = &amp;ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a3d90edba93be2c202ea2bf8e87e20854">get_system</a>&lt;<a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a>&gt; (<span class="stringliteral">&quot;OptSys&quot;</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>          level      = mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a16af0d7b8849d6ea983a5e425fb90fee">GetLevelToAssemble</a>();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span>          assembleMatrix = mlPdeSys-&gt;<a class="code" href="../../d7/d82/classfemus_1_1LinearImplicitSystem.html#a7e1267a7b74760f606b435afbcc95c3b">GetAssembleMatrix</a>();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="../../d6/db7/classfemus_1_1Mesh.html">Mesh</a>*                          msh = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code" href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#ae5e4557f7784330822b988d83e2b6a40">GetLevel</a>(level);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html">MultiLevelSolution</a>*         ml_sol = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="../../d0/da2/classfemus_1_1Solution.html">Solution</a>*                      sol = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#afe428eaa84d414762c4cc3b8a1d4f4a7">GetSolutionLevel</a>(level);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="../../d7/d8c/classfemus_1_1LinearEquationSolver.html">LinearEquationSolver</a>*       pdeSys = mlPdeSys-&gt;<a class="code" href="../../d7/d82/classfemus_1_1LinearImplicitSystem.html#a58ebbec8ab1f2eb863cba438f30404e0">_LinSolver</a>[level];</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="../../d4/d37/classfemus_1_1SparseMatrix.html">SparseMatrix</a>*                   <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a> = pdeSys-&gt;<a class="code" href="../../d8/d3d/classfemus_1_1LinearEquation.html#aa10eb0eb318cf0d449f5ecdcec2823bc">_KK</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="../../db/dcb/classfemus_1_1NumericVector.html">NumericVector</a>*                 RES = pdeSys-&gt;<a class="code" href="../../d8/d3d/classfemus_1_1LinearEquation.html#a20ac8999e714492516cd8a2be53fb54f">_RES</a>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>                 <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a6f753fa456d2313d902bf184c4bb9e3b">GetDimension</a>();                                 <span class="comment">// get the domain dimension of the problem</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>                dim2 = (3 * (<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1) + !(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1));                        <span class="comment">// dim2 is the number of second order partial derivatives (1,3,6 depending on the dimension)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>            max_size = <span class="keyword">static_cast&lt;</span> <span class="keywordtype">unsigned</span> <span class="keyword">&gt;</span>(ceil(pow(3, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)));          <span class="comment">// conservative: based on line3, quad9, hex27</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>               iproc = msh-&gt;<a class="code" href="../../d2/df1/classfemus_1_1ParallelObject.html#a6438b3ffcc8cde2d6ccfb4ec563dfce1">processor_id</a>(); </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; <span class="comment">//************** geometry (at dofs) *************************************  </span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  vector &lt; vector &lt; double &gt; &gt; coords_at_dofs(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  vector &lt; unsigned int &gt;      SolFEType_domain(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) SolFEType_domain[d] = <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; coords_at_dofs.size(); i++)    coords_at_dofs[i].reserve(max_size);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; <span class="comment">//************** geometry (at quadrature points) *************************************  </span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  vector &lt; double &gt; coord_at_qp(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; <span class="comment">//************** geometry phi **************************</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_fe_qp_domain(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_x_fe_qp_domain(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_xx_fe_qp_domain(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> fe = 0; fe &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; fe++) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        phi_fe_qp_domain[fe].reserve(max_size);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      phi_x_fe_qp_domain[fe].reserve(max_size * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;     phi_xx_fe_qp_domain[fe].reserve(max_size * dim2);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; <span class="comment">//********* WHOLE SET OF VARIABLES ****************** </span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_unknowns = mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>().size();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keyword">enum</span> Sol_pos{pos_state = 0, pos_ctrl, pos_adj, pos_mu};  <span class="comment">//these are known at compile-time </span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">//right now this is the same as Sol_pos = SolPdeIndex, but now I want to have flexible rows and columns</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// the ROW index corresponds to the EQUATION we want to solve</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// the COLUMN index corresponds to the column variables </span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// Now, first of all we have to make sure that the Sparsity pattern is correctly built...</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// This means that we should write the Sparsity pattern with COLUMNS independent of ROWS!</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// But that implies that the BOUNDARY CONDITIONS will be enforced in OFF-DIAGONAL BLOCKS!</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="comment">// In fact, having the row order be different from the column order implies that the diagonal blocks would be RECTANGULAR.  </span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">// Although this is in principle possible, I would avoid doing that for now.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">//   const unsigned int pos_state = mlPdeSys-&gt;GetSolPdeIndex(&quot;state&quot;);   //these are known at run-time, so they are slower</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">//   const unsigned int pos_ctrl  = mlPdeSys-&gt;GetSolPdeIndex(&quot;control&quot;); //these are known at run-time, so they are slower</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">//   const unsigned int pos_adj   = mlPdeSys-&gt;GetSolPdeIndex(&quot;adjoint&quot;); //these are known at run-time, so they are slower</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">//   const unsigned int pos_mu    = mlPdeSys-&gt;GetSolPdeIndex(&quot;mu&quot;);      //these are known at run-time, so they are slower</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  assert(pos_state == mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>(<span class="stringliteral">&quot;state&quot;</span>));</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  assert(pos_ctrl  == mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>(<span class="stringliteral">&quot;control&quot;</span>));</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  assert(pos_adj   == mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>(<span class="stringliteral">&quot;adjoint&quot;</span>));</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  assert(pos_mu    == mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>(<span class="stringliteral">&quot;mu&quot;</span>));</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> solFEType_max = <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>;  <span class="comment">//biquadratic</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  vector &lt; std::string &gt; Solname(n_unknowns);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  Solname[pos_state] = <span class="stringliteral">&quot;state&quot;</span>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  Solname[pos_ctrl]  = <span class="stringliteral">&quot;control&quot;</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  Solname[pos_adj]   = <span class="stringliteral">&quot;adjoint&quot;</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  Solname[pos_mu]    = <span class="stringliteral">&quot;mu&quot;</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  vector &lt; unsigned int &gt; SolPdeIndex(n_unknowns);  <span class="comment">//index as in the row/column of the matrix (diagonal blocks are square)</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  vector &lt; unsigned int &gt; SolIndex(n_unknowns);     <span class="comment">//index as in the MultilevelSolution vector</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  vector &lt; unsigned int &gt; SolFEType(n_unknowns);    <span class="comment">//FEtype of each MultilevelSolution       </span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  vector &lt; unsigned int &gt; Sol_n_el_dofs(n_unknowns); <span class="comment">//number of element dofs</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  std::fill(Sol_n_el_dofs.begin(), Sol_n_el_dofs.end(), 0);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar=0; ivar &lt; n_unknowns; ivar++) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    SolPdeIndex[ivar] = mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>(  Solname[ivar].c_str() );</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    assert(ivar == SolPdeIndex[ivar]); </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    SolIndex[ivar] = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>         (  Solname[ivar].c_str() );</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    SolFEType[ivar] = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>  ( SolIndex[ivar]);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; <span class="comment">//************* shape functions (at dofs and quadrature points) **************************************  </span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordtype">double</span> weight_qp;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_fe_qp(n_unknowns);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_x_fe_qp(n_unknowns);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_xx_fe_qp(n_unknowns);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  vector &lt; vector &lt; vector &lt; double &gt; &gt; &gt; phi_x_fe_qp_vec(n_unknowns);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> fe = 0; fe &lt; n_unknowns; fe++) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        phi_fe_qp[fe].reserve(max_size);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      phi_x_fe_qp[fe].reserve(max_size * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;     phi_xx_fe_qp[fe].reserve(max_size * dim2);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  phi_x_fe_qp_vec[fe].resize(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  phi_x_fe_qp_vec[fe][d].reserve(max_size);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">//----------- quantities (at dof objects) ------------------------------</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  vector &lt; vector &lt; double &gt; &gt;     sol_eldofs(n_unknowns);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;n_unknowns; k++)  sol_eldofs[k].reserve(max_size);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">//************** act flag (at dof objects) **************************** </span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   std::string act_flag_name = <span class="stringliteral">&quot;act_flag&quot;</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> solIndex_act_flag = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>(act_flag_name.c_str());</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> solFEType_act_flag = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>(solIndex_act_flag); </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">if</span>(sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#af76dbb0089f696728146383d073b5205">GetSolutionTimeOrder</a>(solIndex_act_flag) == 2) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        *(sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5a9e3b150f6202162de4e350c39f544c">_SolOld</a>[solIndex_act_flag]) = *(sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[solIndex_act_flag]);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">//********* variables for ineq constraints (at dof objects) *****************</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ineq_flag = <a class="code" href="../../de/d33/03__opt__system__inequalities_8hpp.html#a4b681eb6859b04812f86861be922c517">INEQ_FLAG</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> c_compl = <a class="code" href="../../de/d33/03__opt__system__inequalities_8hpp.html#a90aa72cdc79d3af2036fdbb588d8c1d8">C_COMPL</a>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  vector &lt; <span class="keywordtype">double</span><span class="comment">/*int*/</span> &gt;  sol_actflag;   sol_actflag.reserve(max_size); <span class="comment">//flag for active set</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  vector &lt; double &gt;          ctrl_lower;    ctrl_lower.reserve(max_size);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  vector &lt; double &gt;          ctrl_upper;    ctrl_upper.reserve(max_size);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">//------------ quantities (at quadrature points) ---------------------</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            vector&lt;double&gt;        sol_qp(n_unknowns);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    vector&lt; vector&lt;double&gt; &gt; sol_grad_qp(n_unknowns);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      std::fill(sol_qp.begin(), sol_qp.end(), 0.);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        sol_grad_qp[k].resize(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        std::fill(sol_grad_qp[k].begin(), sol_grad_qp[k].end(), 0.);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">//******* EQUATION RELATED STUFF ********************************************  </span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; <span class="keywordtype">int</span> m_b_f[n_unknowns][n_unknowns];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;     m_b_f[pos_state][pos_state] = 1; <span class="comment">//nonzero</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;     m_b_f[pos_state][pos_ctrl]  = 0; <span class="comment">//THIS IS ZERO IN NON-LIFTING APPROACHES (there are also pieces that go on top on blocks that are already meant to be different from zero)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;     m_b_f[pos_state][pos_adj]   = 1; <span class="comment">//nonzero</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;     m_b_f[pos_state][pos_mu]    = 0;  <span class="comment">//this is zero without state constraints</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;     </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;     m_b_f[pos_ctrl][pos_state]  = 0;<span class="comment">//THIS IS ZERO IN NON-LIFTING APPROACHES</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;     m_b_f[pos_ctrl][pos_ctrl]   = 1;<span class="comment">//nonzero</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;     m_b_f[pos_ctrl][pos_adj]    = 1;<span class="comment">//nonzero</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;     m_b_f[pos_ctrl][pos_mu]     = 1;<span class="comment">//nonzero</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;     </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;     m_b_f[pos_adj][pos_state]  = 1; <span class="comment">//nonzero</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;     m_b_f[pos_adj][pos_ctrl]   = 1; <span class="comment">//nonzero</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;     m_b_f[pos_adj][pos_adj]    = 0; <span class="comment">//this must always be zero </span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;     m_b_f[pos_adj][pos_mu]     = 0; <span class="comment">//this must always be zero </span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;     </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;     m_b_f[pos_mu][pos_state]  = 0; <span class="comment">//this is zero without state constraints</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;     m_b_f[pos_mu][pos_ctrl]   = 1; <span class="comment">//nonzero</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;     m_b_f[pos_mu][pos_adj]    = 0; <span class="comment">//this must always be zero </span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;     m_b_f[pos_mu][pos_mu]     = 1; <span class="comment">//nonzero</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  vector &lt; vector &lt; int &gt; &gt; L2G_dofmap(n_unknowns);     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; n_unknowns; i++) { L2G_dofmap[i].reserve(max_size); }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            vector&lt; int &gt;   L2G_dofmap_AllVars; L2G_dofmap_AllVars.reserve( n_unknowns*max_size );</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            vector&lt; double &gt;         Res;                      Res.reserve( n_unknowns*max_size );</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            vector&lt; double &gt;         Jac;                      Jac.reserve( n_unknowns*max_size * n_unknowns*max_size);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">//********************* DATA ************************ </span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ab6042dc7aa551272ad555cac7a27efca">ALPHA_CTRL_VOL</a>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a>  = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a516ea8ebb0823e8c37feff8f4fe5afd1">BETA_CTRL_VOL</a>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordtype">double</span> penalty_strong = 10e+14;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  RES-&gt;<a class="code" href="../../db/dcb/classfemus_1_1NumericVector.html#a80b1efdc7101659f2035c2da880360e7">zero</a>();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">if</span> (assembleMatrix)  <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a>-&gt;zero();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// element loop: each process loops only on the elements that it owns</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iel = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">_elementOffset</a>[iproc]; iel &lt; msh-&gt;_elementOffset[iproc + 1]; iel++) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> ielGeom = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#af92bd9944b1d887562b460ede06acf44">GetElementType</a>(iel);    <span class="comment">// element geometry type</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; <span class="comment">//******************** GEOMETRY ********************* </span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> jdim = 0; jdim &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; jdim++) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordtype">unsigned</span> nDofx = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, SolFEType_domain[jdim]);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    coords_at_dofs[jdim].resize(nDofx);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// local storage of coordinates</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; coords_at_dofs[jdim].size(); i++) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordtype">unsigned</span> xDof  = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, SolFEType_domain[jdim]);  <span class="comment">// global to global mapping between coordinates node and coordinate dof</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        coords_at_dofs[jdim][i] = (*msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">_topology</a>-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[jdim])(xDof);      <span class="comment">// global extraction and local storage for the element coordinates</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="comment">// elem average point </span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    vector &lt; double &gt; elem_center(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);   </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = 0.;  }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; coords_at_dofs[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>].size(); i++) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] += coords_at_dofs[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>][i];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;       }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) { elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>]/coords_at_dofs[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>].size(); }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; <span class="comment">//****** set target domain flag ********************* </span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   <span class="keywordtype">int</span> target_flag = 0;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   target_flag = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ac26c656f6cba791120e68b91d327f1f0">ElementTargetFlag</a>(elem_center);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="comment">//all vars###################################################################  </span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordtype">unsigned</span>  ndofs_unk = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, SolFEType[k]);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;           Sol_n_el_dofs[k] = ndofs_unk;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          sol_eldofs[k].resize(ndofs_unk);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          L2G_dofmap[k].resize(ndofs_unk); </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; ndofs_unk; i++) {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;           <span class="keywordtype">unsigned</span> solDof = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, SolFEType[k]);                        <span class="comment">// global to global mapping between solution node and solution dof // via local to global solution node</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;           sol_eldofs[k][i] = (*sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[SolIndex[k]])(solDof);                            <span class="comment">// global extraction and local storage for the solution</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;           L2G_dofmap[k][i] = pdeSys-&gt;<a class="code" href="../../d8/d3d/classfemus_1_1LinearEquation.html#a4e339f53ed51e108cd33e1577dae9c18">GetSystemDof</a>(SolIndex[k], SolPdeIndex[k], i, iel);    <span class="comment">// global to global mapping between solution node and pdeSys dof</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="comment">//all vars###################################################################</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          phi_x_fe_qp_vec[k][d].resize(Sol_n_el_dofs[k]);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;     }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; <span class="comment">//************** update active set flag for current nonlinear iteration **************************** </span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; <span class="comment">// 0: inactive; 1: active_a; 2: active_b</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   assert(Sol_n_el_dofs[pos_mu] == Sol_n_el_dofs[pos_ctrl]);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   sol_actflag.resize(Sol_n_el_dofs[pos_mu]);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   ctrl_lower.resize(Sol_n_el_dofs[pos_mu]);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   ctrl_upper.resize(Sol_n_el_dofs[pos_mu]);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;     std::fill(sol_actflag.begin(), sol_actflag.end(), 0);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;     std::fill(ctrl_lower.begin(), ctrl_lower.end(), 0.);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;     std::fill(ctrl_upper.begin(), ctrl_upper.end(), 0.);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; sol_actflag.size(); i++) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        std::vector&lt;double&gt; node_coords_i(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>,0.);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) node_coords_i[d] = coords_at_dofs[d][i];</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        ctrl_lower[i] = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ad9a45c0f69f6ba97886caa1524904a0d">InequalityConstraint</a>(node_coords_i,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        ctrl_upper[i] = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ad9a45c0f69f6ba97886caa1524904a0d">InequalityConstraint</a>(node_coords_i,<span class="keyword">true</span>);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span>      ( (sol_eldofs[pos_mu][i] + c_compl * (sol_eldofs[pos_ctrl][i] - ctrl_lower[i] )) &lt; 0 )  sol_actflag[i] = 1;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (sol_eldofs[pos_mu][i] + c_compl * (sol_eldofs[pos_ctrl][i] - ctrl_upper[i] )) &gt; 0 )  sol_actflag[i] = 2;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; <span class="comment">//************** act flag **************************** </span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">unsigned</span> nDof_act_flag  = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, solFEType_act_flag);    <span class="comment">// number of solution element dofs</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nDof_act_flag; i++) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordtype">unsigned</span> solDof_mu = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, solFEType_act_flag); </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      (sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[solIndex_act_flag])-&gt;set(solDof_mu,sol_actflag[i]);     </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }    </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">//******************** ALL VARS ********************* </span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordtype">unsigned</span> nDof_AllVars = 0;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) { nDof_AllVars += Sol_n_el_dofs[k]; }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; <span class="comment">// TODO COMPUTE MAXIMUM maximum number of element dofs for one scalar variable</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">int</span> nDof_max    =  0;   </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++)     {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;          <span class="keywordflow">if</span>(Sol_n_el_dofs[k] &gt; nDof_max)    nDof_max = Sol_n_el_dofs[k];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    Res.resize(nDof_AllVars);                   std::fill(Res.begin(), Res.end(), 0.);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    Jac.resize(nDof_AllVars * nDof_AllVars);    std::fill(Jac.begin(), Jac.end(), 0.);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    L2G_dofmap_AllVars.resize(0);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++)     L2G_dofmap_AllVars.insert(L2G_dofmap_AllVars.end(),L2G_dofmap[k].begin(),L2G_dofmap[k].end());</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; <span class="comment">//***** set control flag ****************************</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">int</span> control_el_flag = 0;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      control_el_flag = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a847600aec5b463a41a4efdd6a7f1aa55">ControlDomainFlag_internal_restriction</a>(elem_center);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  std::vector&lt;int&gt; control_node_flag(Sol_n_el_dofs[pos_ctrl],0);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">if</span> (control_el_flag == 1) std::fill(control_node_flag.begin(), control_node_flag.end(), 1);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="comment">// *** Gauss point loop ***</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> = 0; <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> &lt; msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][solFEType_max]-&gt;<a class="code" href="../../d3/dca/classfemus_1_1elem__type.html#a3fa8f889f9ae97586b3db574acb4448e">GetGaussPointNumber</a>(); <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>++) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="comment">// *** get gauss point weight, test function and test function partial derivatives ***</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;         msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType[k]]-&gt;<a class="code" href="../../d3/dca/classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_at_dofs, <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_qp, phi_fe_qp[k], phi_x_fe_qp[k], phi_xx_fe_qp[k]);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; Sol_n_el_dofs[k]; i++) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          phi_x_fe_qp_vec[k][d][i] =  phi_x_fe_qp[k][i * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + d];</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;       }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;     }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;   }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="comment">//HAVE TO RECALL IT TO HAVE BIQUADRATIC JACOBIAN</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;         msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType_domain[d]]-&gt;<a class="code" href="../../d3/dca/classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_at_dofs, <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>, weight_qp, phi_fe_qp_domain[d], phi_x_fe_qp_domain[d], phi_xx_fe_qp_domain[d]);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; <span class="comment">//========= fill gauss value xyz ==================   </span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   std::fill(coord_at_qp.begin(), coord_at_qp.end(), 0.);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; coords_at_dofs[d].size(); i++) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;               coord_at_qp[d] += coords_at_dofs[d][i] * phi_fe_qp_domain[d][i];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="comment">//========= fill gauss value xyz ==================   </span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; <span class="comment">//========= fill gauss value quantities ==================   </span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   std::fill(sol_qp.begin(), sol_qp.end(), 0.);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) { std::fill(sol_grad_qp[k].begin(), sol_grad_qp[k].end(), 0.); }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[k]; i++) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                                                 sol_qp[k]    += sol_eldofs[k][i] *   phi_fe_qp[k][i];</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++)   sol_grad_qp[k][d] += sol_eldofs[k][i] * phi_x_fe_qp[k][i * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + d];</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;       }        </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; <span class="comment">//========= fill gauss value quantities ==================   </span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">//==========FILLING THE EQUATIONS ===========</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nDof_max; i++) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">//======================Residuals=======================</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          <span class="comment">// ===============</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        Res[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs,pos_state,i) ] += - weight_qp * (target_flag * phi_fe_qp[pos_state][i] * (</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                                                                              m_b_f[pos_state][pos_state] * sol_qp[pos_state] </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                                                                            - <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a34bfabfdd8d16d8a726b3d24178f0d2d">DesiredTarget</a>(coord_at_qp) ) </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                                                                          + m_b_f[pos_state][pos_adj]   * ( <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::laplacian_row</a>(phi_x_fe_qp_vec, sol_grad_qp, pos_state, pos_adj, i, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)  </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                                                                                                            - sol_qp[pos_adj] *  <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#ae121ae9c414a6f68412c17068b0de5f3">nonlin_term_derivative</a>(phi_fe_qp[pos_state][i]) *  sol_qp[pos_ctrl]) );</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          <span class="comment">// ==============</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;             <span class="keywordflow">if</span> ( control_el_flag == 1)        Res[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs,pos_ctrl,i) ] +=  <span class="comment">/*(control_node_flag[i]) **/</span> - weight_qp * (</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                                                                  + m_b_f[pos_ctrl][pos_ctrl] * <a class="code" href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> * phi_fe_qp[pos_ctrl][i] * sol_qp[pos_ctrl]</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                                                                          + m_b_f[pos_ctrl][pos_ctrl] *  <a class="code" href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a> * <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::laplacian_row</a>(phi_x_fe_qp_vec, sol_grad_qp, pos_ctrl, pos_ctrl, i, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>) </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                                                                          - m_b_f[pos_ctrl][pos_adj]  *         phi_fe_qp[pos_ctrl][i] * sol_qp[pos_adj] * <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a0d54f4d825c63982cb96543030037395">nonlin_term_function</a>(sol_qp[pos_state])</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                                                                                                         );</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( control_el_flag == 0)  Res[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs,pos_ctrl,i) ] +=  <span class="comment">/*(1 - control_node_flag[i]) **/</span> m_b_f[pos_ctrl][pos_ctrl] * (- penalty_strong) * (sol_eldofs[pos_ctrl][i]);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <span class="comment">// =============</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        Res[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::res_row_index</a>(Sol_n_el_dofs,pos_adj,i) ] += - weight_qp *  ( + m_b_f[pos_adj][pos_state] * <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::laplacian_row</a>(phi_x_fe_qp_vec, sol_grad_qp, pos_adj, pos_state, i, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>) </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                                                          - m_b_f[pos_adj][pos_ctrl]  * phi_fe_qp[pos_adj][i] * sol_qp[pos_ctrl] * <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a0d54f4d825c63982cb96543030037395">nonlin_term_function</a>(sol_qp[pos_state]) </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                                                        );</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">//======================End Residuals=======================</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;              </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          <span class="keywordflow">if</span> (assembleMatrix) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="comment">// *** phi_j loop ***</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; nDof_max; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;              <span class="comment">//============ delta_state row ============================</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_state, pos_state, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>) ]  += </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                                      m_b_f[pos_state][pos_state] * weight_qp * target_flag * phi_fe_qp[pos_state][<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] *  phi_fe_qp[pos_state][i];</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;              </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_state, pos_adj, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>)  ]  +=</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                                              m_b_f[pos_state][pos_adj] * weight_qp * (</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                                                          <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::laplacian_row_col</a>(phi_x_fe_qp_vec,phi_x_fe_qp_vec, pos_state, pos_adj, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                                                                                                       - phi_fe_qp[pos_adj][<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] *</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                                                                                         <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#ae121ae9c414a6f68412c17068b0de5f3">nonlin_term_derivative</a>(phi_fe_qp[pos_state][i]) * </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                                                                                         sol_qp[pos_ctrl]</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                                                                                              );</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;              </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;              <span class="comment">//=========== delta_control row ===========================     </span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;              <span class="keywordflow">if</span> ( control_el_flag == 1)  {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_ctrl, pos_ctrl, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>) ]  += </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                                              m_b_f[pos_ctrl][pos_ctrl] * ( control_node_flag[i]) * weight_qp * (</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                                                                  <a class="code" href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a> * control_el_flag  * <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::laplacian_row_col</a>(phi_x_fe_qp_vec,phi_x_fe_qp_vec, pos_ctrl, pos_ctrl, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>) </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                                                               + <a class="code" href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> * control_el_flag  * phi_fe_qp[pos_ctrl][i] * phi_fe_qp[pos_ctrl][<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                                                                                    );</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;              </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_ctrl, pos_adj, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>) ]  += m_b_f[pos_ctrl][pos_adj] * control_node_flag[i] * weight_qp * (</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                                                                                                                      - phi_fe_qp[pos_ctrl][i] * </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                                                                                                                        phi_fe_qp[pos_adj][<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] * </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                                                                                                                        <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a0d54f4d825c63982cb96543030037395">nonlin_term_function</a>(sol_qp[pos_state])</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                                                                                    );</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;              </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( control_el_flag == 0 &amp;&amp; i == <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>)  {  </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_ctrl, pos_ctrl, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>) ]  += m_b_f[pos_ctrl][pos_ctrl] * (1 - control_node_flag[i]) * penalty_strong;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;              }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;              </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;              <span class="comment">//=========== delta_adjoint row ===========================</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_adj, pos_state, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>) ]  += m_b_f[pos_adj][pos_state] * weight_qp * (</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                                                                                                                      <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::laplacian_row_col</a>(phi_x_fe_qp_vec,phi_x_fe_qp_vec, pos_adj, pos_state, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                                                                                                                      - phi_fe_qp[pos_adj][i] *</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                                                                                                                        <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#ae121ae9c414a6f68412c17068b0de5f3">nonlin_term_derivative</a>(phi_fe_qp[pos_state][<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>]) * </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                                                                                                                        sol_qp[pos_ctrl]</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                                                                                                                    );</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        Jac[ <a class="code" href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">assemble_jacobian&lt;double,double&gt;::jac_row_col_index</a>(Sol_n_el_dofs, nDof_AllVars, pos_adj, pos_ctrl, i, <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>)  ]  += m_b_f[pos_adj][pos_ctrl] * weight_qp * ( </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                                                                                                                      - phi_fe_qp[pos_adj][i] * </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                                                                                                                        phi_fe_qp[pos_ctrl][<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] * </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                                                                                                                        <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a0d54f4d825c63982cb96543030037395">nonlin_term_function</a>(sol_qp[pos_state])</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                                                                                                                   ); </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                     </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;              </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            } <span class="comment">// end phi_j loop</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          } <span class="comment">// endif assemble_matrix</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        } <span class="comment">// end phi_i loop</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      } <span class="comment">// end gauss point loop</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">//std::vector&lt;double&gt; Res_ctrl (Sol_n_el_dofs[pos_ctrl]); std::fill(Res_ctrl.begin(),Res_ctrl.end(), 0.);</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; sol_eldofs[pos_ctrl].size(); i++) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;       <span class="keywordtype">unsigned</span> n_els_that_node = 1;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;     <span class="keywordflow">if</span> ( control_el_flag == 1) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">//      Res[Sol_n_el_dofs[pos_state] + i] += - ( + n_els_that_node * ineq_flag * sol_eldofs[pos_mu][i] /*- ( 0.4 + sin(M_PI * x[0][i]) * sin(M_PI * x[1][i]) )*/ );</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">//      Res_ctrl[i] =  Res[Sol_n_el_dofs[pos_state] + i];</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; <span class="comment">//========== end of integral-based part</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                          RES-&gt;<a class="code" href="../../db/dcb/classfemus_1_1NumericVector.html#a0440021963af01ac49a6f02df562e44b">add_vector_blocked</a>(Res, L2G_dofmap_AllVars);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">if</span> (assembleMatrix)  <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a>-&gt;add_matrix_blocked(Jac, L2G_dofmap_AllVars, L2G_dofmap_AllVars);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; <span class="comment">//========== dof-based part, without summation</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; <span class="comment">//============= delta_mu row ===============================</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      std::vector&lt;double&gt; Res_mu (Sol_n_el_dofs[pos_mu]); std::fill(Res_mu.begin(),Res_mu.end(), 0.);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; sol_actflag.size(); i++) {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">if</span> (sol_actflag[i] == 0) {  <span class="comment">//inactive</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;         Res_mu [i] = (- ineq_flag) * ( 1. * sol_eldofs[pos_mu][i] ); </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">//       Res_mu [i] = Res[res_row_index(Sol_n_el_dofs,pos_mu,i)]; </span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sol_actflag[i] == 1) {  <span class="comment">//active_a </span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;             Res_mu [i] = (- ineq_flag) * c_compl * ( sol_eldofs[pos_ctrl][i] - ctrl_lower[i]);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sol_actflag[i] == 2) {  <span class="comment">//active_b </span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;             Res_mu [i] = (- ineq_flag) * c_compl * ( sol_eldofs[pos_ctrl][i] - ctrl_upper[i]);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    RES-&gt;<a class="code" href="../../db/dcb/classfemus_1_1NumericVector.html#a96f696c38f27d57cf58bfb0fac9d9f6f">insert</a>(Res_mu, L2G_dofmap[pos_mu]);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; <span class="comment">//============= delta_ctrl - mu ===============================</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a>-&gt;matrix_set_off_diagonal_values_blocked(L2G_dofmap[pos_ctrl], L2G_dofmap[pos_mu], m_b_f[pos_ctrl][pos_mu] * ineq_flag * 1.);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; <span class="comment">//============= delta_mu - ctrl row ===============================</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; sol_actflag.size(); i++) <span class="keywordflow">if</span> (sol_actflag[i] != 0 ) sol_actflag[i] = m_b_f[pos_mu][pos_ctrl] * ineq_flag * c_compl;    </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a>-&gt;matrix_set_off_diagonal_values_blocked(L2G_dofmap[pos_mu], L2G_dofmap[pos_ctrl], sol_actflag);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; <span class="comment">//============= delta_mu - mu row ===============================</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; sol_actflag.size(); i++) sol_actflag[i] =  m_b_f[pos_mu][pos_mu] * ( ineq_flag * (1 - sol_actflag[i]/c_compl)  + (1-ineq_flag) * 1. ); <span class="comment">//can do better to avoid division, maybe use modulo operator </span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a>-&gt;matrix_set_off_diagonal_values_blocked(L2G_dofmap[pos_mu], L2G_dofmap[pos_mu], sol_actflag );</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  } <span class="comment">//end element loop for each process</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  RES-&gt;<a class="code" href="../../db/dcb/classfemus_1_1NumericVector.html#a80eb1dc1f53018fd7d08bcc4a511cc09">close</a>();</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keywordflow">if</span> (assembleMatrix) <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a>-&gt;close();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">//  std::ostringstream mat_out; mat_out &lt;&lt; ml_prob.GetFilesHandler()-&gt;GetOutputPath() &lt;&lt; &quot;/&quot; &lt;&lt; &quot;jacobian&quot; &lt;&lt; mlPdeSys-&gt;GetNonlinearIt()  &lt;&lt; &quot;.txt&quot;;</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">//   KK-&gt;print_matlab(mat_out.str(),&quot;ascii&quot;); </span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">//    KK-&gt;print();</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// ***************** END ASSEMBLY *******************</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> global_ctrl_size = pdeSys-&gt;<a class="code" href="../../d8/d3d/classfemus_1_1LinearEquation.html#ae3ec0b2dd39e7527448bc35f108f6093">KKoffset</a>[pos_ctrl+1][iproc] - pdeSys-&gt;<a class="code" href="../../d8/d3d/classfemus_1_1LinearEquation.html#ae3ec0b2dd39e7527448bc35f108f6093">KKoffset</a>[pos_ctrl][iproc];</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  std::vector&lt;double&gt;  one_times_mu(global_ctrl_size, 0.);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  std::vector&lt;int&gt;        positions(global_ctrl_size);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">//  double position_mu_i;</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; positions.size(); i++) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    positions[i] = pdeSys-&gt;<a class="code" href="../../d8/d3d/classfemus_1_1LinearEquation.html#ae3ec0b2dd39e7527448bc35f108f6093">KKoffset</a>[pos_ctrl][iproc] + i;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">//     position_mu_i = pdeSys-&gt;KKoffset[pos_mu][iproc] + i;</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">//     std::cout &lt;&lt; position_mu_i &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    one_times_mu[i] =  m_b_f[pos_ctrl][pos_mu] * ineq_flag * 1. * (*sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[SolIndex[pos_mu]])(i<span class="comment">/*position_mu_i*/</span>) ;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    RES-&gt;<a class="code" href="../../db/dcb/classfemus_1_1NumericVector.html#a0440021963af01ac49a6f02df562e44b">add_vector_blocked</a>(one_times_mu, positions);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">//     RES-&gt;print();</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div>
<div class="ttc" id="a01__distributed__control__elliptic__nonlin_8cpp_html_a0d54f4d825c63982cb96543030037395"><div class="ttname"><a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a0d54f4d825c63982cb96543030037395">nonlin_term_function</a></div><div class="ttdeci">double nonlin_term_function(const double &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00019">01_distributed_control_elliptic_nonlin.cpp:19</a></div></div>
<div class="ttc" id="a01__distributed__control__elliptic__nonlin_8cpp_html_ae121ae9c414a6f68412c17068b0de5f3"><div class="ttname"><a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#ae121ae9c414a6f68412c17068b0de5f3">nonlin_term_derivative</a></div><div class="ttdeci">double nonlin_term_derivative(const double &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00028">01_distributed_control_elliptic_nonlin.cpp:28</a></div></div>
<div class="ttc" id="a03__opt__system__inequalities_8hpp_html_a4b681eb6859b04812f86861be922c517"><div class="ttname"><a href="../../de/d33/03__opt__system__inequalities_8hpp.html#a4b681eb6859b04812f86861be922c517">INEQ_FLAG</a></div><div class="ttdeci">#define INEQ_FLAG</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d33/03__opt__system__inequalities_8hpp_source.html#l00011">03_opt_system_inequalities.hpp:11</a></div></div>
<div class="ttc" id="a03__opt__system__inequalities_8hpp_html_a90aa72cdc79d3af2036fdbb588d8c1d8"><div class="ttname"><a href="../../de/d33/03__opt__system__inequalities_8hpp.html#a90aa72cdc79d3af2036fdbb588d8c1d8">C_COMPL</a></div><div class="ttdeci">#define C_COMPL</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d33/03__opt__system__inequalities_8hpp_source.html#l00012">03_opt_system_inequalities.hpp:12</a></div></div>
<div class="ttc" id="aConformal_2ex3_2ex3_8cpp_html_a4049344c4d6020a322197047b513967f"><div class="ttname"><a href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a></div><div class="ttdeci">const double beta</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d87/Conformal_2ex3_2ex3_8cpp_source.html#l00023">ex3.cpp:23</a></div></div>
<div class="ttc" id="aFETypeEnum_8hpp_html_a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451"><div class="ttname"><a href="../../df/d21/FETypeEnum_8hpp.html#a31f830fd5deccf18a6e312b026bbe13ba886f39d2f1a5889032091a8a4244f451">KK</a></div><div class="ttdeci">@ KK</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d21/FETypeEnum_8hpp_source.html#l00005">FETypeEnum.hpp:5</a></div></div>
<div class="ttc" id="aFETypeEnum_8hpp_html_a789a31c8b16fddbe5ad66911ec7933c6"><div class="ttname"><a href="../../df/d21/FETypeEnum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a></div><div class="ttdeci">#define BIQUADR_FE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d21/FETypeEnum_8hpp_source.html#l00010">FETypeEnum.hpp:10</a></div></div>
<div class="ttc" id="aISM_2ex4_2ex4_8cpp_html_aece1bc3fff4b670afc08354a6d995a0e"><div class="ttname"><a href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a></div><div class="ttdeci">unsigned dim</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2c/ISM_2ex4_2ex4_8cpp_source.html#l00031">ex4.cpp:31</a></div></div>
<div class="ttc" id="aMGAMR_2ex9_2MG__precond_8m_html_ac86694252f8dfdb19aaeadc4b7c342c6"><div class="ttname"><a href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a></div><div class="ttdeci">for j</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m_source.html#l00032">MG_precond.m:32</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearEquationSolver_html"><div class="ttname"><a href="../../d7/d8c/classfemus_1_1LinearEquationSolver.html">femus::LinearEquationSolver</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/LinearEquationSolver_8hpp_source.html#l00055">LinearEquationSolver.hpp:55</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearEquation_html_a20ac8999e714492516cd8a2be53fb54f"><div class="ttname"><a href="../../d8/d3d/classfemus_1_1LinearEquation.html#a20ac8999e714492516cd8a2be53fb54f">femus::LinearEquation::_RES</a></div><div class="ttdeci">NumericVector * _RES</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de2/LinearEquation_8hpp_source.html#l00115">LinearEquation.hpp:115</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearEquation_html_a4e339f53ed51e108cd33e1577dae9c18"><div class="ttname"><a href="../../d8/d3d/classfemus_1_1LinearEquation.html#a4e339f53ed51e108cd33e1577dae9c18">femus::LinearEquation::GetSystemDof</a></div><div class="ttdeci">unsigned GetSystemDof(const unsigned &amp;index_sol, const unsigned &amp;kkindex_sol, const unsigned &amp;i, const unsigned &amp;iel) const</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d45/LinearEquation_8cpp_source.html#l00071">LinearEquation.cpp:71</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearEquation_html_aa10eb0eb318cf0d449f5ecdcec2823bc"><div class="ttname"><a href="../../d8/d3d/classfemus_1_1LinearEquation.html#aa10eb0eb318cf0d449f5ecdcec2823bc">femus::LinearEquation::_KK</a></div><div class="ttdeci">SparseMatrix * _KK</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de2/LinearEquation_8hpp_source.html#l00118">LinearEquation.hpp:118</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearEquation_html_ae3ec0b2dd39e7527448bc35f108f6093"><div class="ttname"><a href="../../d8/d3d/classfemus_1_1LinearEquation.html#ae3ec0b2dd39e7527448bc35f108f6093">femus::LinearEquation::KKoffset</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; unsigned &gt; &gt; KKoffset</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de2/LinearEquation_8hpp_source.html#l00125">LinearEquation.hpp:125</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearImplicitSystem_html_a58ebbec8ab1f2eb863cba438f30404e0"><div class="ttname"><a href="../../d7/d82/classfemus_1_1LinearImplicitSystem.html#a58ebbec8ab1f2eb863cba438f30404e0">femus::LinearImplicitSystem::_LinSolver</a></div><div class="ttdeci">vector&lt; LinearEquationSolver * &gt; _LinSolver</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/LinearImplicitSystem_8hpp_source.html#l00077">LinearImplicitSystem.hpp:77</a></div></div>
<div class="ttc" id="aclassfemus_1_1LinearImplicitSystem_html_a7e1267a7b74760f606b435afbcc95c3b"><div class="ttname"><a href="../../d7/d82/classfemus_1_1LinearImplicitSystem.html#a7e1267a7b74760f606b435afbcc95c3b">femus::LinearImplicitSystem::GetAssembleMatrix</a></div><div class="ttdeci">bool GetAssembleMatrix()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/LinearImplicitSystem_8hpp_source.html#l00224">LinearImplicitSystem.hpp:224</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html">femus::Mesh</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d62/Mesh_8hpp_source.html#l00048">Mesh.hpp:48</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_a555c4982e81fc0042426c6741a792ca2"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">femus::Mesh::_finiteElement</a></div><div class="ttdeci">const elem_type * _finiteElement[N_GEOM_ELS][5]</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d62/Mesh_8hpp_source.html#l00321">Mesh.hpp:321</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_a679fa1625833f437ea38d2cc651c7462"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#a679fa1625833f437ea38d2cc651c7462">femus::Mesh::GetElementDofNumber</a></div><div class="ttdeci">unsigned GetElementDofNumber(const unsigned &amp;iel, const unsigned &amp;type) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dcc/Mesh_8cpp_source.html#l01222">Mesh.cpp:1222</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_a6f753fa456d2313d902bf184c4bb9e3b"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#a6f753fa456d2313d902bf184c4bb9e3b">femus::Mesh::GetDimension</a></div><div class="ttdeci">const unsigned GetDimension() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d62/Mesh_8hpp_source.html#l00074">Mesh.hpp:74</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_ac436cfb1f4caaec0c4335358ff8a51d8"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">femus::Mesh::_topology</a></div><div class="ttdeci">Solution * _topology</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d62/Mesh_8hpp_source.html#l00464">Mesh.hpp:464</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_aca17a5dc69b8cfb941b8bbe7ae4a615e"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">femus::Mesh::_elementOffset</a></div><div class="ttdeci">std::vector&lt; unsigned &gt; _elementOffset</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d62/Mesh_8hpp_source.html#l00162">Mesh.hpp:162</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_ace44edec2dc2ffb42c0456f03fa227ff"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">femus::Mesh::GetSolutionDof</a></div><div class="ttdeci">unsigned GetSolutionDof(const unsigned &amp;i, const unsigned &amp;iel, const short unsigned &amp;solType) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dcc/Mesh_8cpp_source.html#l00902">Mesh.cpp:902</a></div></div>
<div class="ttc" id="aclassfemus_1_1Mesh_html_af92bd9944b1d887562b460ede06acf44"><div class="ttname"><a href="../../d6/db7/classfemus_1_1Mesh.html#af92bd9944b1d887562b460ede06acf44">femus::Mesh::GetElementType</a></div><div class="ttdeci">short unsigned GetElementType(const unsigned &amp;iel) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dcc/Mesh_8cpp_source.html#l01212">Mesh.cpp:1212</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelMesh_html_ae5e4557f7784330822b988d83e2b6a40"><div class="ttname"><a href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#ae5e4557f7784330822b988d83e2b6a40">femus::MultiLevelMesh::GetLevel</a></div><div class="ttdeci">Mesh * GetLevel(const unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d21/MultiLevelMesh_8hpp_source.html#l00147">MultiLevelMesh.hpp:147</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_a3d90edba93be2c202ea2bf8e87e20854"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a3d90edba93be2c202ea2bf8e87e20854">femus::MultiLevelProblem::get_system</a></div><div class="ttdeci">const T_sys &amp; get_system(const std::string &amp;name) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/MultiLevelProblem_8hpp_source.html#l00519">MultiLevelProblem.hpp:519</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_a6dd8fec26a0ffbaae07e6df7ea42d12b"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">femus::MultiLevelProblem::_ml_sol</a></div><div class="ttdeci">MultiLevelSolution * _ml_sol</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/MultiLevelProblem_8hpp_source.html#l00079">MultiLevelProblem.hpp:79</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_a946d39c3fba7fac859822702248fe065"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a946d39c3fba7fac859822702248fe065">femus::MultiLevelProblem::_ml_msh</a></div><div class="ttdeci">MultiLevelMesh * _ml_msh</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/MultiLevelProblem_8hpp_source.html#l00116">MultiLevelProblem.hpp:116</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelSolution_html"><div class="ttname"><a href="../../db/d17/classfemus_1_1MultiLevelSolution.html">femus::MultiLevelSolution</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d29/MultiLevelSolution_8hpp_source.html#l00043">MultiLevelSolution.hpp:43</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelSolution_html_a0c3d81a9146a8e96552da43955f0c7ae"><div class="ttname"><a href="../../db/d17/classfemus_1_1MultiLevelSolution.html#a0c3d81a9146a8e96552da43955f0c7ae">femus::MultiLevelSolution::GetIndex</a></div><div class="ttdeci">unsigned GetIndex(const char name[]) const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/MultiLevelSolution_8cpp_source.html#l00444">MultiLevelSolution.cpp:444</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelSolution_html_ac6285c5a1907ad1f93ad7b380a08dabe"><div class="ttname"><a href="../../db/d17/classfemus_1_1MultiLevelSolution.html#ac6285c5a1907ad1f93ad7b380a08dabe">femus::MultiLevelSolution::GetSolutionType</a></div><div class="ttdeci">int GetSolutionType(unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d29/MultiLevelSolution_8hpp_source.html#l00186">MultiLevelSolution.hpp:186</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelSolution_html_afe428eaa84d414762c4cc3b8a1d4f4a7"><div class="ttname"><a href="../../db/d17/classfemus_1_1MultiLevelSolution.html#afe428eaa84d414762c4cc3b8a1d4f4a7">femus::MultiLevelSolution::GetSolutionLevel</a></div><div class="ttdeci">Solution * GetSolutionLevel(const unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d29/MultiLevelSolution_8hpp_source.html#l00138">MultiLevelSolution.hpp:138</a></div></div>
<div class="ttc" id="aclassfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod_html"><div class="ttname"><a href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">femus::NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d8f/NonLinearImplicitSystemWithPrimalDualActiveSetMethod_8hpp_source.html#l00035">NonLinearImplicitSystemWithPrimalDualActiveSetMethod.hpp:35</a></div></div>
<div class="ttc" id="aclassfemus_1_1NumericVector_html"><div class="ttname"><a href="../../db/dcb/classfemus_1_1NumericVector.html">femus::NumericVector</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d05/NumericVector_8hpp_source.html#l00051">NumericVector.hpp:51</a></div></div>
<div class="ttc" id="aclassfemus_1_1NumericVector_html_a0440021963af01ac49a6f02df562e44b"><div class="ttname"><a href="../../db/dcb/classfemus_1_1NumericVector.html#a0440021963af01ac49a6f02df562e44b">femus::NumericVector::add_vector_blocked</a></div><div class="ttdeci">virtual void add_vector_blocked(const std::vector&lt; double &gt; &amp;v, const std::vector&lt; int &gt; &amp;dof_indices)=0</div><div class="ttdoc">where v is a std::vector !!!fast</div></div>
<div class="ttc" id="aclassfemus_1_1NumericVector_html_a80b1efdc7101659f2035c2da880360e7"><div class="ttname"><a href="../../db/dcb/classfemus_1_1NumericVector.html#a80b1efdc7101659f2035c2da880360e7">femus::NumericVector::zero</a></div><div class="ttdeci">virtual void zero()=0</div><div class="ttdoc">Set all entries to zero. Equivalent to v = 0.</div></div>
<div class="ttc" id="aclassfemus_1_1NumericVector_html_a80eb1dc1f53018fd7d08bcc4a511cc09"><div class="ttname"><a href="../../db/dcb/classfemus_1_1NumericVector.html#a80eb1dc1f53018fd7d08bcc4a511cc09">femus::NumericVector::close</a></div><div class="ttdeci">virtual void close()=0</div></div>
<div class="ttc" id="aclassfemus_1_1NumericVector_html_a96f696c38f27d57cf58bfb0fac9d9f6f"><div class="ttname"><a href="../../db/dcb/classfemus_1_1NumericVector.html#a96f696c38f27d57cf58bfb0fac9d9f6f">femus::NumericVector::insert</a></div><div class="ttdeci">virtual void insert(const std::vector&lt; double &gt; &amp;v, const std::vector&lt; int &gt; &amp;dof_indices)=0</div><div class="ttdoc">where v is a std::vector&lt;double&gt; andspecify WHERE to insert it</div></div>
<div class="ttc" id="aclassfemus_1_1ParallelObject_html_a6438b3ffcc8cde2d6ccfb4ec563dfce1"><div class="ttname"><a href="../../d2/df1/classfemus_1_1ParallelObject.html#a6438b3ffcc8cde2d6ccfb4ec563dfce1">femus::ParallelObject::processor_id</a></div><div class="ttdeci">int processor_id() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db9/ParallelObject_8hpp_source.html#l00053">ParallelObject.hpp:53</a></div></div>
<div class="ttc" id="aclassfemus_1_1Solution_html"><div class="ttname"><a href="../../d0/da2/classfemus_1_1Solution.html">femus::Solution</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d9b/Solution_8hpp_source.html#l00049">Solution.hpp:49</a></div></div>
<div class="ttc" id="aclassfemus_1_1Solution_html_a5a9e3b150f6202162de4e350c39f544c"><div class="ttname"><a href="../../d0/da2/classfemus_1_1Solution.html#a5a9e3b150f6202162de4e350c39f544c">femus::Solution::_SolOld</a></div><div class="ttdeci">std::vector&lt; NumericVector * &gt; _SolOld</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d9b/Solution_8hpp_source.html#l00167">Solution.hpp:167</a></div></div>
<div class="ttc" id="aclassfemus_1_1Solution_html_a5c725da69d0b94b7ff4a4e2509c86d53"><div class="ttname"><a href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">femus::Solution::_Sol</a></div><div class="ttdeci">std::vector&lt; NumericVector * &gt; _Sol</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d9b/Solution_8hpp_source.html#l00151">Solution.hpp:151</a></div></div>
<div class="ttc" id="aclassfemus_1_1Solution_html_af76dbb0089f696728146383d073b5205"><div class="ttname"><a href="../../d0/da2/classfemus_1_1Solution.html#af76dbb0089f696728146383d073b5205">femus::Solution::GetSolutionTimeOrder</a></div><div class="ttdeci">unsigned GetSolutionTimeOrder(unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d9b/Solution_8hpp_source.html#l00162">Solution.hpp:162</a></div></div>
<div class="ttc" id="aclassfemus_1_1SparseMatrix_html"><div class="ttname"><a href="../../d4/d37/classfemus_1_1SparseMatrix.html">femus::SparseMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d01/SparseMatrix_8hpp_source.html#l00047">SparseMatrix.hpp:47</a></div></div>
<div class="ttc" id="aclassfemus_1_1System_html_a16af0d7b8849d6ea983a5e425fb90fee"><div class="ttname"><a href="../../d4/d23/classfemus_1_1System.html#a16af0d7b8849d6ea983a5e425fb90fee">femus::System::GetLevelToAssemble</a></div><div class="ttdeci">unsigned GetLevelToAssemble() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d25/System_8hpp_source.html#l00116">System.hpp:116</a></div></div>
<div class="ttc" id="aclassfemus_1_1System_html_a4ebc859deb32b54c9936fa28f1485a93"><div class="ttname"><a href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">femus::System::GetSolPdeIndex</a></div><div class="ttdeci">unsigned GetSolPdeIndex(const char solname[])</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/System_8cpp_source.html#l00087">System.cpp:87</a></div></div>
<div class="ttc" id="aclassfemus_1_1assemble__jacobian_html"><div class="ttname"><a href="../../d4/d7a/classfemus_1_1assemble__jacobian.html">femus::assemble_jacobian</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d73/Assemble__jacobian_8hpp_source.html#l00026">Assemble_jacobian.hpp:26</a></div></div>
<div class="ttc" id="aclassfemus_1_1elem__type_html_a3fa8f889f9ae97586b3db574acb4448e"><div class="ttname"><a href="../../d3/dca/classfemus_1_1elem__type.html#a3fa8f889f9ae97586b3db574acb4448e">femus::elem_type::GetGaussPointNumber</a></div><div class="ttdeci">unsigned GetGaussPointNumber() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6c/ElemType_8hpp_source.html#l00208">ElemType.hpp:208</a></div></div>
<div class="ttc" id="aclassfemus_1_1elem__type_html_a64c3ed0fd9cd8afcb765144362147a2e"><div class="ttname"><a href="../../d3/dca/classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">femus::elem_type::Jacobian</a></div><div class="ttdeci">virtual void Jacobian(const std::vector&lt; std::vector&lt; adept::adouble &gt; &gt; &amp;vt, const unsigned &amp;ig, adept::adouble &amp;Weight, std::vector&lt; double &gt; &amp;phi, std::vector&lt; adept::adouble &gt; &amp;gradphi, boost::optional&lt; std::vector&lt; adept::adouble &gt; &amp; &gt; nablaphi=boost::none) const =0</div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_a34bfabfdd8d16d8a726b3d24178f0d2d"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a34bfabfdd8d16d8a726b3d24178f0d2d">DesiredTarget</a></div><div class="ttdeci">double DesiredTarget(const std::vector&lt; double &gt; &amp;xyz)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00059">elliptic_nonlin_param.hpp:59</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_a516ea8ebb0823e8c37feff8f4fe5afd1"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a516ea8ebb0823e8c37feff8f4fe5afd1">BETA_CTRL_VOL</a></div><div class="ttdeci">#define BETA_CTRL_VOL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00013">elliptic_nonlin_param.hpp:13</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_a847600aec5b463a41a4efdd6a7f1aa55"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a847600aec5b463a41a4efdd6a7f1aa55">ControlDomainFlag_internal_restriction</a></div><div class="ttdeci">int ControlDomainFlag_internal_restriction(const std::vector&lt; double &gt; &amp;elem_center)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00067">elliptic_nonlin_param.hpp:67</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_ab6042dc7aa551272ad555cac7a27efca"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ab6042dc7aa551272ad555cac7a27efca">ALPHA_CTRL_VOL</a></div><div class="ttdeci">#define ALPHA_CTRL_VOL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00012">elliptic_nonlin_param.hpp:12</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_ac26c656f6cba791120e68b91d327f1f0"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ac26c656f6cba791120e68b91d327f1f0">ElementTargetFlag</a></div><div class="ttdeci">int ElementTargetFlag(const std::vector&lt; double &gt; &amp;elem_center)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00039">elliptic_nonlin_param.hpp:39</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_ad9a45c0f69f6ba97886caa1524904a0d"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ad9a45c0f69f6ba97886caa1524904a0d">InequalityConstraint</a></div><div class="ttdeci">double InequalityConstraint(const std::vector&lt; double &gt; &amp;dof_obj_coord, const bool upper)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00021">elliptic_nonlin_param.hpp:21</a></div></div>
<div class="ttc" id="anamespacefemus_html_a865501b20d45caeb12e3f10935e38cf6"><div class="ttname"><a href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">femus::ig</a></div><div class="ttdeci">const unsigned ig[N_GEOM_ELS][6][9]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d97/Elem_8hpp_source.html#l00345">Elem.hpp:345</a></div></div>
<div class="ttc" id="asolidopt__params_8hpp_html_a20f4c4490bc8ecbdd1ffcb79acce6035"><div class="ttname"><a href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a></div><div class="ttdeci">double alpha</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d58/solidopt__params_8hpp_source.html#l00026">solidopt_params.hpp:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afa47a0490569399968fe2c22812a80a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa47a0490569399968fe2c22812a80a1">&#9670;&nbsp;</a></span>ComputeIntegral()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeIntegral </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> &amp;&#160;</td>
          <td class="paramname"><em>ml_prob</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00720">720</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                                                          {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a>* mlPdeSys  = &amp;ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a3d90edba93be2c202ea2bf8e87e20854">get_system</a>&lt;<a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a>&gt; (<span class="stringliteral">&quot;OptSys&quot;</span>);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>          level      = mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a16af0d7b8849d6ea983a5e425fb90fee">GetLevelToAssemble</a>();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <a class="code" href="../../d6/db7/classfemus_1_1Mesh.html">Mesh</a>*                          msh = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a946d39c3fba7fac859822702248fe065">_ml_msh</a>-&gt;<a class="code" href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#ae5e4557f7784330822b988d83e2b6a40">GetLevel</a>(level);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html">MultiLevelSolution</a>*          ml_sol = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <a class="code" href="../../d0/da2/classfemus_1_1Solution.html">Solution</a>*                      sol = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a6dd8fec26a0ffbaae07e6df7ea42d12b">_ml_sol</a>-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#afe428eaa84d414762c4cc3b8a1d4f4a7">GetSolutionLevel</a>(level);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>     <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a6f753fa456d2313d902bf184c4bb9e3b">GetDimension</a>();                                 <span class="comment">// get the domain dimension of the problem</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>    dim2 = (3 * (<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1) + !(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> - 1));                        <span class="comment">// dim2 is the number of second order partial derivatives (1,3,6 depending on the dimension)</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> max_size = <span class="keyword">static_cast&lt;</span> <span class="keywordtype">unsigned</span> <span class="keyword">&gt;</span>(ceil(pow(3, <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>)));          <span class="comment">// conservative: based on line3, quad9, hex27</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>   iproc = msh-&gt;<a class="code" href="../../d2/df1/classfemus_1_1ParallelObject.html#a6438b3ffcc8cde2d6ccfb4ec563dfce1">processor_id</a>(); </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; <span class="comment">//************** geometry (at dofs and quadrature points) *************************************  </span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  vector &lt; vector &lt; double &gt; &gt; coords_at_dofs(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordtype">unsigned</span> SolFEType_domain = <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>; <span class="comment">// get the finite element type for &quot;x&quot;, it is always 2 (LAGRANGE BIQUADRATIC)</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; coords_at_dofs.size(); i++)    coords_at_dofs[i].reserve(max_size);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  vector &lt; double &gt; coord_at_qp(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; <span class="comment">//************* shape functions (at dofs and quadrature points) **************************************  </span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordtype">double</span> weight_qp; <span class="comment">// gauss point weight</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_fe_qp(<a class="code" href="../../df/d21/FETypeEnum_8hpp.html#ac6579c52f41d7124718cc41736bae6d1">NFE_FAMS</a>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_x_fe_qp(<a class="code" href="../../df/d21/FETypeEnum_8hpp.html#ac6579c52f41d7124718cc41736bae6d1">NFE_FAMS</a>);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  vector &lt; vector &lt; double &gt; &gt; phi_xx_fe_qp(<a class="code" href="../../df/d21/FETypeEnum_8hpp.html#ac6579c52f41d7124718cc41736bae6d1">NFE_FAMS</a>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> fe=0; fe &lt; <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#ac6579c52f41d7124718cc41736bae6d1">NFE_FAMS</a>; fe++) {  </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        phi_fe_qp[fe].reserve(max_size);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      phi_x_fe_qp[fe].reserve(max_size * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;     phi_xx_fe_qp[fe].reserve(max_size * dim2);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_unknowns = mlPdeSys-&gt;<a class="code" href="../../d4/d23/classfemus_1_1System.html#a4ebc859deb32b54c9936fa28f1485a93">GetSolPdeIndex</a>().size();</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keyword">enum</span> Sol_pos{pos_state = 0, pos_ctrl, pos_adj, pos_mu};  <span class="comment">//these are known at compile-time </span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  vector &lt; std::string &gt; Solname(n_unknowns);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  Solname[pos_state] = <span class="stringliteral">&quot;state&quot;</span>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  Solname[pos_ctrl]  = <span class="stringliteral">&quot;control&quot;</span>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  Solname[pos_adj]   = <span class="stringliteral">&quot;adjoint&quot;</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  Solname[pos_mu]    = <span class="stringliteral">&quot;mu&quot;</span>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  vector &lt; unsigned int &gt; SolIndex(n_unknowns);     <span class="comment">//index as in the MultilevelSolution vector</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  vector &lt; unsigned int &gt; SolFEType(n_unknowns);    <span class="comment">//FEtype of each MultilevelSolution       </span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  vector &lt; unsigned int &gt; Sol_n_el_dofs(n_unknowns); <span class="comment">//number of element dofs</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  std::fill(Sol_n_el_dofs.begin(), Sol_n_el_dofs.end(), 0);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ivar=0; ivar &lt; n_unknowns; ivar++) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;       SolIndex[ivar] = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>         (  Solname[ivar].c_str() );</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      SolFEType[ivar] = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>  ( SolIndex[ivar]);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="comment">//----------- quantities (at dof objects) ------------------------------</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  vector &lt; vector &lt; double &gt; &gt;     sol_eldofs(n_unknowns);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;n_unknowns; k++)  sol_eldofs[k].reserve(max_size);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">//------------ quantities (at quadrature points) ---------------------</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            vector&lt;double&gt;        sol_qp(n_unknowns);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    vector&lt; vector&lt;double&gt; &gt; sol_grad_qp(n_unknowns);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      std::fill(sol_qp.begin(), sol_qp.end(), 0.);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        sol_grad_qp[k].resize(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        std::fill(sol_grad_qp[k].begin(), sol_grad_qp[k].end(), 0.);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ab6042dc7aa551272ad555cac7a27efca">ALPHA_CTRL_VOL</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a>  = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a516ea8ebb0823e8c37feff8f4fe5afd1">BETA_CTRL_VOL</a>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; <span class="comment">//******************** state ************************ </span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  vector &lt;double&gt; phi_u;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  vector &lt;double&gt; phi_u_x; </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  vector &lt;double&gt; phi_u_xx;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  phi_u.reserve(max_size);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  phi_u_x.reserve(max_size * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  phi_u_xx.reserve(max_size * dim2);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordtype">unsigned</span> solIndex_u = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>(<span class="stringliteral">&quot;state&quot;</span>);    <span class="comment">// get the position of &quot;state&quot; in the ml_sol object</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordtype">unsigned</span> solType_u  = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>(solIndex_u);    <span class="comment">// get the finite element type for &quot;state&quot;</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  vector &lt; double &gt;  sol_u; <span class="comment">// local solution</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  sol_u.reserve(max_size);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordtype">double</span> u_gss = 0.;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; <span class="comment">//******************** control ********************** </span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  vector &lt;double&gt; phi_ctrl;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  vector &lt;double&gt; phi_ctrl_x;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  vector &lt;double&gt; phi_ctrl_xx;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  phi_ctrl.reserve(max_size);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  phi_ctrl_x.reserve(max_size * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  phi_ctrl_xx.reserve(max_size * dim2);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordtype">unsigned</span> solIndex_ctrl = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#a0c3d81a9146a8e96552da43955f0c7ae">GetIndex</a>(<span class="stringliteral">&quot;control&quot;</span>);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordtype">unsigned</span> solType_ctrl  = ml_sol-&gt;<a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html#ac6285c5a1907ad1f93ad7b380a08dabe">GetSolutionType</a>(solIndex_ctrl);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  vector &lt; double &gt;  sol_ctrl;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  sol_ctrl.reserve(max_size);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordtype">double</span> ctrl_grad_squared_gss = 0.;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; <span class="comment">//***************************************************  </span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; <span class="comment">//********************* desired ********************* </span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  vector &lt;double&gt; phi_udes;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  vector &lt;double&gt; phi_udes_x;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  vector &lt;double&gt; phi_udes_xx;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    phi_udes.reserve(max_size);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    phi_udes_x.reserve(max_size * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    phi_udes_xx.reserve(max_size * dim2);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  vector &lt; double &gt;  sol_udes; <span class="comment">// local solution</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  sol_udes.reserve(max_size);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   <span class="keywordtype">double</span> udes_gss = 0.;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160; <span class="comment">//********* WHOLE SET OF VARIABLES ****************** </span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> solFEType_max = <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#a789a31c8b16fddbe5ad66911ec7933c6">BIQUADR_FE</a>;  <span class="comment">//biquadratic</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordtype">double</span> integral_target = 0.;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">double</span> integral_alpha  = 0.;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordtype">double</span> integral_beta   = 0.;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="comment">// element loop: each process loops only on the elements that owns</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iel = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#aca17a5dc69b8cfb941b8bbe7ae4a615e">_elementOffset</a>[iproc]; iel &lt; msh-&gt;_elementOffset[iproc + 1]; iel++) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordtype">short</span> <span class="keywordtype">unsigned</span> ielGeom = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#af92bd9944b1d887562b460ede06acf44">GetElementType</a>(iel);    <span class="comment">// element geometry type</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; <span class="comment">//***************** GEOMETRY ************************ </span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordtype">unsigned</span> nDofx = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, SolFEType_domain);    <span class="comment">// number of coordinate element dofs</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; i++)  coords_at_dofs[i].resize(nDofx);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// local storage of coordinates</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nDofx; i++) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <span class="keywordtype">unsigned</span> xDof  = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, SolFEType_domain);    <span class="comment">// global to global mapping between coordinates node and coordinate dof</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> jdim = 0; jdim &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; jdim++) {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        coords_at_dofs[jdim][i] = (*msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ac436cfb1f4caaec0c4335358ff8a51d8">_topology</a>-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[jdim])(xDof);      <span class="comment">// global extraction and local storage for the element coordinates</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;   <span class="comment">// elem average point </span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    vector &lt; double &gt; elem_center(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>);   </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = 0.;  }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) {  </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nDofx; i++) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;         elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] += coords_at_dofs[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>][i];</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;       }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> = 0; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; <a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>++) { elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>] = elem_center[<a class="code" href="../../d5/dbc/MGAMR_2ex9_2MG__precond_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>]/nDofx; }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; <span class="comment">//************** set target domain flag *************</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   <span class="keywordtype">int</span> target_flag = 0;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   target_flag = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ac26c656f6cba791120e68b91d327f1f0">ElementTargetFlag</a>(elem_center);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; <span class="comment">//*************************************************** </span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <span class="comment">//all vars###################################################################  </span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordtype">unsigned</span>  ndofs_unk = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a679fa1625833f437ea38d2cc651c7462">GetElementDofNumber</a>(iel, SolFEType[k]);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;           Sol_n_el_dofs[k] = ndofs_unk;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;          sol_eldofs[k].resize(ndofs_unk);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; ndofs_unk; i++) {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;           <span class="keywordtype">unsigned</span> solDof = msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#ace44edec2dc2ffb42c0456f03fa227ff">GetSolutionDof</a>(i, iel, SolFEType[k]);                        <span class="comment">// global to global mapping between solution node and solution dof // via local to global solution node</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;           sol_eldofs[k][i] = (*sol-&gt;<a class="code" href="../../d0/da2/classfemus_1_1Solution.html#a5c725da69d0b94b7ff4a4e2509c86d53">_Sol</a>[SolIndex[k]])(solDof);                            <span class="comment">// global extraction and local storage for the solution</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;     }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <span class="comment">// *** Gauss point loop ***</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> = 0; <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a> &lt; msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][solFEType_max]-&gt;<a class="code" href="../../d3/dca/classfemus_1_1elem__type.html#a3fa8f889f9ae97586b3db574acb4448e">GetGaussPointNumber</a>(); <a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>++) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="comment">// *** get gauss point weight, test function and test function partial derivatives ***</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> fe=0; fe &lt; <a class="code" href="../../df/d21/FETypeEnum_8hpp.html#ac6579c52f41d7124718cc41736bae6d1">NFE_FAMS</a>; fe++) {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;         msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][fe]-&gt;<a class="code" href="../../d3/dca/classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_at_dofs,<a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>,weight_qp,phi_fe_qp[fe],phi_x_fe_qp[fe],phi_xx_fe_qp[fe]);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   <span class="comment">//HAVE TO RECALL IT TO HAVE BIQUADRATIC JACOBIAN</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;         msh-&gt;<a class="code" href="../../d6/db7/classfemus_1_1Mesh.html#a555c4982e81fc0042426c6741a792ca2">_finiteElement</a>[ielGeom][SolFEType_domain]-&gt;<a class="code" href="../../d3/dca/classfemus_1_1elem__type.html#a64c3ed0fd9cd8afcb765144362147a2e">Jacobian</a>(coords_at_dofs,<a class="code" href="../../d8/dea/namespacefemus.html#a865501b20d45caeb12e3f10935e38cf6">ig</a>,weight_qp,phi_fe_qp[SolFEType_domain],phi_x_fe_qp[SolFEType_domain],phi_xx_fe_qp[SolFEType_domain]);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; <span class="comment">//========= fill gauss value xyz ==================   </span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   std::fill(coord_at_qp.begin(), coord_at_qp.end(), 0.);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; coords_at_dofs[d].size(); i++) {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;               coord_at_qp[d] += coords_at_dofs[d][i] * phi_fe_qp[SolFEType_domain][i];</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            }</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="comment">//========= fill gauss value xyz ==================   </span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; <span class="comment">//========= fill gauss value quantities ==================   </span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;   std::fill(sol_qp.begin(), sol_qp.end(), 0.);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) { std::fill(sol_grad_qp[k].begin(), sol_grad_qp[k].end(), 0.); }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span>  k = 0; k &lt; n_unknowns; k++) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; Sol_n_el_dofs[k]; i++) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                                                 sol_qp[k]    += sol_eldofs[k][i] *   phi_fe_qp[SolFEType[k]][i];</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d++)   sol_grad_qp[k][d] += sol_eldofs[k][i] * phi_x_fe_qp[SolFEType[k]][i * <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a> + d];</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;       }        </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; <span class="comment">//========= fill gauss value quantities ==================   </span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    ctrl_grad_squared_gss  = 0.;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> d = 0; d &lt; <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#aece1bc3fff4b670afc08354a6d995a0e">dim</a>; d ++) ctrl_grad_squared_gss += sol_grad_qp[pos_ctrl][d] * sol_grad_qp[pos_ctrl][d];</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                    </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;               integral_target += target_flag * weight_qp * (sol_qp[pos_state] - <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a34bfabfdd8d16d8a726b3d24178f0d2d">DesiredTarget</a>(coord_at_qp)) * (sol_qp[pos_state] - <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a34bfabfdd8d16d8a726b3d24178f0d2d">DesiredTarget</a>(coord_at_qp));</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;               integral_alpha  +=       <a class="code" href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> * weight_qp * sol_qp[pos_ctrl] * sol_qp[pos_ctrl];</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;               integral_beta   +=        <a class="code" href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a> * weight_qp * ctrl_grad_squared_gss;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;          </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      } <span class="comment">// end gauss point loop</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  } <span class="comment">//end element loop</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;The value of the integral_target is &quot;</span> &lt;&lt; std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt; integral_target &lt;&lt; std::endl;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;The value of the integral_alpha  is &quot;</span> &lt;&lt; std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt; integral_alpha &lt;&lt; std::endl;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;The value of the integral_beta   is &quot;</span> &lt;&lt; std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt; integral_beta &lt;&lt; std::endl;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;The value of the total integral  is &quot;</span> &lt;&lt; std::setw(11) &lt;&lt; std::setprecision(10) &lt;&lt; integral_target + 0.5 * <a class="code" href="../../de/d58/solidopt__params_8hpp.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> * integral_alpha + 0.5 * <a class="code" href="../../d8/d87/Conformal_2ex3_2ex3_8cpp.html#a4049344c4d6020a322197047b513967f">beta</a> * integral_beta &lt;&lt; std::endl;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;}</div>
<div class="ttc" id="aFETypeEnum_8hpp_html_ac6579c52f41d7124718cc41736bae6d1"><div class="ttname"><a href="../../df/d21/FETypeEnum_8hpp.html#ac6579c52f41d7124718cc41736bae6d1">NFE_FAMS</a></div><div class="ttdeci">#define NFE_FAMS</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d21/FETypeEnum_8hpp_source.html#l00013">FETypeEnum.hpp:13</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a29781a20c5dd4153c3c1cecf0ff328"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a29781a20c5dd4153c3c1cecf0ff328">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000135">Todo:</a></b></dt><dd></dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00097">97</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// ======= Init ========================</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// init Petsc-MPI communicator</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="../../d6/d8c/classfemus_1_1FemusInit.html">FemusInit</a> mpinit(argc, args, MPI_COMM_WORLD);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// ======= Problem ========================</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> ml_prob;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// ======= Files ========================</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="../../d4/d91/classfemus_1_1Files.html">Files</a> files; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        files.<a class="code" href="../../d4/d91/classfemus_1_1Files.html#ab8c41974c4980d87c7e1467b153854e6">CheckIODirectories</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        files.<a class="code" href="../../d4/d91/classfemus_1_1Files.html#aac199200ffda7ba50611cc41f6a874bc">RedirectCout</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">// ======= Problem, Files ========================</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a623bdc2aefd83cf0c6d74fc265ee5c3f">SetFilesHandler</a>(&amp;files);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// ======= Quad Rule ========================</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  std::string fe_quad_rule(<span class="stringliteral">&quot;seventh&quot;</span>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// ======= Problem,  Quad Rule ========================</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a8b72e984b63d5ff97c1e7a0f0a5eee5a">SetQuadratureRuleAllGeomElems</a>(fe_quad_rule);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// ======= Mesh ========================</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html">MultiLevelMesh</a> ml_mesh;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  ml_mesh.<a class="code" href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#a0988cbee341d6361df77622b3ce65080">GenerateCoarseBoxMesh</a>(<a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a8a3d856ec83d08cb8066fb936973bb89">NSUB_X</a>,<a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a70b8f494dd4520cd4f92774b49f07e30">NSUB_Y</a>,0,0.,1.,0.,1.,0.,0.,<a class="code" href="../../d8/d65/ElemTypeEnum_8hpp.html#a1b014294b9757a001707c979e2bab627ac17e6803e9d62a4d807c62341c5f7d59">QUAD9</a>,fe_quad_rule.c_str());</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> = 1;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordtype">unsigned</span> numberOfSelectiveLevels = 0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  ml_mesh.<a class="code" href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#a06c4fe014434c2bafdd2c6e94e018620">RefineMesh</a>(<a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> , <a class="code" href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a> + numberOfSelectiveLevels, NULL);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  ml_mesh.<a class="code" href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#a09c12975f18035d5369ae411c0208648">PrintInfo</a>();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// ======= Solution ========================</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="../../db/d17/classfemus_1_1MultiLevelSolution.html">MultiLevelSolution</a> ml_sol(&amp;ml_mesh);  <span class="comment">// define the multilevel solution and attach the ml_mesh object to it</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// ======= Problem, Mesh and Solution  ==================</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#ad86fcf047c83e4a719e09455a2fa247a">SetMultiLevelMeshAndSolution</a>(&amp; ml_sol);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// add variables to ml_sol</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  ml_sol.AddSolution(<span class="stringliteral">&quot;state&quot;</span>,   <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  ml_sol.AddSolution(<span class="stringliteral">&quot;control&quot;</span>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  ml_sol.AddSolution(<span class="stringliteral">&quot;adjoint&quot;</span>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  ml_sol.AddSolution(<span class="stringliteral">&quot;mu&quot;</span>,      <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>);  </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  ml_sol.AddSolution(<span class="stringliteral">&quot;TargReg&quot;</span>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df">DISCONTINUOUS_POLYNOMIAL</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf">ZERO</a>); <span class="comment">//this variable is not solution of any eqn, it&#39;s just a given field</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  ml_sol.AddSolution(<span class="stringliteral">&quot;ContReg&quot;</span>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df">DISCONTINUOUS_POLYNOMIAL</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf">ZERO</a>); <span class="comment">//this variable is not solution of any eqn, it&#39;s just a given field</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">//MU</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  std::vector&lt;std::string&gt; act_set_flag_name(1);  act_set_flag_name[0] = <span class="stringliteral">&quot;act_flag&quot;</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> act_set_fake_time_dep_flag = 2;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  ml_sol.AddSolution(act_set_flag_name[0].c_str(), <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a>, <a class="code" href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a>, act_set_fake_time_dep_flag, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  ml_sol.Initialize(act_set_flag_name[0].c_str(), <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp; ml_prob);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">//MU</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// ======= Solution: Initial values ========================</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;All&quot;</span>);    <span class="comment">// initialize all variables to zero</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//   ml_sol.Initialize(&quot;All&quot;, Solution_set_initial_conditions, &amp;ml_prob); //unfortunately if I do this it sets all to zero //I would like to do an attach function similar to the BC</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;state&quot;</span>,   <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;control&quot;</span>, <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;adjoint&quot;</span>, <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;mu&quot;</span>,      <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;TargReg&quot;</span>, <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  ml_sol.Initialize(<span class="stringliteral">&quot;ContReg&quot;</span>, <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  ml_sol.Initialize(act_set_flag_name[0].c_str(),  <a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a>, &amp;ml_prob);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// ======= Solution: Boundary Conditions ========================</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  ml_sol.AttachSetBoundaryConditionFunction(<a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a8ab90a1f3f518239872121a5071597ad">SetBoundaryCondition</a>);  <span class="comment">// attach the boundary condition function and generate boundary data</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">//   ml_sol.GenerateBdc(&quot;All&quot;);  //this would do it also for the non-equation-related variables</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  ml_sol.GenerateBdc(<span class="stringliteral">&quot;state&quot;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  ml_sol.GenerateBdc(<span class="stringliteral">&quot;control&quot;</span>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  ml_sol.GenerateBdc(<span class="stringliteral">&quot;adjoint&quot;</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  ml_sol.GenerateBdc(<span class="stringliteral">&quot;mu&quot;</span>);  <span class="comment">//we need this for all Pde variables to make the matrix iterations work... but this should be related to the matrix and not to the sol... The same for the initial condition</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// ======= System ========================</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a>&amp; system = ml_prob.<a class="code" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#ad54bc6b7254d2331491ac48b58a2d9e3">add_system</a> &lt; <a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html">NonLinearImplicitSystemWithPrimalDualActiveSetMethod</a> &gt; (<span class="stringliteral">&quot;OptSys&quot;</span>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  system.<a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html#a0310f1ade7f2680fa718e0a5c0712d05">SetActiveSetFlagName</a>(act_set_flag_name);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">//here we decide the order in the matrix!</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keyword">const</span> std::vector &lt; std::string &gt; sol_matrix_pos = {<span class="stringliteral">&quot;state&quot;</span>,<span class="stringliteral">&quot;control&quot;</span>,<span class="stringliteral">&quot;adjoint&quot;</span>,<span class="stringliteral">&quot;mu&quot;</span>};</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt; sol_matrix_pos.size(); k++)  system.<a class="code" href="../../d4/d23/classfemus_1_1System.html#a606e07526d7a0d31eed638404ee2ed24">AddSolutionToSystemPDE</a>(sol_matrix_pos[k].c_str());  </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">// attach the assembling function to system</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  system.<a class="code" href="../../d4/d23/classfemus_1_1System.html#a42a5b5b5d2c7673b1d4c896762d8db9e">SetAssembleFunction</a>(<a class="code" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a288dd20ec0c83eb3c427ca7ec6a6f107">AssembleProblem</a>);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  ml_sol.SetWriter(<a class="code" href="../../d1/d89/WriterEnum_8hpp.html#a18b827c3c1f62b8a57febdcad0c871a8a37fb55ddbbe1465cec5f3d154db73e67">VTK</a>);   <span class="comment">//need to move this here for the DebugNonlinear function</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  ml_sol.GetWriter()-&gt;SetDebugOutput(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">//   system.SetDebugNonlinear(true);</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">//   system.SetDebugFunction(ComputeIntegral);   </span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"></span>  <span class="comment">//   system.SetMaxNumberOfNonLinearIterations(2);</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// ======= Solve ========================</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  system.<a class="code" href="../../d5/d10/classfemus_1_1NonLinearImplicitSystem.html#ad2d20975e0c919a9d99bdd9368a0212a">init</a>();    <span class="comment">// initialize and solve the system</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  system.<a class="code" href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html#a8f685eb396b671ef69667f6f4edf8933">MGsolve</a>();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">//   ComputeIntegral(ml_prob);</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// ======= Final Print ========================</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  std::vector &lt; std::string &gt; variablesToBePrinted;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  variablesToBePrinted.push_back(<span class="stringliteral">&quot;all&quot;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  ml_sol.GetWriter()-&gt;Write(files.<a class="code" href="../../d4/d91/classfemus_1_1Files.html#acf59b68932959fe552a95acc362c3920">GetOutputPath</a>()<span class="comment">/*DEFAULT_OUTPUTDIR*/</span>, <span class="stringliteral">&quot;biquadratic&quot;</span>, variablesToBePrinted);    <span class="comment">// print solutions</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div>
<div class="ttc" id="a01__distributed__control__elliptic__nonlin_8cpp_html_a288dd20ec0c83eb3c427ca7ec6a6f107"><div class="ttname"><a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a288dd20ec0c83eb3c427ca7ec6a6f107">AssembleProblem</a></div><div class="ttdeci">void AssembleProblem(MultiLevelProblem &amp;ml_prob)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00210">01_distributed_control_elliptic_nonlin.cpp:210</a></div></div>
<div class="ttc" id="a01__distributed__control__elliptic__nonlin_8cpp_html_a5dec9191b407f5f1913e563b23777741"><div class="ttname"><a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a5dec9191b407f5f1913e563b23777741">Solution_set_initial_conditions</a></div><div class="ttdeci">double Solution_set_initial_conditions(const MultiLevelProblem *ml_prob, const std::vector&lt; double &gt; &amp;x, const char name[])</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00038">01_distributed_control_elliptic_nonlin.cpp:38</a></div></div>
<div class="ttc" id="a01__distributed__control__elliptic__nonlin_8cpp_html_a8ab90a1f3f518239872121a5071597ad"><div class="ttname"><a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html#a8ab90a1f3f518239872121a5071597ad">SetBoundaryCondition</a></div><div class="ttdeci">bool SetBoundaryCondition(const std::vector&lt; double &gt; &amp;x, const char name[], double &amp;value, const int faceName, const double time)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00069">01_distributed_control_elliptic_nonlin.cpp:69</a></div></div>
<div class="ttc" id="aElemTypeEnum_8hpp_html_a1b014294b9757a001707c979e2bab627ac17e6803e9d62a4d807c62341c5f7d59"><div class="ttname"><a href="../../d8/d65/ElemTypeEnum_8hpp.html#a1b014294b9757a001707c979e2bab627ac17e6803e9d62a4d807c62341c5f7d59">QUAD9</a></div><div class="ttdeci">@ QUAD9</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d65/ElemTypeEnum_8hpp_source.html#l00016">ElemTypeEnum.hpp:16</a></div></div>
<div class="ttc" id="aFElemTypeEnum_8hpp_html_a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1"><div class="ttname"><a href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baa6a7856cca1833641e731676636b193f1">FIRST</a></div><div class="ttdeci">@ FIRST</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc8/FElemTypeEnum_8hpp_source.html#l00015">FElemTypeEnum.hpp:15</a></div></div>
<div class="ttc" id="aFElemTypeEnum_8hpp_html_a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf"><div class="ttname"><a href="../../db/dc8/FElemTypeEnum_8hpp.html#a00ea9562f0dbb25e22bb3297d596e3baae117e3533122c80b262257b49b21cddf">ZERO</a></div><div class="ttdeci">@ ZERO</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc8/FElemTypeEnum_8hpp_source.html#l00014">FElemTypeEnum.hpp:14</a></div></div>
<div class="ttc" id="aFElemTypeEnum_8hpp_html_a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df"><div class="ttname"><a href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a2318cd5622bed5320c47de68813ab4df">DISCONTINUOUS_POLYNOMIAL</a></div><div class="ttdeci">@ DISCONTINUOUS_POLYNOMIAL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc8/FElemTypeEnum_8hpp_source.html#l00006">FElemTypeEnum.hpp:6</a></div></div>
<div class="ttc" id="aFElemTypeEnum_8hpp_html_a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e"><div class="ttname"><a href="../../db/dc8/FElemTypeEnum_8hpp.html#a7c9a70b7c6b5baf5d7942938d770a664a3a2686743e1a69768985087ac144a28e">LAGRANGE</a></div><div class="ttdeci">@ LAGRANGE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc8/FElemTypeEnum_8hpp_source.html#l00005">FElemTypeEnum.hpp:5</a></div></div>
<div class="ttc" id="aISM_2ex4_2ex4_8cpp_html_a0aca793820b6ff7705450e2043256938"><div class="ttname"><a href="../../d8/d2c/ISM_2ex4_2ex4_8cpp.html#a0aca793820b6ff7705450e2043256938">numberOfUniformLevels</a></div><div class="ttdeci">unsigned numberOfUniformLevels</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d2c/ISM_2ex4_2ex4_8cpp_source.html#l00089">ex4.cpp:89</a></div></div>
<div class="ttc" id="aWriterEnum_8hpp_html_a18b827c3c1f62b8a57febdcad0c871a8a37fb55ddbbe1465cec5f3d154db73e67"><div class="ttname"><a href="../../d1/d89/WriterEnum_8hpp.html#a18b827c3c1f62b8a57febdcad0c871a8a37fb55ddbbe1465cec5f3d154db73e67">VTK</a></div><div class="ttdeci">@ VTK</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d89/WriterEnum_8hpp_source.html#l00004">WriterEnum.hpp:4</a></div></div>
<div class="ttc" id="aclassfemus_1_1FemusInit_html"><div class="ttname"><a href="../../d6/d8c/classfemus_1_1FemusInit.html">femus::FemusInit</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0d/FemusInit_8hpp_source.html#l00049">FemusInit.hpp:49</a></div></div>
<div class="ttc" id="aclassfemus_1_1Files_html"><div class="ttname"><a href="../../d4/d91/classfemus_1_1Files.html">femus::Files</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc0/Files_8hpp_source.html#l00040">Files.hpp:40</a></div></div>
<div class="ttc" id="aclassfemus_1_1Files_html_aac199200ffda7ba50611cc41f6a874bc"><div class="ttname"><a href="../../d4/d91/classfemus_1_1Files.html#aac199200ffda7ba50611cc41f6a874bc">femus::Files::RedirectCout</a></div><div class="ttdeci">void RedirectCout(const bool redirect_cout_to_file) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d19/Files_8cpp_source.html#l00553">Files.cpp:553</a></div></div>
<div class="ttc" id="aclassfemus_1_1Files_html_ab8c41974c4980d87c7e1467b153854e6"><div class="ttname"><a href="../../d4/d91/classfemus_1_1Files.html#ab8c41974c4980d87c7e1467b153854e6">femus::Files::CheckIODirectories</a></div><div class="ttdeci">void CheckIODirectories(const bool use_output_time_folder)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d19/Files_8cpp_source.html#l00515">Files.cpp:515</a></div></div>
<div class="ttc" id="aclassfemus_1_1Files_html_acf59b68932959fe552a95acc362c3920"><div class="ttname"><a href="../../d4/d91/classfemus_1_1Files.html#acf59b68932959fe552a95acc362c3920">femus::Files::GetOutputPath</a></div><div class="ttdeci">std::string GetOutputPath() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc0/Files_8hpp_source.html#l00064">Files.hpp:64</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelMesh_html"><div class="ttname"><a href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html">femus::MultiLevelMesh</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d21/MultiLevelMesh_8hpp_source.html#l00046">MultiLevelMesh.hpp:46</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelMesh_html_a06c4fe014434c2bafdd2c6e94e018620"><div class="ttname"><a href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#a06c4fe014434c2bafdd2c6e94e018620">femus::MultiLevelMesh::RefineMesh</a></div><div class="ttdeci">void RefineMesh(const unsigned short &amp;igridn, const unsigned short &amp;igridr, bool(*SetRefinementFlag)(const std::vector&lt; double &gt; &amp;x, const int &amp;ElemGroupNumber, const int &amp;level))</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc9/MultiLevelMesh_8cpp_source.html#l00495">MultiLevelMesh.cpp:495</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelMesh_html_a0988cbee341d6361df77622b3ce65080"><div class="ttname"><a href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#a0988cbee341d6361df77622b3ce65080">femus::MultiLevelMesh::GenerateCoarseBoxMesh</a></div><div class="ttdeci">void GenerateCoarseBoxMesh(const unsigned int nx, const unsigned int ny, const unsigned int nz, const double xmin, const double xmax, const double ymin, const double ymax, const double zmin, const double zmax, const ElemType type, const char GaussOrder[])</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc9/MultiLevelMesh_8cpp_source.html#l00472">MultiLevelMesh.cpp:472</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelMesh_html_a09c12975f18035d5369ae411c0208648"><div class="ttname"><a href="../../d7/d9c/classfemus_1_1MultiLevelMesh.html#a09c12975f18035d5369ae411c0208648">femus::MultiLevelMesh::PrintInfo</a></div><div class="ttdeci">void PrintInfo()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc9/MultiLevelMesh_8cpp_source.html#l00462">MultiLevelMesh.cpp:462</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">femus::MultiLevelProblem</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/MultiLevelProblem_8hpp_source.html#l00054">MultiLevelProblem.hpp:54</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_a623bdc2aefd83cf0c6d74fc265ee5c3f"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a623bdc2aefd83cf0c6d74fc265ee5c3f">femus::MultiLevelProblem::SetFilesHandler</a></div><div class="ttdeci">void SetFilesHandler(const Files *files_in)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/MultiLevelProblem_8hpp_source.html#l00423">MultiLevelProblem.hpp:423</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_a8b72e984b63d5ff97c1e7a0f0a5eee5a"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#a8b72e984b63d5ff97c1e7a0f0a5eee5a">femus::MultiLevelProblem::SetQuadratureRuleAllGeomElems</a></div><div class="ttdeci">void SetQuadratureRuleAllGeomElems(const std::string quadr_order_in)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d24/MultiLevelProblem_8cpp_source.html#l00177">MultiLevelProblem.cpp:177</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_ad54bc6b7254d2331491ac48b58a2d9e3"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#ad54bc6b7254d2331491ac48b58a2d9e3">femus::MultiLevelProblem::add_system</a></div><div class="ttdeci">virtual System &amp; add_system(const std::string &amp;system_type, const std::string &amp;name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d24/MultiLevelProblem_8cpp_source.html#l00077">MultiLevelProblem.cpp:77</a></div></div>
<div class="ttc" id="aclassfemus_1_1MultiLevelProblem_html_ad86fcf047c83e4a719e09455a2fa247a"><div class="ttname"><a href="../../d8/d26/classfemus_1_1MultiLevelProblem.html#ad86fcf047c83e4a719e09455a2fa247a">femus::MultiLevelProblem::SetMultiLevelMeshAndSolution</a></div><div class="ttdeci">void SetMultiLevelMeshAndSolution(MultiLevelSolution *ml_sol)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d24/MultiLevelProblem_8cpp_source.html#l00068">MultiLevelProblem.cpp:68</a></div></div>
<div class="ttc" id="aclassfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod_html_a0310f1ade7f2680fa718e0a5c0712d05"><div class="ttname"><a href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html#a0310f1ade7f2680fa718e0a5c0712d05">femus::NonLinearImplicitSystemWithPrimalDualActiveSetMethod::SetActiveSetFlagName</a></div><div class="ttdeci">void SetActiveSetFlagName(const std::vector&lt; std::string &gt; &amp;name_in)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d8f/NonLinearImplicitSystemWithPrimalDualActiveSetMethod_8hpp_source.html#l00057">NonLinearImplicitSystemWithPrimalDualActiveSetMethod.hpp:57</a></div></div>
<div class="ttc" id="aclassfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod_html_a8f685eb396b671ef69667f6f4edf8933"><div class="ttname"><a href="../../d4/d32/classfemus_1_1NonLinearImplicitSystemWithPrimalDualActiveSetMethod.html#a8f685eb396b671ef69667f6f4edf8933">femus::NonLinearImplicitSystemWithPrimalDualActiveSetMethod::MGsolve</a></div><div class="ttdeci">virtual void MGsolve(const MgSmootherType &amp;mgSmootherType=MULTIPLICATIVE)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/NonLinearImplicitSystemWithPrimalDualActiveSetMethod_8cpp_source.html#l00046">NonLinearImplicitSystemWithPrimalDualActiveSetMethod.cpp:46</a></div></div>
<div class="ttc" id="aclassfemus_1_1NonLinearImplicitSystem_html_ad2d20975e0c919a9d99bdd9368a0212a"><div class="ttname"><a href="../../d5/d10/classfemus_1_1NonLinearImplicitSystem.html#ad2d20975e0c919a9d99bdd9368a0212a">femus::NonLinearImplicitSystem::init</a></div><div class="ttdeci">virtual void init()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da8/NonLinearImplicitSystem_8cpp_source.html#l00047">NonLinearImplicitSystem.cpp:47</a></div></div>
<div class="ttc" id="aclassfemus_1_1System_html_a42a5b5b5d2c7673b1d4c896762d8db9e"><div class="ttname"><a href="../../d4/d23/classfemus_1_1System.html#a42a5b5b5d2c7673b1d4c896762d8db9e">femus::System::SetAssembleFunction</a></div><div class="ttdeci">void SetAssembleFunction(AssembleFunctionType)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/System_8cpp_source.html#l00058">System.cpp:58</a></div></div>
<div class="ttc" id="aclassfemus_1_1System_html_a606e07526d7a0d31eed638404ee2ed24"><div class="ttname"><a href="../../d4/d23/classfemus_1_1System.html#a606e07526d7a0d31eed638404ee2ed24">femus::System::AddSolutionToSystemPDE</a></div><div class="ttdeci">virtual void AddSolutionToSystemPDE(const char solname[])</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d7c/System_8cpp_source.html#l00075">System.cpp:75</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_a70b8f494dd4520cd4f92774b49f07e30"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a70b8f494dd4520cd4f92774b49f07e30">NSUB_Y</a></div><div class="ttdeci">#define NSUB_Y</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00008">elliptic_nonlin_param.hpp:8</a></div></div>
<div class="ttc" id="aelliptic__nonlin__param_8hpp_html_a8a3d856ec83d08cb8066fb936973bb89"><div class="ttname"><a href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a8a3d856ec83d08cb8066fb936973bb89">NSUB_X</a></div><div class="ttdeci">#define NSUB_X</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d47/elliptic__nonlin__param_8hpp_source.html#l00007">elliptic_nonlin_param.hpp:7</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae121ae9c414a6f68412c17068b0de5f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae121ae9c414a6f68412c17068b0de5f3">&#9670;&nbsp;</a></span>nonlin_term_derivative()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double nonlin_term_derivative </td>
          <td>(</td>
          <td class="paramtype">const double &amp;&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00028">28</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                                                {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">return</span> 0.;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//    return  +2. * 1./( (1. - v)*(1. - v) ); </span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//    return 0.01* (+2.) * 1./( (1. - v)*(1. - v)*(1. - v) ); </span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//     return exp(v);</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0d54f4d825c63982cb96543030037395"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d54f4d825c63982cb96543030037395">&#9670;&nbsp;</a></span>nonlin_term_function()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double nonlin_term_function </td>
          <td>(</td>
          <td class="paramtype">const double &amp;&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00019">19</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                                              {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;   <span class="keywordflow">return</span> 1.;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//    return 1./( (1. - v) );</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//    return 0.01*1./( (1. - v)*(1. - v) );</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//     return exp(v);</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ab90a1f3f518239872121a5071597ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ab90a1f3f518239872121a5071597ad">&#9670;&nbsp;</a></span>SetBoundaryCondition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SetBoundaryCondition </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>name</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>faceName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00069">69</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                                                                                                                  {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordtype">bool</span> dirichlet = <span class="keyword">true</span>; <span class="comment">//dirichlet</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  value = 0.;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;control&quot;</span>)) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      value = 0.;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">//   if (faceName == 3)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">//     dirichlet = false;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;mu&quot;</span>)) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//       value = 0.;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">//   if (faceName == 3)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    dirichlet = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">return</span> dirichlet;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5dec9191b407f5f1913e563b23777741"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dec9191b407f5f1913e563b23777741">&#9670;&nbsp;</a></span>Solution_set_initial_conditions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double Solution_set_initial_conditions </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d26/classfemus_1_1MultiLevelProblem.html">MultiLevelProblem</a> *&#160;</td>
          <td class="paramname"><em>ml_prob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char&#160;</td>
          <td class="paramname"><em>name</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html#l00038">38</a> of file <a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp_source.html">01_distributed_control_elliptic_nonlin.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                                                                                                                             {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;         </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;           <span class="keywordtype">double</span> value = 0.;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;             <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;control&quot;</span>)) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                 value = 0.;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;             }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;mu&quot;</span>)) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                 value = 0.;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;             }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;state&quot;</span>)) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                 value = 0.;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;             }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;adjoint&quot;</span>)) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                 value = 0.;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;             }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;TargReg&quot;</span>)) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                 value = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#ac26c656f6cba791120e68b91d327f1f0">ElementTargetFlag</a>(x);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;             }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;ContReg&quot;</span>)) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                 value = <a class="code" href="../../dc/d47/elliptic__nonlin__param_8hpp.html#a847600aec5b463a41a4efdd6a7f1aa55">ControlDomainFlag_internal_restriction</a>(x);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;             }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(name,<span class="stringliteral">&quot;act_flag&quot;</span>)) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                 value = 0.;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;             }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;           </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordflow">return</span> value;   </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_26ff6c3add381934eb249273d9238662.html">femus</a></li><li class="navelem"><a class="el" href="../../dir_9206ac3774e2a47bcb445b819b2f5964.html">applications</a></li><li class="navelem"><a class="el" href="../../dir_0109ff5b139427b8e4f04e46583f8baf.html">OptimalControl</a></li><li class="navelem"><a class="el" href="../../dir_434fa67b23a656472277b66cfd3711d6.html">01_distributed_control_elliptic_nonlin</a></li><li class="navelem"><a class="el" href="../../da/d4f/01__distributed__control__elliptic__nonlin_8cpp.html">01_distributed_control_elliptic_nonlin.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
